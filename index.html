<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeTracker Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: #ffffff;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .date-display {
            font-size: 1.2rem;
            opacity: 0.9;
            color: #b0b0b0;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
        }
        
        .tracking-section {
            background: #2d3748;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            min-height: calc(100vh - 200px);
        }
        
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: sticky;
            top: 20px;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
        }
        
        .quote-card {
            background: rgba(45, 55, 72, 0.95);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            border: 1px solid #4a5568;
        }
        
        .quote-text {
            font-style: italic;
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: #cbd5e0;
        }
        
        .quote-author {
            font-weight: bold;
            color: #667eea;
        }
        
        .consistency-card {
            background: rgba(45, 55, 72, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            border: 1px solid #4a5568;
        }
        
        .consistency-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #e2e8f0;
            text-align: center;
        }
        
        .consistency-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #4a5568;
        }
        
        .consistency-item:last-child {
            border-bottom: none;
        }
        
        .consistency-status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.8rem;
        }
        
        .status-good {
            background: #48bb78;
        }
        
        .status-bad {
            background: #f56565;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .input-group {
            background: #4a5568;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .input-group:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }
        
        .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #e2e8f0;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px;
            background: #2d3748;
            border: 2px solid #718096;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            color: #e2e8f0;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            background: #2d3748;
        }
        
        .input-group input::placeholder {
            color: #a0aec0;
        }
        
        .sleep-expanded, .training-expanded {
            grid-column: span 2;
        }
        
        .sleep-details, .training-checkboxes, .run-details, .bodyweight-details {
            margin-top: 15px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .sleep-card {
            background: rgba(45, 55, 72, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            border: 1px solid #4a5568;
        }
    
        .sleep-score {
            text-align: center;
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
            color: #667eea;
        }
        
        .hour-minute-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
        }
        
        .hour-minute-group input {
            text-align: center;
            padding: 8px;
            background: #2d3748;
            border: 2px solid #718096;
            color: #e2e8f0;
        }
        
        .sleep-time-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .sleep-time-inputs > div {
            display: flex;
            flex-direction: column;
        }
        
        .sleep-time-inputs label {
            font-size: 0.9rem;
            color: #cbd5e0;
            margin-bottom: 5px;
        }
        
        .sleep-breakdown {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .sleep-metric {
            background: #4a5568;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }
        
        .sleep-metric-label {
            font-size: 0.8rem;
            color: #cbd5e0;
            margin-bottom: 5px;
        }
        
        .sleep-metric-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #e2e8f0;
        }
        
        .sleep-stage-bar {
            height: 8px;
            border-radius: 4px;
            margin-top: 5px;
            overflow: hidden;
            background: #718096;
        }
        
        .sleep-stage-fill {
            height: 100%;
            border-radius: 4px;
        }
        
        .sleep-detail-item, .run-detail-item {
            display: flex;
            flex-direction: column;
        }
        
        .sleep-detail-item label, .run-detail-item label {
            font-size: 0.9rem;
            margin-bottom: 5px;
            color: #cbd5e0;
        }
        
        .sleep-detail-item input, .run-detail-item input, .run-detail-item select {
            padding: 8px;
            background: #2d3748;
            border: 2px solid #718096;
            border-radius: 6px;
            font-size: 0.95rem;
            color: #e2e8f0;
        }
        
        .run-detail-item select {
            cursor: pointer;
            background: #2d3748;
        }
        
        .training-checkboxes {
            grid-template-columns: 1fr;
            gap: 10px;
        }
        
        .run-details {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #718096;
        }
        
        .sick-section {
            background: rgba(45, 55, 72, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            margin-top: 10px;
            border: 1px solid #4a5568;
        }
        
        .sick-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #e2e8f0;
            text-align: center;
        }
        
        .sick-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px;
            background: #4a5568;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .sick-toggle:hover {
            background: #5a6575;
        }
        
        .sick-toggle.active {
            background: rgba(13, 202, 240, 0.2);
            border: 2px solid #0dcaf0;
        }
        
        .sick-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }
        
        .sick-label {
            flex-grow: 1;
            margin-left: 10px;
            font-weight: 600;
            color: #e2e8f0;
        }
        
        .sick-indicator {
            font-size: 0.9rem;
            color: #0dcaf0;
            background: #2d3748;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
        }
        
        .sick-note {
            font-size: 0.8rem;
            color: #a0aec0;
            text-align: center;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #4a5568;
        }
    
        .rest-section {
            background: rgba(45, 55, 72, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            margin-top: 10px;
            border: 1px solid #4a5568;
        }
        
        .rest-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #e2e8f0;
            text-align: center;
        }
        
        .rest-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px;
            background: #4a5568;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .rest-toggle:hover {
            background: #5a6575;
        }
        
        .rest-toggle.active {
            background: rgba(255, 193, 7, 0.2);
            border: 2px solid #ffc107;
        }
        
        .rest-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }
        
        .rest-label {
            flex-grow: 1;
            margin-left: 10px;
            font-weight: 600;
            color: #e2e8f0;
        }
        
        .rest-indicator {
            font-size: 0.9rem;
            color: #ffc107;
            background: #2d3748;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
        }
        
        .reset-section {
            background: rgba(45, 55, 72, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            margin-top: 10px;
            border: 1px solid #4a5568;
        }
        
        .reset-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #e2e8f0;
            text-align: center;
        }
        
        .reset-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #f56565, #c53030);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }
        
        .reset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 101, 101, 0.4);
        }
        
        .reset-confirm {
            display: none;
            margin-top: 10px;
            padding: 15px;
            background: rgba(255, 193, 7, 0.1);
            border-radius: 10px;
            border: 1px solid #ffc107;
        }
        
        .reset-confirm-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .reset-confirm-btn {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .reset-confirm-yes {
            background: #f56565;
            color: white;
        }
        
        .reset-confirm-yes:hover {
            background: #c53030;
        }
        
        .reset-confirm-no {
            background: #718096;
            color: white;
        }
        
        .reset-confirm-no:hover {
            background: #4a5568;
        }
        
        .reset-note {
            font-size: 0.8rem;
            color: #a0aec0;
            text-align: center;
            margin-top: 5px;
        }
    
        .points-card {
            background: rgba(45, 55, 72, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            border: 1px solid #4a5568;
        }
        
        .points-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .points-title {
            font-size: 1.3rem;
            color: #e2e8f0;
        }
        
        .points-total {
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 4px rgba(255, 215, 0, 0.3);
        }
        
        .points-breakdown {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
        
        .points-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #4a5568;
        }
        
        .points-item:last-child {
            border-bottom: none;
        }
        
        .points-activity {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .points-emoji {
            font-size: 1.2rem;
        }
        
        .points-value {
            font-weight: bold;
            color: #f6ad55;
        }
        
        .points-multiplier {
            font-size: 0.8rem;
            color: #68d391;
            margin-left: 5px;
        }
        
        .points-negative {
            color: #fc8181;
        }
        
        .points-today {
            text-align: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #FFD700;
            font-weight: bold;
            color: #e2e8f0;
        }
        
        .level-indicator {
            margin-top: 10px;
            text-align: center;
        }
        
        .level-bar {
            height: 8px;
            background: #718096;
            border-radius: 4px;
            overflow: hidden;
            margin: 5px 0;
        }
        
        .level-progress {
            height: 100%;
            background: linear-gradient(90deg, #48bb78, #38a169);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .level-text {
            font-size: 0.9rem;
            color: #cbd5e0;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .checkbox-group label {
            margin: 0;
            cursor: pointer;
            color: #e2e8f0;
        }
        
        .cold-shower-checked {
            background: linear-gradient(135deg, #48bb78, #38a169) !important;
            color: white;
        }
        
        .lust-checked {
            background: linear-gradient(135deg, #f56565, #c53030) !important;
            color: white;
        }
        
        .nav-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }
        
        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            background: #4a5568;
            color: #e2e8f0;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 1px solid #667eea;
        }
        
        .nav-btn:hover {
            background: #5a6575;
            transform: translateY(-2px);
        }
        
        .nav-btn.active {
            background: #667eea;
            color: white;
        }
        
        .chart-container {
            background: #2d3748;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            height: 480px; 
            position: relative;
            border: 1px solid #4a5568;
        }
        
        .chart-title {
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.5rem;
            color: #e2e8f0;
        }
    
        .chart-wrapper {
            position: absolute;
            top: 70px;
            bottom: 20px;
            left: 20px;
            right: 20px;
        }
        
        .period-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .period-btn {
            padding: 8px 16px;
            border: 2px solid #667eea;
            border-radius: 20px;
            background: #2d3748;
            color: #667eea;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .period-btn.active {
            background: #667eea;
            color: white;
        }
        
        .save-btn {
            display: block;
            width: 200px;
            margin: 30px auto;
            padding: 15px;
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(72, 187, 120, 0.4);
        }
    
        .training-details {
            margin-top: 10px;
            padding: 15px;
            background: #4a5568;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .training-details input {
            width: 100%;
            padding: 8px;
            background: #2d3748;
            border: 2px solid #718096;
            border-radius: 6px;
            font-size: 0.95rem;
            margin-top: 5px;
            color: #e2e8f0;
        }
        
        .run-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
            padding: 15px;
            background: #4a5568;
            border-radius: 8px;
            border-left: 4px solid #48bb78;
        }
        
        .run-detail-item {
            display: flex;
            flex-direction: column;
        }
        
        .run-detail-item label {
            font-size: 0.9rem;
            color: #cbd5e0;
            margin-bottom: 5px;
        }
        
        .run-detail-item input,
        .run-detail-item select {
            padding: 8px;
            background: #2d3748;
            border: 2px solid #718096;
            border-radius: 6px;
            font-size: 0.95rem;
            color: #e2e8f0;
        }
        
        .run-detail-item select {
            cursor: pointer;
            background: #2d3748;
        }
        
        .bodyweight-goals {
            background: rgba(45, 55, 72, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-top: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            border: 1px solid #4a5568;
        }
        
        .bodyweight-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #e2e8f0;
            text-align: center;
        }
        
        .bodyweight-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .bodyweight-item {
            display: flex;
            flex-direction: column;
        }
        
        .bodyweight-item label {
            font-size: 0.9rem;
            color: #cbd5e0;
            margin-bottom: 5px;
        }
        
        .bodyweight-item input {
            padding: 10px;
            background: #2d3748;
            border: 2px solid #718096;
            border-radius: 6px;
            font-size: 1rem;
            color: #e2e8f0;
        }
        
        .bodyweight-goal-display {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #4a5568;
        }
        
        .bodyweight-goal {
            text-align: center;
            flex: 1;
        }
        
        .bodyweight-goal-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .bodyweight-goal-label {
            font-size: 0.8rem;
            color: #a0aec0;
        }
        
        .training-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: #667eea;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .training-toggle:hover {
            background: #5a6fd8;
        }
        
        .training-toggle i {
            transition: transform 0.3s ease;
        }
        
        .training-toggle.collapsed i {
            transform: rotate(-90deg);
        }
        
        .training-content {
            max-height: 1000px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .training-content.collapsed {
            max-height: 0;
        }
        
        .overall-consistency {
            background: rgba(45, 55, 72, 0.95);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            border: 1px solid #4a5568;
        }
        
        .overall-consistency-value {
            font-size: 3rem;
            font-weight: bold;
            color: #48bb78;
            margin: 10px 0;
        }
        
        .overall-consistency-label {
            font-size: 1.1rem;
            color: #cbd5e0;
        }
        
        .consistency-percentage {
            font-size: 0.9rem;
            color: #a0aec0;
            margin-left: 5px;
        }
        
        .habit-consistency {
            font-size: 0.8rem;
            color: #a0aec0;
            margin-top: 2px;
        }
        
        /* NEW STYLES FOR ADDED FEATURES - Updated for Dark Mode */
        .training-session-item {
            background: #4a5568;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }
        
        .training-session-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .training-session-type {
            font-weight: 600;
            color: #667eea;
        }
        
        .remove-training-btn {
            background: #f56565;
            color: white;
            border: none;
            border-radius: 5px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .remove-training-btn:hover {
            background: #c53030;
        }
        
        .training-fields-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .training-field {
            display: flex;
            flex-direction: column;
        }
        
        .training-field label {
            font-size: 0.85rem;
            color: #cbd5e0;
            margin-bottom: 3px;
        }
        
        .training-field input,
        .training-field select {
            padding: 8px;
            background: #2d3748;
            border: 2px solid #718096;
            border-radius: 6px;
            font-size: 0.9rem;
            color: #e2e8f0;
        }
        
        .training-field select {
            cursor: pointer;
        }
        
        .add-training-btn {
            width: 100%;
            padding: 10px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 10px;
            transition: all 0.3s ease;
        }
        
        .add-training-btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        
        .hygiene-options {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .hygiene-option {
            flex: 1;
            text-align: center;
        }
        
        .hygiene-option input {
            display: none;
        }
        
        .hygiene-option label {
            display: block;
            padding: 8px;
            background: #2d3748;
            border: 2px solid #718096;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            color: #e2e8f0;
        }
        
        .hygiene-option input:checked + label {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .new-goal-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background: #2d3748;
            border: 2px solid #718096;
            border-radius: 6px;
            margin-top: 10px;
            transition: all 0.3s ease;
        }
        
        .new-goal-checkbox:hover {
            border-color: #667eea;
        }
        
        .new-goal-checkbox input {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .new-goal-checkbox label {
            flex: 1;
            margin: 0;
            cursor: pointer;
            font-weight: 500;
            color: #e2e8f0;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .input-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .sidebar {
                position: static;
                max-height: none;
            }
            
            .sleep-expanded, .training-expanded {
                grid-column: span 1;
            }
            
            .sleep-details {
                grid-template-columns: 1fr;
            }
        }
        
        /* Custom Scrollbar for Dark Mode */
        .points-breakdown::-webkit-scrollbar,
        .sidebar::-webkit-scrollbar {
            width: 8px;
        }
        
        .points-breakdown::-webkit-scrollbar-track,
        .sidebar::-webkit-scrollbar-track {
            background: #2d3748;
            border-radius: 4px;
        }
        
        .points-breakdown::-webkit-scrollbar-thumb,
        .sidebar::-webkit-scrollbar-thumb {
            background: #4a5568;
            border-radius: 4px;
        }
        
        .points-breakdown::-webkit-scrollbar-thumb:hover,
        .sidebar::-webkit-scrollbar-thumb:hover {
            background: #5a6575;
        }
    </style>
    <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåü LifeTracker Pro</h1>
            <div class="date-display" id="currentDate"></div>
        </div>
        <div class="main-content">
            <div class="tracking-section">
                <div class="input-grid">
                    <div class="input-group"><label for="stretching">üßò Stretching Sessions</label> <input type="number" id="stretching" placeholder="Enter sessions"></div>
                    <div class="input-group"><label for="steps">üëü Steps Taken</label> <input type="number" id="steps" placeholder="Enter steps"></div>
                    <div class="input-group sleep-expanded">
                        <label for="sleepHours">üò¥ Sleep Time</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                            <div>
                                <label for="sleepHours" style="font-size: 0.9rem; color: #666;">Hours</label>
                                <input type="number" id="sleepHours" step="0.5" placeholder="Hours" min="0" max="24">
                            </div>
                            <div>
                                <label for="sleepMinutes" style="font-size: 0.9rem; color: #666;">Minutes</label>
                                <input type="number" id="sleepMinutes" placeholder="Minutes" min="0" max="59">
                            </div>
                        </div>
                        <div class="sleep-details">
                            <div class="sleep-detail-item">
                                <label for="sleepQuality">Quality (1-100)</label>
                                <input type="number" id="sleepQuality" min="1" max="100" placeholder="Rate 1-100">
                            </div>
                            
                            <div class="sleep-detail-item">
                                <label>REM Sleep</label>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                                    <input type="number" id="remHours" placeholder="H" min="0" max="24" style="text-align: center;">
                                    <input type="number" id="remMinutes" placeholder="M" min="0" max="59" style="text-align: center;">
                                </div>
                            </div>
                            
                            <div class="sleep-detail-item">
                                <label>Deep Sleep</label>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                                    <input type="number" id="deepHours" placeholder="H" min="0" max="24" style="text-align: center;">
                                    <input type="number" id="deepMinutes" placeholder="M" min="0" max="59" style="text-align: center;">
                                </div>
                            </div>
                            
                            <div class="sleep-detail-item">
                                <label>Light Sleep</label>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                                    <input type="number" id="lightHours" placeholder="H" min="0" max="24" style="text-align: center;">
                                    <input type="number" id="lightMinutes" placeholder="M" min="0" max="59" style="text-align: center;">
                                </div>
                            </div>
                            
                            <div class="checkbox-group" style="margin-top: 10px;">
                                <input type="checkbox" id="napped">
                                <label for="napped">Took a nap today</label>
                            </div>
                        </div>
                    </div>
                    <div class="input-group"><label for="water">üíß Water (Liters)</label> <input type="number" id="water" step="0.1" placeholder="Enter liters"></div>
                    <div class="input-group"><label for="screenTime">üì± Screen Time (Hours)</label> <input type="number" id="screenTime" step="0.5" placeholder="Enter hours"></div>
                    <div class="input-group"><label for="pages">üìö Pages Read</label> <input type="number" id="pages" placeholder="Enter pages"></div>
                    
                    <!-- NEW: Healthy Eating -->
                    <div class="input-group">
                        <label>ü•ó Healthy Eating</label>
                        <div class="new-goal-checkbox">
                            <input type="checkbox" id="healthyEating">
                            <label for="healthyEating">Ate healthy today</label>
                        </div>
                    </div>
                    
                    <!-- NEW: Make Bed -->
                    <div class="input-group">
                        <label>üõèÔ∏è Make Bed</label>
                        <div class="new-goal-checkbox">
                            <input type="checkbox" id="makeBed">
                            <label for="makeBed">Made my bed today</label>
                        </div>
                    </div>
                    
                    <!-- NEW: Hygiene -->
                    <div class="input-group">
                        <label>üßº Daily Hygiene</label>
                        <div class="hygiene-options">
                            <div class="hygiene-option">
                                <input type="radio" id="hygiene0" name="hygiene" value="0">
                                <label for="hygiene0">0 Times</label>
                            </div>
                            <div class="hygiene-option">
                                <input type="radio" id="hygiene1" name="hygiene" value="1">
                                <label for="hygiene1">1 Time</label>
                            </div>
                            <div class="hygiene-option">
                                <input type="radio" id="hygiene2" name="hygiene" value="2">
                                <label for="hygiene2">2 Times</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="input-group training-expanded">
                        <label>üí™ Training Sessions (Goal: 1 per day)</label>
                        
                        <div class="training-toggle" onclick="toggleTrainingDetails()">
                            <span>Training Details</span>
                            <i>‚ñº</i>
                        </div>
                        
                        <div class="training-content" id="trainingContent">
                            <!-- Dynamic training sessions will be added here -->
                            <div id="trainingSessionsContainer"></div>
                            
                            <button class="add-training-btn" onclick="addTrainingSession()">
                                + Add Training Session
                            </button>
                            
                            <!-- Bodyweight Goals -->
                            <div class="bodyweight-goals">
                                <div class="bodyweight-title">üèãÔ∏è Bodyweight Goals</div>
                                <div class="bodyweight-inputs">
                                    <div class="bodyweight-item">
                                        <label for="pushUps">Push-ups Count</label>
                                        <input type="number" id="pushUps" placeholder="Enter push-ups count" min="0">
                                    </div>
                                    <div class="bodyweight-item">
                                        <label for="pullUps">Pull-ups Count</label>
                                        <input type="number" id="pullUps" placeholder="Enter pull-ups count" min="0">
                                    </div>
                                </div>
                                <div class="bodyweight-goal-display">
                                    <div class="bodyweight-goal">
                                        <div class="bodyweight-goal-value" id="pushUpsGoal">0/50</div>
                                        <div class="bodyweight-goal-label">Push-ups Goal</div>
                                    </div>
                                    <div class="bodyweight-goal">
                                        <div class="bodyweight-goal-value" id="pullUpsGoal">0/20</div>
                                        <div class="bodyweight-goal-label">Pull-ups Goal</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="input-group" id="coldShowerGroup"><label>üöø Cold Shower</label>
                        <div class="checkbox-group"><input type="checkbox" id="coldShower"> <label for="coldShower">Took cold shower today</label></div>
                    </div>
                    <div class="input-group" id="lustGroup"><label>üö´ Lust Control</label>
                        <div class="checkbox-group"><input type="checkbox" id="lust"> <label for="lust">Broke lust control (check if failed)</label></div>
                    </div>
                </div>
                <button class="save-btn" onclick="saveData()">üíæ Save Today's Data</button>
                
                <!-- Updated Chart Navigation -->
                <div class="nav-buttons">
                    <button class="nav-btn active" onclick="showChart('stretching')">üßò Stretching</button>
                    <button class="nav-btn" onclick="showChart('steps')">üëü Steps</button>
                    <button class="nav-btn" onclick="showChart('sleep')">üò¥ Sleep</button>
                    <button class="nav-btn" onclick="showChart('water')">üíß Water</button>
                    <button class="nav-btn" onclick="showChart('screenTime')">üì± Screen Time</button>
                    <button class="nav-btn" onclick="showChart('pages')">üìö Reading</button>
                    <button class="nav-btn" onclick="showChart('training')">üí™ Training</button>
                    <button class="nav-btn" onclick="showChart('healthyEating')">ü•ó Healthy</button>
                    <button class="nav-btn" onclick="showChart('makeBed')">üõèÔ∏è Bed</button>
                    <button class="nav-btn" onclick="showChart('hygiene')">üßº Hygiene</button>
                    <button class="nav-btn" onclick="showChart('consistency')">üìä Consistency</button>
                </div>
                
                <div class="chart-container">
                    <div class="period-selector">
                        <button class="period-btn active" onclick="changePeriod('daily')">Daily</button>
                        <button class="period-btn" onclick="changePeriod('weekly')">Weekly</button>
                        <button class="period-btn" onclick="changePeriod('monthly')">Monthly</button>
                    </div>
                    <div class="chart-title" id="chartTitle">Stretching Sessions - Last 7 Days</div>
                    <div class="chart-wrapper">
                        <canvas id="mainChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Sidebar (unchanged) -->
            <div class="sidebar">
                <div class="overall-consistency">
                    <div class="overall-consistency-label">Overall Consistency</div>
                    <div class="overall-consistency-value" id="overallConsistency">0%</div>
                    <div style="font-size: 0.9rem; color: #666;">Your commitment level</div>
                </div>
                
                <div class="points-card">
                    <div class="points-header">
                        <div class="points-title">üéÆ Points System</div>
                        <div class="points-total" id="totalPoints">0</div>
                    </div>
                    <div class="level-indicator">
                        <div class="level-text" id="levelText">Level 1 (0/100)</div>
                        <div class="level-bar">
                            <div class="level-progress" id="levelProgress" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="points-today" id="todayPoints">Today: 0 points</div>
                    <div class="points-breakdown" id="pointsBreakdown">
                        <!-- Points breakdown will be added here by JavaScript -->
                    </div>
                </div>
                
                <div class="sick-section">
                    <div class="sick-title">ü§í Sick Day</div>
                    <div class="sick-toggle" onclick="toggleSick()">
                        <input type="checkbox" class="sick-checkbox" id="sickToggle">
                        <span class="sick-label">I'm sick today</span>
                        <span class="sick-indicator" id="sickIndicator">OFF</span>
                    </div>
                    <div class="sick-note">Pauses streaks for: Steps, Push-ups, Pull-ups, Training. No penalties for missed goals.</div>
                </div>
                
                <div class="rest-section">
                    <div class="rest-title">üõå Rest Day</div>
                    <div class="rest-toggle" onclick="toggleRest()">
                        <input type="checkbox" class="rest-checkbox" id="restToggle">
                        <span class="rest-label">Rest day (running only)</span>
                        <span class="rest-indicator" id="restIndicator">OFF</span>
                    </div>
                    <div class="sick-note">Pauses only running-related streaks. Does not affect gym or bodyweight.</div>
                </div>
                
                <div class="reset-section">
                    <div class="reset-title">‚ö†Ô∏è Reset All Data</div>
                    <button class="reset-btn" onclick="showResetConfirm()">üóëÔ∏è Hard Reset All Data</button>
                    <div class="reset-confirm" id="resetConfirm">
                        <div style="color: #856404; margin-bottom: 10px; font-weight: 600;">
                            ‚ö†Ô∏è Are you sure? This will delete ALL data permanently!
                        </div>
                        <div class="reset-confirm-buttons">
                            <button class="reset-confirm-btn reset-confirm-yes" onclick="hardReset()">Yes, Delete Everything</button>
                            <button class="reset-confirm-btn reset-confirm-no" onclick="hideResetConfirm()">Cancel</button>
                        </div>
                    </div>
                    <div class="reset-note">This will clear all input fields and delete all saved data</div>
                </div>
                
                <div class="quote-card">
                    <div class="quote-text" id="dailyQuote"></div>
                    <div class="quote-author" id="quoteAuthor"></div>
                </div>
                <div class="sleep-card">
                    <div class="consistency-title">üò¥ Sleep Analysis</div>
                    <div id="sleepAnalysis">
                        <div style="text-align: center; color: #888; padding: 20px;">Enter sleep data to see analysis</div>
                    </div>
                </div>
                <div class="consistency-card">
                    <div class="consistency-title">üéØ Today's Goals</div>
                    <div id="consistencyTracker"></div>
                </div>
                <div class="consistency-card">
                    <div class="consistency-title">üî• Consistency Streaks</div>
                    <div id="streakTracker"></div>
                </div>
                <div class="consistency-card">
                    <div class="consistency-title">üìä Habit Consistency</div>
                    <div id="habitConsistency"></div>
                </div>
                <div class="consistency-card">
                    <div class="consistency-title">üìà Total Statistics</div>
                    <div id="totalStats"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Motivational quotes
        const quotes = [
            { text: "The only way to do great work is to love what you do.", author: "Steve Jobs" },
            { text: "Success is not final, failure is not fatal: it is the courage to continue that counts.", author: "Winston Churchill" },
            { text: "The future belongs to those who believe in the beauty of their dreams.", author: "Eleanor Roosevelt" },
            { text: "It is during our darkest moments that we must focus to see the light.", author: "Aristotle" },
            { text: "The only impossible journey is the one you never begin.", author: "Tony Robbins" },
            { text: "In the middle of difficulty lies opportunity.", author: "Albert Einstein" },
            { text: "Believe you can and you're halfway there.", author: "Theodore Roosevelt" },
            { text: "The way to get started is to quit talking and begin doing.", author: "Walt Disney" },
            { text: "Don't watch the clock; do what it does. Keep going.", author: "Sam Levenson" },
            { text: "A year from now you may wish you had started today.", author: "Karen Lamb" }
        ];
        
        // Updated Goals for consistency tracking
        const goals = {
            stretching: 2,
            steps: 10000,
            sleep: 8,
            water: 2,
            screenTime: 2,
            pages: 20,
            training: 1, // CHANGED: Now only 1 training per day required
            pushUps: 50,
            pullUps: 20,
            healthyEating: 1, // NEW: 1 = ate healthy
            makeBed: 1, // NEW: 1 = made bed
            hygiene: 2 // NEW: goal is 2 times per day
        };
        
        // Training types
        const trainingTypes = ['gym', 'home', 'run'];
        const trainingLabels = {
            'gym': 'üèãÔ∏è Gym Session',
            'home': 'üè† Home Workout',
            'run': 'üèÉ Running Session'
        };
        
        // Sick/Rest day storage
        let sickRestDays = JSON.parse(localStorage.getItem('sickRestDays')) || {
            sick: { active: false, history: [] },
            rest: { active: false, history: [] }
        };
        
        // Inactivity tracking
        let inactivityTracker = JSON.parse(localStorage.getItem('inactivityTracker')) || {};
        let currentChart = null;
        let currentView = 'stretching';
        let currentPeriod = 'daily';
        let trainingSessionCounter = 0;
        let todayDataSaved = false; // NEW: Track if data is saved for today
        
        // Updated Points System Configuration
        const pointsConfig = {
            // Base points for completing goals
            stretching: 18,
            steps: 25,
            sleep: 45,
            water: 22,
            screenTime: 45,
            pages: 18,
            training: 40,
            coldShower: 25,
            lustControl: 55,
            pushUps: 20,
            pullUps: 20,
            healthyEating: 35,
            makeBed: 15,
            hygiene: 25,

            
            // Deductions for missing goals
            stretchingDeduction: -40,
            stepsDeduction: -55,
            waterDeduction: -35,
            screenTimeDeduction: -70,
            pagesDeduction: -40,
            pushUpsDeduction: -40,
            pullUpsDeduction: -40,
            trainingDeduction: -60,
            healthyEatingDeduction: -55,
            makeBedDeduction: -35,
            hygieneDeduction: -40,
            hygienePartialDeduction: -25,
            
            // Sleep strict rules
            sleepQualityBonus: 40,
            sleepDurationDeduction: -35,
            sleepQualityDeduction: -45,
            
            // Bodyweight bonus multiplier
            bodyweightBothBonus: 1.7,
            
            // Training bonuses
            durationBonus: 25,
            intensityBonus: 30,
            extraTrainingBonus: 12, // Bonus for each extra training beyond the first
            
            // Steps overachievement
            stepsMultiplierPer1500: 0.2,
            maxStepsMultipliers: 5,
            
            // Streak multipliers
            streakMultipliers: {
                3: 1.3,
                7: 1.6,
                14: 2.2
            },
            
            // Inactivity penalty
            inactivityPenalty: -60,
            
            // Consistency bonuses
            weeklyConsistencyBonus: 85,
            
            dailyCompletionBonus: 110
        };
        
            
            // NEW: Activity pause tracking
            let activityPauses = JSON.parse(localStorage.getItem('activityPauses')) || {
                pullUps: { active: false, startDate: null, endDate: null },
                coldShower: { active: false, startDate: null, endDate: null }
            };
            
            let inactivityTracker = JSON.parse(localStorage.getItem('inactivityTracker')) || {};
            let currentChart = null;
            let currentView = 'stretching';
            let currentPeriod = 'daily';
            let trainingSessionCounter = 0;
            let todayDataSaved = false;
            let currentDateOffset = 0; // NEW: 0 = today, -1 = yesterday, etc.
    
            // ==================== INITIALIZATION ====================
            document.addEventListener('DOMContentLoaded', function() {
                displayCurrentDate();
                displayDailyQuote();
                loadTodaysData();
                initializeApp();
            });
            
            function initializeApp() {
                updateConsistencyTracker();
                updateStreakTracker();
                updateTotalStats();
                updatePointsDisplay();
                updateHabitConsistency();
                initializeChart();
                updateSickRestDisplay();
                updateActivityPauseDisplay(); // NEW
                
                // Add initial training session if none exist
                const container = document.getElementById('trainingSessionsContainer');
                if (container.children.length === 0 && !todayDataSaved) {
                    addTrainingSession();
                }
                
                setupEventListeners();
            }
            
            function setupEventListeners() {
                // Bodyweight inputs
                document.getElementById('pushUps').addEventListener('input', function() {
                    if (!todayDataSaved) {
                        updateBodyweightGoals();
                        updateConsistencyTracker();
                        updatePointsDisplay();
                    }
                });
                
                document.getElementById('pullUps').addEventListener('input', function() {
                    if (!todayDataSaved) {
                        updateBodyweightGoals();
                        updateConsistencyTracker();
                        updatePointsDisplay();
                    }
                });
                
                // General inputs
                ['stretching', 'steps', 'sleepHours', 'water', 'screenTime', 'pages'].forEach(id => {
                    document.getElementById(id).addEventListener('input', function() {
                        if (!todayDataSaved) {
                            updateConsistencyTracker();
                            updatePointsDisplay();
                        }
                    });
                });
                
                // Sleep inputs
                ['sleepHours', 'sleepMinutes', 'sleepQuality', 'remHours', 'remMinutes', 
                 'deepHours', 'deepMinutes', 'lightHours', 'lightMinutes'].forEach(id => {
                    document.getElementById(id).addEventListener('input', function() {
                        if (!todayDataSaved) {
                            updateSleepAnalysis();
                            updateConsistencyTracker();
                            updatePointsDisplay();
                        }
                    });
                });
                
                // Checkboxes
                ['coldShower', 'lust', 'napped', 'healthyEating', 'makeBed'].forEach(id => {
                    document.getElementById(id).addEventListener('change', function() {
                        if (!todayDataSaved) {
                            if (id === 'coldShower' || id === 'lust') updateCheckboxStyles();
                            if (id === 'napped') updateSleepAnalysis();
                            updateConsistencyTracker();
                            updatePointsDisplay();
                        }
                    });
                });
                
                // Hygiene radio buttons
                document.querySelectorAll('input[name="hygiene"]').forEach(radio => {
                    radio.addEventListener('change', function() {
                        if (!todayDataSaved) {
                            updateConsistencyTracker();
                            updatePointsDisplay();
                        }
                    });
                });
                
                // Initialize displays
                updateSleepAnalysis();
                updateBodyweightGoals();
            }
            
            // ==================== DATE NAVIGATION ====================
            function displayCurrentDate() {
                const targetDate = new Date();
                targetDate.setDate(targetDate.getDate() + currentDateOffset);
                
                const options = { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                };
                
                const dateDisplay = document.getElementById('currentDate');
                dateDisplay.textContent = targetDate.toLocaleDateString('en-US', options);
                
                // Update date navigation buttons
                updateDateNavigation();
            }
            
            function updateDateNavigation() {
                const prevBtn = document.getElementById('prevDayBtn');
                const nextBtn = document.getElementById('nextDayBtn');
                const todayBtn = document.getElementById('todayBtn');
                
                // Show/hide buttons based on offset
                prevBtn.style.display = currentDateOffset <= -7 ? 'none' : 'flex';
                nextBtn.style.display = currentDateOffset >= 0 ? 'none' : 'flex';
                todayBtn.style.display = currentDateOffset < 0 ? 'flex' : 'none';
                
                // Update button states
                if (prevBtn) {
                    prevBtn.disabled = currentDateOffset <= -7;
                    prevBtn.style.opacity = currentDateOffset <= -7 ? '0.5' : '1';
                }
                
                if (nextBtn) {
                    nextBtn.disabled = currentDateOffset >= 0;
                    nextBtn.style.opacity = currentDateOffset >= 0 ? '0.5' : '1';
                }
                
                // Show date offset indicator
                const offsetDisplay = document.getElementById('dateOffsetDisplay');
                if (offsetDisplay) {
                    if (currentDateOffset === 0) {
                        offsetDisplay.textContent = 'Today';
                        offsetDisplay.style.color = '#48bb78';
                    } else if (currentDateOffset === -1) {
                        offsetDisplay.textContent = 'Yesterday';
                        offsetDisplay.style.color = '#f6ad55';
                    } else if (currentDateOffset < -1) {
                        offsetDisplay.textContent = `${Math.abs(currentDateOffset)} days ago`;
                        offsetDisplay.style.color = '#a0aec0';
                    }
                }
            }
            
            function goToPreviousDay() {
                if (currentDateOffset > -7) {
                    currentDateOffset--;
                    loadDateData();
                    displayCurrentDate();
                }
            }
            
            function goToNextDay() {
                if (currentDateOffset < 0) {
                    currentDateOffset++;
                    loadDateData();
                    displayCurrentDate();
                }
            }
            
            function goToToday() {
                currentDateOffset = 0;
                loadDateData();
                displayCurrentDate();
            }
            
            function getTargetDate() {
                const targetDate = new Date();
                targetDate.setDate(targetDate.getDate() + currentDateOffset);
                return targetDate.toISOString().split('T')[0];
            }
            
            // ==================== LOAD DATA FOR SPECIFIC DATE ====================
            function loadDateData() {
                const targetDate = getTargetDate();
                const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
                const dateData = allData[targetDate];
                
                // Check if data exists for this date
                const today = new Date().toISOString().split('T')[0];
                const isToday = targetDate === today;
                
                if (dateData) {
                    todayDataSaved = true;
                    populateInputFields(dateData);
                    disableAllInputs();
                    updateConsistencyTrackerWithSavedData(dateData);
                    updateSleepAnalysisWithSavedData(dateData);
                    updateBodyweightGoalsWithSavedData(dateData);
                    populateTrainingSessions(dateData);
                    
                    // Update save button text
                    const saveBtn = document.querySelector('.save-btn');
                    if (saveBtn) {
                        saveBtn.textContent = 'üìÖ Viewing Saved Data';
                        saveBtn.style.background = 'linear-gradient(135deg, #718096, #4a5568)';
                        saveBtn.disabled = true;
                    }
                } else {
                    todayDataSaved = false;
                    clearInputFields();
                    enableAllInputs();
                    
                    // Update save button based on whether it's today or past
                    const saveBtn = document.querySelector('.save-btn');
                    if (saveBtn) {
                        if (isToday) {
                            saveBtn.textContent = 'üíæ Save Today\'s Data';
                            saveBtn.disabled = false;
                        } else {
                            saveBtn.textContent = 'üíæ Save Data for This Date';
                            saveBtn.disabled = false;
                        }
                        saveBtn.style.background = 'linear-gradient(135deg, #48bb78, #38a169)';
                    }
                    
                    updateConsistencyTracker();
                    updateSleepAnalysis();
                    updateBodyweightGoals();
                }
                
                // Update points display for this date
                updatePointsDisplay();
            }
            
            function loadTodaysData() {
                currentDateOffset = 0;
                loadDateData();
            }
            
            function clearInputFields() {
                // Clear basic inputs
                ['stretching', 'steps', 'sleepHours', 'sleepMinutes', 'water', 'screenTime', 'pages', 
                 'sleepQuality', 'remHours', 'remMinutes', 'deepHours', 'deepMinutes', 
                 'lightHours', 'lightMinutes', 'pushUps', 'pullUps'].forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.value = '';
                });
                
                // Clear training sessions
                const container = document.getElementById('trainingSessionsContainer');
                container.innerHTML = '';
                trainingSessionCounter = 0;
                
                // Clear checkboxes
                ['coldShower', 'lust', 'napped', 'healthyEating', 'makeBed'].forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.checked = false;
                });
                
                // Clear hygiene radios
                document.querySelectorAll('input[name="hygiene"]').forEach(radio => {
                    radio.checked = false;
                });
                
                // Add default training session
                if (!todayDataSaved) {
                    addTrainingSession();
                }
                
                updateCheckboxStyles();
                updateSleepAnalysis();
                updateBodyweightGoals();
            }
            
            // ==================== BASIC FUNCTIONS ====================
            function displayDailyQuote() {
                const today = new Date();
                const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
                const quoteIndex = dayOfYear % quotes.length;
                document.getElementById('dailyQuote').textContent = `"${quotes[quoteIndex].text}"`;
                document.getElementById('quoteAuthor').textContent = `‚Äî ${quotes[quoteIndex].author}`;
            }
            
            function toggleTrainingDetails() {
                const content = document.getElementById('trainingContent');
                const toggle = document.querySelector('.training-toggle');
                const isCollapsed = content.classList.contains('collapsed');
                
                if (isCollapsed) {
                    content.classList.remove('collapsed');
                    toggle.classList.remove('collapsed');
                } else {
                    content.classList.add('collapsed');
                    toggle.classList.add('collapsed');
                }
            }
            
            function updateCheckboxStyles() {
                if (todayDataSaved) return;
                
                const coldShowerGroup = document.getElementById('coldShowerGroup');
                const lustGroup = document.getElementById('lustGroup');
                const coldShowerChecked = document.getElementById('coldShower').checked;
                const lustChecked = document.getElementById('lust').checked;
                
                coldShowerGroup.classList.toggle('cold-shower-checked', coldShowerChecked);
                lustGroup.classList.toggle('lust-checked', lustChecked);
            }
            
            function updateBodyweightGoals() {
                if (todayDataSaved) return;
                
                const pushUps = parseInt(document.getElementById('pushUps').value) || 0;
                const pullUps = parseInt(document.getElementById('pullUps').value) || 0;
                
                document.getElementById('pushUpsGoal').textContent = `${pushUps}/${goals.pushUps}`;
                document.getElementById('pullUpsGoal').textContent = `${pullUps}/${goals.pullUps}`;
            }
            
            // ==================== ACTIVITY PAUSE SYSTEM ====================
            function togglePullUpsPause() {
                const isActive = activityPauses.pullUps.active;
                activityPauses.pullUps.active = !isActive;
                
                if (activityPauses.pullUps.active) {
                    activityPauses.pullUps.startDate = getTargetDate();
                } else {
                    activityPauses.pullUps.endDate = getTargetDate();
                }
                
                localStorage.setItem('activityPauses', JSON.stringify(activityPauses));
                updateActivityPauseDisplay();
                updateConsistencyTracker();
                updatePointsDisplay();
                updateStreakTracker();
            }
            
            function toggleColdShowerPause() {
                const isActive = activityPauses.coldShower.active;
                activityPauses.coldShower.active = !isActive;
                
                if (activityPauses.coldShower.active) {
                    activityPauses.coldShower.startDate = getTargetDate();
                } else {
                    activityPauses.coldShower.endDate = getTargetDate();
                }
                
                localStorage.setItem('activityPauses', JSON.stringify(activityPauses));
                updateActivityPauseDisplay();
                updateConsistencyTracker();
                updatePointsDisplay();
                updateStreakTracker();
            }
            
            function updateActivityPauseDisplay() {
                const pullUpsToggle = document.getElementById('pullUpsPauseToggle');
                const pullUpsIndicator = document.getElementById('pullUpsPauseIndicator');
                const pullUpsElement = document.querySelector('.pullups-pause-toggle');
                
                const coldShowerToggle = document.getElementById('coldShowerPauseToggle');
                const coldShowerIndicator = document.getElementById('coldShowerPauseIndicator');
                const coldShowerElement = document.querySelector('.coldshower-pause-toggle');
                
                // Pull-ups pause
                pullUpsToggle.checked = activityPauses.pullUps.active;
                pullUpsIndicator.textContent = activityPauses.pullUps.active ? 'PAUSED' : 'ACTIVE';
                pullUpsElement.classList.toggle('active', activityPauses.pullUps.active);
                
                // Cold shower pause
                coldShowerToggle.checked = activityPauses.coldShower.active;
                coldShowerIndicator.textContent = activityPauses.coldShower.active ? 'PAUSED' : 'ACTIVE';
                coldShowerElement.classList.toggle('active', activityPauses.coldShower.active);
            }
            
            function isActivityPaused(activityKey, date = null) {
                const pause = activityPauses[activityKey];
                if (!pause || !pause.active) return false;
                
                const targetDate = date || getTargetDate();
                
                // Check if this date falls within the pause period
                if (pause.startDate && pause.endDate) {
                    return targetDate >= pause.startDate && targetDate <= pause.endDate;
                } else if (pause.startDate) {
                    // Ongoing pause
                    return targetDate >= pause.startDate;
                }
                
                return false;
            }
            
            // ==================== SICK/REST DAYS ====================
            function toggleSick() {
                if (todayDataSaved) return;
                
                const isActive = sickRestDays.sick.active;
                sickRestDays.sick.active = !isActive;
                
                if (sickRestDays.sick.active) {
                    sickRestDays.sick.history.push(getTargetDate());
                }
                
                localStorage.setItem('sickRestDays', JSON.stringify(sickRestDays));
                updateSickRestDisplay();
                updateConsistencyTracker();
                updatePointsDisplay();
                updateStreakTracker();
            }
            
            function toggleRest() {
                if (todayDataSaved) return;
                
                const isActive = sickRestDays.rest.active;
                sickRestDays.rest.active = !isActive;
                
                if (sickRestDays.rest.active) {
                    sickRestDays.rest.history.push(getTargetDate());
                }
                
                localStorage.setItem('sickRestDays', JSON.stringify(sickRestDays));
                updateSickRestDisplay();
                updateConsistencyTracker();
                updatePointsDisplay();
                updateStreakTracker();
            }
            
            function updateSickRestDisplay() {
                const sickToggle = document.getElementById('sickToggle');
                const sickIndicator = document.getElementById('sickIndicator');
                const sickElement = document.querySelector('.sick-toggle');
                
                const restToggle = document.getElementById('restToggle');
                const restIndicator = document.getElementById('restIndicator');
                const restElement = document.querySelector('.rest-toggle');
                
                sickToggle.checked = sickRestDays.sick.active;
                sickIndicator.textContent = sickRestDays.sick.active ? 'ACTIVE' : 'OFF';
                sickElement.classList.toggle('active', sickRestDays.sick.active);
                
                restToggle.checked = sickRestDays.rest.active;
                restIndicator.textContent = sickRestDays.rest.active ? 'ACTIVE' : 'OFF';
                restElement.classList.toggle('active', sickRestDays.rest.active);
            }
            
            function isGoalPaused(goalKey) {
                const targetDate = getTargetDate();
                
                // Check sick days
                if (sickRestDays.sick.active) {
                    return ['steps', 'pushUps', 'pullUps', 'training'].includes(goalKey);
                }
                
                // Check rest days
                if (sickRestDays.rest.active) {
                    return goalKey === 'training';
                }
                
                // Check activity pauses
                if (goalKey === 'pullUps' && isActivityPaused('pullUps', targetDate)) {
                    return true;
                }
                
                if (goalKey === 'coldShower' && isActivityPaused('coldShower', targetDate)) {
                    return true;
                }
                
                return false;
            }
            
            // ==================== TRAINING SESSIONS ====================
            function addTrainingSession(type = 'gym') {
                if (todayDataSaved) return;
                
                trainingSessionCounter++;
                const container = document.getElementById('trainingSessionsContainer');
                
                const sessionDiv = document.createElement('div');
                sessionDiv.className = 'training-session-item';
                sessionDiv.id = `training-session-${trainingSessionCounter}`;
                
                sessionDiv.innerHTML = `
                    <div class="training-session-header">
                        <div class="training-session-type">${trainingLabels[type]} ${trainingSessionCounter}</div>
                        <button class="remove-training-btn" onclick="removeTrainingSession(${trainingSessionCounter})">√ó</button>
                    </div>
                    <div class="training-fields-grid">
                        <div class="training-field">
                            <label for="sessionType-${trainingSessionCounter}">Type</label>
                            <select id="sessionType-${trainingSessionCounter}" onchange="updateSessionType(${trainingSessionCounter})">
                                <option value="gym" ${type === 'gym' ? 'selected' : ''}>Gym</option>
                                <option value="home" ${type === 'home' ? 'selected' : ''}>Home Workout</option>
                                <option value="run" ${type === 'run' ? 'selected' : ''}>Running</option>
                            </select>
                        </div>
                        <div class="training-field">
                            <label for="sessionDuration-${trainingSessionCounter}">Duration (min)</label>
                            <input type="number" id="sessionDuration-${trainingSessionCounter}" placeholder="Minutes" min="0" oninput="updateTrainingStats()">
                        </div>
                        <div class="training-field">
                            <label for="sessionIntensity-${trainingSessionCounter}">Intensity (1-10)</label>
                            <input type="number" id="sessionIntensity-${trainingSessionCounter}" min="1" max="10" placeholder="1-10" oninput="updateTrainingStats()">
                        </div>
                        ${type === 'run' ? `
                        <div class="training-field">
                            <label for="sessionDistance-${trainingSessionCounter}">Distance (km)</label>
                            <input type="number" id="sessionDistance-${trainingSessionCounter}" step="0.1" placeholder="Distance" oninput="updateTrainingStats()">
                        </div>
                        ` : ''}
                    </div>
                    <div style="margin-top: 10px; font-size: 0.85rem; color: #a0aec0;">
                        ${type === 'gym' ? 'üèãÔ∏è Gym session' : type === 'home' ? 'üè† Home workout' : 'üèÉ Running session'}
                    </div>
                `;
                
                container.appendChild(sessionDiv);
                updateTrainingStats();
            }
            
            function removeTrainingSession(id) {
                if (todayDataSaved) return;
                
                const session = document.getElementById(`training-session-${id}`);
                if (session) {
                    session.remove();
                    updateTrainingStats();
                }
            }
            
            function updateSessionType(id) {
                if (todayDataSaved) return;
                
                const select = document.getElementById(`sessionType-${id}`);
                const type = select.value;
                const sessionDiv = document.getElementById(`training-session-${id}`);
                
                const typeLabel = sessionDiv.querySelector('.training-session-type');
                typeLabel.textContent = `${trainingLabels[type]} ${id}`;
                
                const desc = sessionDiv.querySelector('div[style*="margin-top: 10px"]');
                desc.textContent = type === 'gym' ? 'üèãÔ∏è Gym session' : type === 'home' ? 'üè† Home workout' : 'üèÉ Running session';
                
                const fieldsGrid = sessionDiv.querySelector('.training-fields-grid');
                const existingDistanceField = document.getElementById(`sessionDistance-${id}`);
                
                if (type === 'run') {
                    if (!existingDistanceField) {
                        const distanceField = document.createElement('div');
                        distanceField.className = 'training-field';
                        distanceField.innerHTML = `
                            <label for="sessionDistance-${id}">Distance (km)</label>
                            <input type="number" id="sessionDistance-${id}" step="0.1" placeholder="Distance" oninput="updateTrainingStats()">
                        `;
                        fieldsGrid.appendChild(distanceField);
                    }
                } else {
                    if (existingDistanceField) {
                        existingDistanceField.parentElement.remove();
                    }
                }
                
                updateTrainingStats();
            }
            
            function updateTrainingStats() {
                if (!todayDataSaved) {
                    updateConsistencyTracker();
                    updatePointsDisplay();
                }
            }
            
            function getAllTrainingSessions() {
                const sessions = [];
                
                for (let i = 1; i <= trainingSessionCounter; i++) {
                    const sessionDiv = document.getElementById(`training-session-${i}`);
                    if (!sessionDiv) continue;
                    
                    const type = document.getElementById(`sessionType-${i}`)?.value || 'gym';
                    const duration = parseInt(document.getElementById(`sessionDuration-${i}`)?.value) || 0;
                    const intensity = parseInt(document.getElementById(`sessionIntensity-${i}`)?.value) || 0;
                    const distance = type === 'run' ? parseFloat(document.getElementById(`sessionDistance-${i}`)?.value) || 0 : 0;
                    
                    sessions.push({
                        id: i,
                        type,
                        duration,
                        intensity,
                        distance,
                        completed: duration > 0 || (type === 'run' && distance > 0)
                    });
                }
                
                return sessions;
            }
            
            // ==================== DATA MANAGEMENT ====================
            function getCurrentInputs() {
                // Sleep calculations
                const sleepHours = parseFloat(document.getElementById('sleepHours').value) || 0;
                const sleepMinutes = parseFloat(document.getElementById('sleepMinutes').value) || 0;
                const totalSleepHours = sleepHours + (sleepMinutes / 60);
                
                const remHours = parseFloat(document.getElementById('remHours').value) || 0;
                const remMinutes = parseFloat(document.getElementById('remMinutes').value) || 0;
                const totalRemMinutes = (remHours * 60) + remMinutes;
                
                const deepHours = parseFloat(document.getElementById('deepHours').value) || 0;
                const deepMinutes = parseFloat(document.getElementById('deepMinutes').value) || 0;
                const totalDeepMinutes = (deepHours * 60) + deepMinutes;
                
                const lightHours = parseFloat(document.getElementById('lightHours').value) || 0;
                const lightMinutes = parseFloat(document.getElementById('lightMinutes').value) || 0;
                const totalLightMinutes = (lightHours * 60) + lightMinutes;
                
                // Bodyweight
                const pushUps = parseInt(document.getElementById('pushUps').value) || 0;
                const pullUps = parseInt(document.getElementById('pullUps').value) || 0;
                
                // Hygiene
                let hygiene = 0;
                const hygieneRadio = document.querySelector('input[name="hygiene"]:checked');
                if (hygieneRadio) {
                    hygiene = parseInt(hygieneRadio.value) || 0;
                }
                
                // Training sessions
                const trainingSessions = getAllTrainingSessions();
                const completedTrainings = trainingSessions.filter(s => s.completed).length;
                
                return {
                    // Basic inputs
                    stretching: parseInt(document.getElementById('stretching').value) || 0,
                    steps: parseInt(document.getElementById('steps').value) || 0,
                    sleep: totalSleepHours,
                    sleepHours: sleepHours,
                    sleepMinutes: sleepMinutes,
                    sleepQuality: parseInt(document.getElementById('sleepQuality').value) || 0,
                    remSleep: totalRemMinutes,
                    remHours: remHours,
                    remMinutes: remMinutes,
                    deepSleep: totalDeepMinutes,
                    deepHours: deepHours,
                    deepMinutes: deepMinutes,
                    lightSleep: totalLightMinutes,
                    lightHours: lightHours,
                    lightMinutes: lightMinutes,
                    napped: document.getElementById('napped').checked,
                    water: parseFloat(document.getElementById('water').value) || 0,
                    screenTime: parseFloat(document.getElementById('screenTime').value) || 0,
                    pages: parseInt(document.getElementById('pages').value) || 0,
                    coldShower: document.getElementById('coldShower').checked,
                    lust: document.getElementById('lust').checked,
                    
                    // New goals
                    healthyEating: document.getElementById('healthyEating').checked,
                    makeBed: document.getElementById('makeBed').checked,
                    hygiene: hygiene,
                    
                    // Bodyweight
                    pushUps: pushUps,
                    pullUps: pullUps,
                    
                    // Training
                    trainingSessions: trainingSessions,
                    completedTrainings: completedTrainings,
                    totalTrainings: trainingSessions.length,
                    
                    // Pause states for this date
                    pullUpsPaused: isActivityPaused('pullUps'),
                    coldShowerPaused: isActivityPaused('coldShower'),
                    sickDay: sickRestDays.sick.active,
                    restDay: sickRestDays.rest.active
                };
            }
            
            // ==================== INPUT CONTROLS ====================
            function disableAllInputs() {
                // Disable all inputs
                document.querySelectorAll('input, select').forEach(el => {
                    if (el.type !== 'button' && el.type !== 'submit' && !el.classList.contains('toggle-checkbox')) {
                        el.disabled = true;
                        el.style.opacity = '0.7';
                        el.style.cursor = 'not-allowed';
                    }
                });
                
                // Disable training buttons
                const addBtn = document.querySelector('.add-training-btn');
                if (addBtn) {
                    addBtn.disabled = true;
                    addBtn.style.opacity = '0.7';
                    addBtn.style.cursor = 'not-allowed';
                }
                
                document.querySelectorAll('.remove-training-btn').forEach(btn => {
                    btn.disabled = true;
                    btn.style.opacity = '0.7';
                    btn.style.cursor = 'not-allowed';
                });
                
                // Update save button
                const saveBtn = document.querySelector('.save-btn');
                if (saveBtn) {
                    saveBtn.textContent = 'üìÖ Viewing Saved Data';
                    saveBtn.style.background = 'linear-gradient(135deg, #718096, #4a5568)';
                    saveBtn.style.cursor = 'not-allowed';
                    saveBtn.disabled = true;
                }
            }
            
            function enableAllInputs() {
                // Enable all inputs
                document.querySelectorAll('input, select').forEach(el => {
                    if (el.type !== 'button' && el.type !== 'submit' && !el.classList.contains('toggle-checkbox')) {
                        el.disabled = false;
                        el.style.opacity = '1';
                        el.style.cursor = el.type === 'checkbox' || el.type === 'radio' ? 'pointer' : 'text';
                    }
                });
                
                // Enable training buttons
                const addBtn = document.querySelector('.add-training-btn');
                if (addBtn) {
                    addBtn.disabled = false;
                    addBtn.style.opacity = '1';
                    addBtn.style.cursor = 'pointer';
                }
                
                document.querySelectorAll('.remove-training-btn').forEach(btn => {
                    btn.disabled = false;
                    btn.style.opacity = '1';
                    btn.style.cursor = 'pointer';
                });
                
                // Reset save button based on date
                const saveBtn = document.querySelector('.save-btn');
                if (saveBtn) {
                    if (currentDateOffset === 0) {
                        saveBtn.textContent = 'üíæ Save Today\'s Data';
                    } else {
                        saveBtn.textContent = 'üíæ Save Data for This Date';
                    }
                    saveBtn.style.background = 'linear-gradient(135deg, #48bb78, #38a169)';
                    saveBtn.style.cursor = 'pointer';
                    saveBtn.disabled = false;
                }
            }
            
            // ==================== POPULATE/SAVE DATA ====================
            function populateInputFields(data) {
                // Basic inputs
                if (data.stretching !== undefined) document.getElementById('stretching').value = data.stretching;
                if (data.steps !== undefined) document.getElementById('steps').value = data.steps;
                if (data.sleepHours !== undefined) document.getElementById('sleepHours').value = data.sleepHours;
                if (data.sleepMinutes !== undefined) document.getElementById('sleepMinutes').value = data.sleepMinutes;
                if (data.water !== undefined) document.getElementById('water').value = data.water;
                if (data.screenTime !== undefined) document.getElementById('screenTime').value = data.screenTime;
                if (data.pages !== undefined) document.getElementById('pages').value = data.pages;
                
                // Sleep analysis
                if (data.sleepQuality !== undefined) document.getElementById('sleepQuality').value = data.sleepQuality;
                if (data.remHours !== undefined) document.getElementById('remHours').value = data.remHours;
                if (data.remMinutes !== undefined) document.getElementById('remMinutes').value = data.remMinutes;
                if (data.deepHours !== undefined) document.getElementById('deepHours').value = data.deepHours;
                if (data.deepMinutes !== undefined) document.getElementById('deepMinutes').value = data.deepMinutes;
                if (data.lightHours !== undefined) document.getElementById('lightHours').value = data.lightHours;
                if (data.lightMinutes !== undefined) document.getElementById('lightMinutes').value = data.lightMinutes;
                
                // Bodyweight
                if (data.pushUps !== undefined) document.getElementById('pushUps').value = data.pushUps;
                if (data.pullUps !== undefined) document.getElementById('pullUps').value = data.pullUps;
                
                // Checkboxes
                if (data.coldShower !== undefined) document.getElementById('coldShower').checked = data.coldShower;
                if (data.lust !== undefined) document.getElementById('lust').checked = data.lust;
                if (data.napped !== undefined) document.getElementById('napped').checked = data.napped;
                if (data.healthyEating !== undefined) document.getElementById('healthyEating').checked = data.healthyEating;
                if (data.makeBed !== undefined) document.getElementById('makeBed').checked = data.makeBed;
                
                // Hygiene radio buttons
                if (data.hygiene !== undefined) {
                    const hygieneRadio = document.querySelector(`input[name="hygiene"][value="${data.hygiene}"]`);
                    if (hygieneRadio) hygieneRadio.checked = true;
                }
                
                updateCheckboxStyles();
                updateSleepAnalysis();
                updateBodyweightGoals();
            }
            
            function populateTrainingSessions(data) {
                const container = document.getElementById('trainingSessionsContainer');
                container.innerHTML = '';
                trainingSessionCounter = 0;
                
                if (data.trainingSessions && data.trainingSessions.length > 0) {
                    data.trainingSessions.forEach(session => {
                        trainingSessionCounter++;
                        addTrainingSession(session.type);
                        
                        // Set values
                        setTimeout(() => {
                            const durationInput = document.getElementById(`sessionDuration-${trainingSessionCounter}`);
                            const intensityInput = document.getElementById(`sessionIntensity-${trainingSessionCounter}`);
                            
                            if (durationInput) durationInput.value = session.duration || '';
                            if (intensityInput) intensityInput.value = session.intensity || '';
                            
                            if (session.type === 'run' && session.distance) {
                                const distanceInput = document.getElementById(`sessionDistance-${trainingSessionCounter}`);
                                if (distanceInput) distanceInput.value = session.distance;
                            }
                        }, 50);
                    });
                }
            }
            
            function saveData() {
                const targetDate = getTargetDate();
                const data = getCurrentInputs();
                
                // Calculate points
                const pointsData = calculateTodayPoints();
                
                // Save activity data
                let allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
                allData[targetDate] = data;
                localStorage.setItem('lifeTrackerData', JSON.stringify(allData));
                
                // Save points
                let pointsHistory = JSON.parse(localStorage.getItem('lifeTrackerPoints')) || { 
                    total: 0, 
                    days: {} 
                };
                
                // Only add points if we haven't saved for this date yet
                if (!pointsHistory.days[targetDate]) {
                    pointsHistory.total = (pointsHistory.total || 0) + pointsData.total;
                    pointsHistory.days[targetDate] = { 
                        points: pointsData.total, 
                        breakdown: pointsData.breakdown,
                        date: targetDate
                    };
                    localStorage.setItem('lifeTrackerPoints', JSON.stringify(pointsHistory));
                } else {
                    // Update existing points for this date
                    const oldPoints = pointsHistory.days[targetDate].points || 0;
                    pointsHistory.total = pointsHistory.total - oldPoints + pointsData.total;
                    pointsHistory.days[targetDate] = { 
                        points: pointsData.total, 
                        breakdown: pointsData.breakdown,
                        date: targetDate
                    };
                    localStorage.setItem('lifeTrackerPoints', JSON.stringify(pointsHistory));
                }
                
                // Reset sick/rest for this date (they're date-specific)
                sickRestDays.sick.active = false;
                sickRestDays.rest.active = false;
                localStorage.setItem('sickRestDays', JSON.stringify(sickRestDays));
                
                // Update inactivity tracker
                updateInactivityTracker(targetDate, data);
                
                // Set saved flag and disable inputs
                todayDataSaved = true;
                disableAllInputs();
                
                // Update UI
                updateChart();
                updateStreakTracker();
                updateTotalStats();
                updatePointsDisplay();
                updateHabitConsistency();
                updateSickRestDisplay();
                updateConsistencyTrackerWithSavedData(data);
                
                // Show success
                const btn = document.querySelector('.save-btn');
                const originalText = btn.textContent;
                btn.textContent = '‚úÖ Data Saved Successfully!';
                btn.style.background = 'linear-gradient(135deg, #48bb78, #38a169)';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 3000);
            }
            
            function updateConsistencyTrackerWithSavedData(data) {
                const tracker = document.getElementById('consistencyTracker');
                let html = '';
                
                // Regular metrics
                Object.keys(goals).forEach(key => {
                    let current, goal, isGood;
                    
                    if (key === 'training') {
                        current = data.completedTrainings;
                        goal = goals.training;
                        isGood = current >= goal;
                    } else if (key === 'pushUps' || key === 'pullUps') {
                        current = parseInt(data[key]) || 0;
                        goal = goals[key];
                        isGood = current >= goal;
                    } else if (key === 'healthyEating' || key === 'makeBed') {
                        current = data[key] ? 1 : 0;
                        goal = goals[key];
                        isGood = current >= goal;
                    } else if (key === 'hygiene') {
                        current = data[key] || 0;
                        goal = goals[key];
                        isGood = current >= goal;
                    } else {
                        current = parseFloat(data[key]) || 0;
                        goal = goals[key];
                        isGood = key === 'screenTime' ? current <= goal : current >= goal;
                    }
                    
                    const status = isGood ? 'good' : 'bad';
                    const icon = isGood ? '‚úì' : '‚úó';
                    
                    let displayName = key.charAt(0).toUpperCase() + key.slice(1);
                    if (key === 'screenTime') displayName = 'Screen Time';
                    if (key === 'pushUps') displayName = 'Push-ups';
                    if (key === 'pullUps') displayName = 'Pull-ups';
                    if (key === 'healthyEating') displayName = 'Healthy Eating';
                    if (key === 'makeBed') displayName = 'Make Bed';
                    
                    // Show actual values
                    let valueDisplay = '';
                    if (key === 'training') {
                        valueDisplay = ` (${current} session${current !== 1 ? 's' : ''})`;
                    } else if (key === 'healthyEating' || key === 'makeBed') {
                        valueDisplay = current ? ' ‚úì' : ' ‚úó';
                    } else if (key === 'hygiene') {
                        valueDisplay = ` (${current} time${current !== 1 ? 's' : ''})`;
                    } else if (key === 'screenTime') {
                        valueDisplay = ` (${current}h)`;
                    } else if (key === 'steps') {
                        valueDisplay = ` (${current.toLocaleString()})`;
                    } else if (key === 'pushUps' || key === 'pullUps') {
                        valueDisplay = ` (${current})`;
                    } else {
                        valueDisplay = ` (${current})`;
                    }
                    
                    html += `
                        <div class="consistency-item">
                            <span>${displayName}${valueDisplay}</span>
                            <div class="consistency-status status-${status}">${icon}</div>
                        </div>
                    `;
                });
                
                // Cold shower
                html += `
                    <div class="consistency-item">
                        <span>Cold Shower ${data.coldShower ? '‚úì' : '‚úó'}</span>
                        <div class="consistency-status status-${data.coldShower ? 'good' : 'bad'}">${data.coldShower ? '‚úì' : '‚úó'}</div>
                    </div>
                `;
                
                // Lust control
                html += `
                    <div class="consistency-item">
                        <span>Lust Control ${data.lust ? '‚úó' : '‚úì'}</span>
                        <div class="consistency-status status-${data.lust ? 'bad' : 'good'}">${data.lust ? '‚úó' : '‚úì'}</div>
                    </div>
                `;
                
                tracker.innerHTML = html;
            }
            
            // ==================== SLEEP ANALYSIS ====================
            function updateSleepAnalysis() {
                const currentData = getCurrentInputs();
                const sleepAnalysis = document.getElementById('sleepAnalysis');
                
                let html = '';
                
                // Sleep Score
                let sleepEmoji = 'üò¥';
                let sleepColor = '#667eea';
                if (currentData.sleepQuality >= 75) {
                    sleepEmoji = 'üòä';
                    sleepColor = '#48bb78';
                } else if (currentData.sleepQuality >= 60) {
                    sleepEmoji = 'üòê';
                    sleepColor = '#f6ad55';
                } else if (currentData.sleepQuality > 0) {
                    sleepEmoji = 'üòü';
                    sleepColor = '#f56565';
                }
                
                // Format sleep time
                let sleepTimeDisplay = '';
                if (currentData.sleepHours > 0 || currentData.sleepMinutes > 0) {
                    if (currentData.sleepHours > 0 && currentData.sleepMinutes > 0) {
                        sleepTimeDisplay = `${currentData.sleepHours}h ${currentData.sleepMinutes}m`;
                    } else if (currentData.sleepHours > 0) {
                        sleepTimeDisplay = `${currentData.sleepHours}h`;
                    } else {
                        sleepTimeDisplay = `${currentData.sleepMinutes}m`;
                    }
                }
                
                html += `
                    <div class="sleep-score" style="color: ${sleepColor}">
                        ${currentData.sleepQuality > 0 ? currentData.sleepQuality : '--'}/100 ${sleepEmoji}
                    </div>
                    <div style="text-align: center; color: #a0aec0; margin-bottom: 15px;">
                        ${sleepTimeDisplay || 'No sleep data'}
                        ${currentData.napped ? ' + Nap üí§' : ''}
                    </div>
                `;
                
                // Sleep stages
                const totalMinutes = currentData.remSleep + currentData.deepSleep + currentData.lightSleep;
                if (totalMinutes > 0) {
                    const remPercent = Math.round((currentData.remSleep/totalMinutes)*100);
                    const deepPercent = Math.round((currentData.deepSleep/totalMinutes)*100);
                    const lightPercent = Math.round((currentData.lightSleep/totalMinutes)*100);
                    
                    const formatTime = (totalMinutes) => {
                        const hours = Math.floor(totalMinutes / 60);
                        const minutes = totalMinutes % 60;
                        if (hours > 0 && minutes > 0) return `${hours}h ${minutes}m`;
                        if (hours > 0) return `${hours}h`;
                        return `${minutes}m`;
                    };
                    
                    html += `
                        <div class="sleep-breakdown">
                            <div class="sleep-metric" style="border-left: 4px solid #667eea;">
                                <div class="sleep-metric-label">REM Sleep</div>
                                <div class="sleep-metric-value">${formatTime(currentData.remSleep)}</div>
                                <div style="font-size: 0.7rem; color: #a0aec0;">${remPercent}%</div>
                                <div class="sleep-stage-bar">
                                    <div class="sleep-stage-fill" style="width: ${remPercent}%; background: #667eea;"></div>
                                </div>
                            </div>
                            <div class="sleep-metric" style="border-left: 4px solid #48bb78;">
                                <div class="sleep-metric-label">Deep Sleep</div>
                                <div class="sleep-metric-value">${formatTime(currentData.deepSleep)}</div>
                                <div style="font-size: 0.7rem; color: #a0aec0;">${deepPercent}%</div>
                                <div class="sleep-stage-bar">
                                    <div class="sleep-stage-fill" style="width: ${deepPercent}%; background: #48bb78;"></div>
                                </div>
                            </div>
                            <div class="sleep-metric" style="border-left: 4px solid #f6ad55;">
                                <div class="sleep-metric-label">Light Sleep</div>
                                <div class="sleep-metric-value">${formatTime(currentData.lightSleep)}</div>
                                <div style="font-size: 0.7rem; color: #a0aec0;">${lightPercent}%</div>
                                <div class="sleep-stage-bar">
                                    <div class="sleep-stage-fill" style="width: ${lightPercent}%; background: #f6ad55;"></div>
                                </div>
                            </div>
                            <div class="sleep-metric" style="border-left: 4px solid #9c27b0;">
                                <div class="sleep-metric-label">Total Stages</div>
                                <div class="sleep-metric-value">${formatTime(totalMinutes)}</div>
                                <div style="font-size: 0.7rem; color: #a0aec0;">${Math.floor(totalMinutes/60)}h ${totalMinutes%60}m</div>
                                <div class="sleep-stage-bar">
                                    <div class="sleep-stage-fill" style="width: 100%; background: #9c27b0;"></div>
                                </div>
                            </div>
                        </div>
                    `;
                } else if (currentData.sleep > 0) {
                    html += `<div style="text-align: center; color: #a0aec0; padding: 20px;">Enter sleep stage details for breakdown</div>`;
                } else {
                    html += `<div style="text-align: center; color: #a0aec0; padding: 20px;">Enter sleep data to see analysis</div>`;
                }
                
                sleepAnalysis.innerHTML = html;
            }
            
            function updateSleepAnalysisWithSavedData(data) {
                const sleepAnalysis = document.getElementById('sleepAnalysis');
                
                let html = '';
                
                // Sleep Score
                let sleepEmoji = 'üò¥';
                let sleepColor = '#667eea';
                if (data.sleepQuality >= 75) {
                    sleepEmoji = 'üòä';
                    sleepColor = '#48bb78';
                } else if (data.sleepQuality >= 60) {
                    sleepEmoji = 'üòê';
                    sleepColor = '#f6ad55';
                } else if (data.sleepQuality > 0) {
                    sleepEmoji = 'üòü';
                    sleepColor = '#f56565';
                }
                
                // Format sleep time
                let sleepTimeDisplay = '';
                if (data.sleepHours > 0 || data.sleepMinutes > 0) {
                    if (data.sleepHours > 0 && data.sleepMinutes > 0) {
                        sleepTimeDisplay = `${data.sleepHours}h ${data.sleepMinutes}m`;
                    } else if (data.sleepHours > 0) {
                        sleepTimeDisplay = `${data.sleepHours}h`;
                    } else {
                        sleepTimeDisplay = `${data.sleepMinutes}m`;
                    }
                }
                
                html += `
                    <div class="sleep-score" style="color: ${sleepColor}">
                        ${data.sleepQuality > 0 ? data.sleepQuality : '--'}/100 ${sleepEmoji}
                    </div>
                    <div style="text-align: center; color: #a0aec0; margin-bottom: 15px;">
                        ${sleepTimeDisplay || 'No sleep data'}
                        ${data.napped ? ' + Nap üí§' : ''}
                    </div>
                `;
                
                // Sleep stages
                const totalMinutes = data.remSleep + data.deepSleep + data.lightSleep;
                if (totalMinutes > 0) {
                    const remPercent = Math.round((data.remSleep/totalMinutes)*100);
                    const deepPercent = Math.round((data.deepSleep/totalMinutes)*100);
                    const lightPercent = Math.round((data.lightSleep/totalMinutes)*100);
                    
                    const formatTime = (totalMinutes) => {
                        const hours = Math.floor(totalMinutes / 60);
                        const minutes = totalMinutes % 60;
                        if (hours > 0 && minutes > 0) return `${hours}h ${minutes}m`;
                        if (hours > 0) return `${hours}h`;
                        return `${minutes}m`;
                    };
                    
                    html += `
                        <div class="sleep-breakdown">
                            <div class="sleep-metric" style="border-left: 4px solid #667eea;">
                                <div class="sleep-metric-label">REM Sleep</div>
                                <div class="sleep-metric-value">${formatTime(data.remSleep)}</div>
                                <div style="font-size: 0.7rem; color: #a0aec0;">${remPercent}%</div>
                                <div class="sleep-stage-bar">
                                    <div class="sleep-stage-fill" style="width: ${remPercent}%; background: #667eea;"></div>
                                </div>
                            </div>
                            <div class="sleep-metric" style="border-left: 4px solid #48bb78;">
                                <div class="sleep-metric-label">Deep Sleep</div>
                                <div class="sleep-metric-value">${formatTime(data.deepSleep)}</div>
                                <div style="font-size: 0.7rem; color: #a0aec0;">${deepPercent}%</div>
                                <div class="sleep-stage-bar">
                                    <div class="sleep-stage-fill" style="width: ${deepPercent}%; background: #48bb78;"></div>
                                </div>
                            </div>
                            <div class="sleep-metric" style="border-left: 4px solid #f6ad55;">
                                <div class="sleep-metric-label">Light Sleep</div>
                                <div class="sleep-metric-value">${formatTime(data.lightSleep)}</div>
                                <div style="font-size: 0.7rem; color: #a0aec0;">${lightPercent}%</div>
                                <div class="sleep-stage-bar">
                                    <div class="sleep-stage-fill" style="width: ${lightPercent}%; background: #f6ad55;"></div>
                                </div>
                            </div>
                            <div class="sleep-metric" style="border-left: 4px solid #9c27b0;">
                                <div class="sleep-metric-label">Total Stages</div>
                                <div class="sleep-metric-value">${formatTime(totalMinutes)}</div>
                                <div style="font-size: 0.7rem; color: #a0aec0;">${Math.floor(totalMinutes/60)}h ${totalMinutes%60}m</div>
                                <div class="sleep-stage-bar">
                                    <div class="sleep-stage-fill" style="width: 100%; background: #9c27b0;"></div>
                                </div>
                            </div>
                        </div>
                    `;
                } else if (data.sleep > 0) {
                    html += `<div style="text-align: center; color: #a0aec0; padding: 20px;">Sleep stage details not recorded</div>`;
                } else {
                    html += `<div style="text-align: center; color: #a0aec0; padding: 20px;">No sleep data recorded</div>`;
                }
                
                sleepAnalysis.innerHTML = html;
            }
            
            function updateBodyweightGoalsWithSavedData(data) {
                const pushUps = data.pushUps || 0;
                const pullUps = data.pullUps || 0;
                
                document.getElementById('pushUpsGoal').textContent = `${pushUps}/${goals.pushUps}`;
                document.getElementById('pullUpsGoal').textContent = `${pullUps}/${goals.pullUps}`;
            }
            
            // ==================== CONSISTENCY TRACKER ====================
            function updateConsistencyTracker() {
                const tracker = document.getElementById('consistencyTracker');
                const currentData = getCurrentInputs();
                
                let html = '';
                
                // Regular metrics
                Object.keys(goals).forEach(key => {
                    const isPaused = isGoalPaused(key);
                    let current, goal, isGood;
                    
                    if (key === 'training') {
                        current = currentData.completedTrainings;
                        goal = goals.training;
                        isGood = current >= goal || isPaused;
                    } else if (key === 'pushUps' || key === 'pullUps') {
                        current = parseInt(currentData[key]) || 0;
                        goal = goals[key];
                        isGood = current >= goal || isPaused;
                    } else if (key === 'healthyEating' || key === 'makeBed') {
                        current = currentData[key] ? 1 : 0;
                        goal = goals[key];
                        isGood = current >= goal;
                    } else if (key === 'hygiene') {
                        current = currentData[key] || 0;
                        goal = goals[key];
                        isGood = current >= goal;
                    } else {
                        current = parseFloat(currentData[key]) || 0;
                        goal = goals[key];
                        isGood = key === 'screenTime' ? current <= goal : current >= goal;
                    }
                    
                    const status = isGood ? 'good' : 'bad';
                    const icon = isGood ? '‚úì' : '‚úó';
                    
                    let displayName = key.charAt(0).toUpperCase() + key.slice(1);
                    if (key === 'screenTime') displayName = 'Screen Time';
                    if (key === 'pushUps') displayName = 'Push-ups';
                    if (key === 'pullUps') displayName = 'Pull-ups';
                    if (key === 'healthyEating') displayName = 'Healthy Eating';
                    if (key === 'makeBed') displayName = 'Make Bed';
                    
                    const pausedText = isPaused ? ' ‚è∏Ô∏è' : '';
                    
                    html += `
                        <div class="consistency-item">
                            <span>${displayName}${pausedText}</span>
                            <div class="consistency-status status-${status}">${icon}</div>
                        </div>
                    `;
                });
                
                // Cold shower
                const coldShowerPaused = isActivityPaused('coldShower');
                const coldShowerText = coldShowerPaused ? ' ‚è∏Ô∏è' : '';
                html += `
                    <div class="consistency-item">
                        <span>Cold Shower${coldShowerText}</span>
                        <div class="consistency-status status-${currentData.coldShower || coldShowerPaused ? 'good' : 'bad'}">${currentData.coldShower || coldShowerPaused ? '‚úì' : '‚úó'}</div>
                    </div>
                `;
                
                // Lust control
                html += `
                    <div class="consistency-item">
                        <span>Lust Control</span>
                        <div class="consistency-status status-${currentData.lust ? 'bad' : 'good'}">${currentData.lust ? '‚úó' : '‚úì'}</div>
                    </div>
                `;
                
                tracker.innerHTML = html;
            }
            
            // ==================== INACTIVITY TRACKER ====================
            function updateInactivityTracker(date, data) {
                const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
                const allGoals = { ...goals, coldShower: true, lustControl: true };
                
                Object.keys(allGoals).forEach(goalKey => {
                    if (!inactivityTracker[goalKey]) {
                        inactivityTracker[goalKey] = { lastCompleted: null, consecutiveMissed: 0 };
                    }
                    
                    const tracker = inactivityTracker[goalKey];
                    
                    // Check if this goal is paused for this date
                    let isPaused = false;
                    if (goalKey === 'pullUps') {
                        isPaused = isActivityPaused('pullUps', date);
                    } else if (goalKey === 'coldShower') {
                        isPaused = isActivityPaused('coldShower', date);
                    } else if (goalKey === 'training') {
                        isPaused = sickRestDays.sick.active || sickRestDays.rest.active;
                    } else if (goalKey === 'steps' || goalKey === 'pushUps') {
                        isPaused = sickRestDays.sick.active;
                    }
                    
                    const goalMet = isGoalMetForDay(data, goalKey) || isPaused;
                    
                    if (goalMet) {
                        tracker.lastCompleted = date;
                        tracker.consecutiveMissed = 0;
                    } else if (!isPaused) {
                        tracker.consecutiveMissed++;
                    }
                });
                
                localStorage.setItem('inactivityTracker', JSON.stringify(inactivityTracker));
            }
            
            function isGoalMetForDay(data, goalKey) {
                if (goalKey === 'coldShower') return data.coldShower === true;
                if (goalKey === 'lustControl') return data.lust !== true;
                if (goalKey === 'training') return data.completedTrainings >= goals.training;
                if (goalKey === 'healthyEating' || goalKey === 'makeBed') return data[goalKey] === true;
                if (goalKey === 'hygiene') {
                    const value = data[goalKey] || 0;
                    return value >= goals[goalKey];
                }
                if (goalKey === 'pushUps' || goalKey === 'pullUps') {
                    const value = parseInt(data[goalKey]) || 0;
                    const goal = goals[goalKey];
                    return value >= goal;
                }
                
                const value = parseFloat(data[goalKey]) || 0;
                const goal = goals[goalKey];
                return goalKey === 'screenTime' ? value <= goal : value >= goal;
            }
            
            // ==================== POINTS SYSTEM ====================
            function calculateTodayPoints() {
                const currentData = getCurrentInputs();
                const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
                const dates = Object.keys(allData).sort();
                const streaks = calculateStreaksWithPause(dates, allData);
                
                let totalPoints = 0;
                let pointsBreakdown = [];
                let completedGoals = 0;
                const totalGoals = Object.keys(goals).length + 2;
                
                // Calculate points for each goal
                Object.keys(goals).forEach(goalKey => {
                    const isPaused = isGoalPaused(goalKey);
                    let points = 0;
                    let multiplier = 1;
                    let description = '';
                    let emoji = '';
                    
                    // Streak multiplier
                    const streak = streaks[goalKey] || 0;
                    for (const [days, mult] of Object.entries(pointsConfig.streakMultipliers).sort((a, b) => b[0] - a[0])) {
                        if (streak >= parseInt(days)) {
                            multiplier = mult;
                            break;
                        }
                    }
                    
                    if (goalKey === 'training') {
                        const goalMet = currentData.completedTrainings >= goals.training;
                        
                        if (goalMet && !isPaused) {
                            points = pointsConfig.training * multiplier;
                            description = `Training (${currentData.completedTrainings} sessions)`;
                            emoji = 'üí™';
                            completedGoals++;
                            
                            // Training bonuses
                            let bonusPoints = 0;
                            currentData.trainingSessions.forEach((session, index) => {
                                if (session.completed) {
                                    if (session.duration > 75) {
                                        bonusPoints += pointsConfig.durationBonus;
                                        description += ` +${pointsConfig.durationBonus}dur`;
                                    }
                                    
                                    if (session.intensity > 6) {
                                        bonusPoints += pointsConfig.intensityBonus;
                                        description += ` +${pointsConfig.intensityBonus}int`;
                                    }
                                    
                                    if (index > 0) {
                                        bonusPoints += pointsConfig.extraTrainingBonus;
                                        description += ` +${pointsConfig.extraTrainingBonus}extra`;
                                    }
                                }
                            });
                            
                            points += bonusPoints;
                        } else if (!goalMet && !isPaused) {
                            points = pointsConfig.trainingDeduction;
                            description = `Training (Missed)`;
                            emoji = '‚ùå';
                        }
                    } else if (goalKey === 'pushUps' || goalKey === 'pullUps') {
                        const current = parseInt(currentData[goalKey]) || 0;
                        const goal = goals[goalKey];
                        const goalMet = current >= goal;
                        
                        if (goalMet && !isPaused) {
                            points = pointsConfig[goalKey] * multiplier;
                            description = goalKey === 'pushUps' ? 'Push-ups' : 'Pull-ups';
                            emoji = goalKey === 'pushUps' ? 'üí™' : 'ü§∏';
                            completedGoals++;
                        } else if (!goalMet && !isPaused) {
                            points = pointsConfig[`${goalKey}Deduction`];
                            description = goalKey === 'pushUps' ? 'Push-ups (Missed)' : 'Pull-ups (Missed)';
                            emoji = '‚ùå';
                        }
                    } else if (goalKey === 'healthyEating' || goalKey === 'makeBed') {
                        const goalMet = currentData[goalKey] === true;
                        
                        if (goalMet) {
                            points = pointsConfig[goalKey] * multiplier;
                            description = goalKey === 'healthyEating' ? 'Healthy Eating' : 'Make Bed';
                            emoji = goalKey === 'healthyEating' ? 'ü•ó' : 'üõèÔ∏è';
                            completedGoals++;
                        } else {
                            points = pointsConfig[`${goalKey}Deduction`];
                            description = goalKey === 'healthyEating' ? 'Healthy Eating (Missed)' : 'Make Bed (Missed)';
                            emoji = '‚ùå';
                        }
                    } else if (goalKey === 'hygiene') {
                        const current = currentData[goalKey] || 0;
                        const goal = goals[goalKey];
                        
                        if (current >= goal) {
                            points = pointsConfig[goalKey] * multiplier;
                            description = `Hygiene (${current} times)`;
                            emoji = 'üßº';
                            completedGoals++;
                        } else if (current === 1) {
                            points = pointsConfig.hygienePartialDeduction;
                            description = `Hygiene (Only ${current} time)`;
                            emoji = '‚ö†Ô∏è';
                        } else if (current === 0) {
                            points = pointsConfig.hygieneDeduction;
                            description = `Hygiene (Missed)`;
                            emoji = '‚ùå';
                        }
                    } else if (goalKey === 'sleep') {
                        const sleepQuality = currentData.sleepQuality;
                        const sleepDuration = currentData.sleep;
                        
                        let sleepPoints = 0;
                        description = 'Sleep';
                        emoji = 'üò¥';
                        
                        if (sleepQuality > 75 && sleepDuration >= 8.0 && sleepDuration <= 9.5) {
                            sleepPoints = pointsConfig.sleepQualityBonus * multiplier;
                            description += ' (Quality & Duration)';
                            completedGoals++;
                        } else if (sleepQuality <= 60) {
                            sleepPoints = pointsConfig.sleepQualityDeduction;
                            description += ' (Low Quality)';
                        } else if (sleepDuration < 7) {
                            sleepPoints = pointsConfig.sleepDurationDeduction;
                            description += ' (Short Sleep)';
                        }
                        
                        points = sleepPoints;
                        
                    } else {
                        const current = parseFloat(currentData[goalKey]) || 0;
                        const goal = goals[goalKey];
                        const goalMet = goalKey === 'screenTime' ? current <= goal : current >= goal;
                        
                        if (goalMet) {
                            points = pointsConfig[goalKey] * multiplier;
                            description = goalKey.charAt(0).toUpperCase() + goalKey.slice(1);
                            if (goalKey === 'screenTime') description = 'Screen Time';
                            emoji = getEmojiForActivity(goalKey);
                            completedGoals++;
                            
                            // Steps bonus
                            if (goalKey === 'steps' && current > goal) {
                                const extraSteps = current - goal;
                                const extraMultipliers = Math.min(
                                    Math.floor(extraSteps / 1500),
                                    pointsConfig.maxStepsMultipliers
                                );
                                const bonus = Math.round(pointsConfig.steps * pointsConfig.stepsMultiplierPer1500 * extraMultipliers);
                                if (bonus > 0) {
                                    points += bonus;
                                    description += ` +${bonus} bonus`;
                                }
                            }
                        } else {
                            if (!isPaused) {
                                points = pointsConfig[`${goalKey}Deduction`];
                                description = `${goalKey.charAt(0).toUpperCase() + goalKey.slice(1)} (Missed)`;
                                if (goalKey === 'screenTime') description = 'Screen Time (Exceeded)';
                                emoji = '‚ùå';
                            }
                        }
                    }
                    
                    if (points !== 0) {
                        totalPoints += points;
                        const isNegative = points < 0;
                        pointsBreakdown.push({ 
                            emoji, 
                            description, 
                            points: Math.round(points), 
                            multiplier: multiplier > 1 && !isNegative ? `x${multiplier}` : '',
                            isNegative 
                        });
                    }
                });
                
                // Cold shower points
                const coldShowerPaused = isActivityPaused('coldShower');
                if (currentData.coldShower && !coldShowerPaused) {
                    const streak = streaks.coldShower || 0;
                    let multiplier = 1;
                    for (const [days, mult] of Object.entries(pointsConfig.streakMultipliers).sort((a, b) => b[0] - a[0])) {
                        if (streak >= parseInt(days)) {
                            multiplier = mult;
                            break;
                        }
                    }
                    const points = pointsConfig.coldShower * multiplier;
                    totalPoints += points;
                    completedGoals++;
                    pointsBreakdown.push({ emoji: 'üöø', description: 'Cold Shower', points: Math.round(points), multiplier: multiplier > 1 ? `x${multiplier}` : '', isNegative: false });
                } else if (!currentData.coldShower && !coldShowerPaused) {
                    const deduction = pointsConfig.coldShower * -0.5; // Smaller deduction when not paused
                    totalPoints += deduction;
                    pointsBreakdown.push({ emoji: '‚ö†Ô∏è', description: 'Cold Shower (Missed)', points: deduction, multiplier: '', isNegative: true });
                }
                
                // Lust control points
                if (!currentData.lust) {
                    const streak = streaks.lustControl || 0;
                    let multiplier = 1;
                    for (const [days, mult] of Object.entries(pointsConfig.streakMultipliers).sort((a, b) => b[0] - a[0])) {
                        if (streak >= parseInt(days)) {
                            multiplier = mult;
                            break;
                        }
                    }
                    const points = pointsConfig.lustControl * multiplier;
                    totalPoints += points;
                    completedGoals++;
                    pointsBreakdown.push({ emoji: 'üö´', description: 'Lust Control', points: Math.round(points), multiplier: multiplier > 1 ? `x${multiplier}` : '', isNegative: false });
                } else {
                    const deduction = pointsConfig.lustControl * -1;
                    totalPoints += deduction;
                    pointsBreakdown.push({ emoji: '‚ö†Ô∏è', description: 'Lust (Deduction)', points: deduction, multiplier: '', isNegative: true });
                }
                
                // Bodyweight both bonus
                const pushUpsMet = (currentData.pushUps >= goals.pushUps) && !isGoalPaused('pushUps');
                const pullUpsMet = (currentData.pullUps >= goals.pullUps) && !isGoalPaused('pullUps');
                if (pushUpsMet && pullUpsMet) {
                    const basePushUpsPoints = pointsConfig.pushUps;
                    const basePullUpsPoints = pointsConfig.pullUps;
                    const bonus = Math.round((basePushUpsPoints + basePullUpsPoints) * (pointsConfig.bodyweightBothBonus - 1));
                    
                    totalPoints += bonus;
                    pointsBreakdown.push({ emoji: 'üèÜ', description: 'Bodyweight Both Bonus', points: bonus, multiplier: `x${pointsConfig.bodyweightBothBonus}`, isNegative: false });
                }
                
                // Inactivity penalties (skip for paused activities)
                Object.keys(inactivityTracker).forEach(goalKey => {
                    const tracker = inactivityTracker[goalKey];
                    let isPaused = false;
                    
                    if (goalKey === 'pullUps') {
                        isPaused = isActivityPaused('pullUps');
                    } else if (goalKey === 'coldShower') {
                        isPaused = isActivityPaused('coldShower');
                    }
                    
                    if (tracker.consecutiveMissed >= 3 && !isPaused && !isGoalPaused(goalKey)) {
                        const penalty = pointsConfig.inactivityPenalty;
                        totalPoints += penalty;
                        pointsBreakdown.push({ 
                            emoji: '‚è∞', 
                            description: `${goalKey.charAt(0).toUpperCase() + goalKey.slice(1)} Inactivity`, 
                            points: penalty, 
                            multiplier: '', 
                            isNegative: true 
                        });
                    }
                });
                
                // Weekly consistency bonus
                const allDates = Object.keys(allData).sort();
                if (allDates.length >= 7) {
                    const last7Days = allDates.slice(-7);
                    const perfectDays = last7Days.filter(date => {
                        const dayData = allData[date];
                        if (!dayData) return false;
                        
                        let completed = 0;
                        Object.keys(goals).forEach(key => {
                            if (isGoalMetForDay(dayData, key)) completed++;
                        });
                        
                        if (dayData.coldShower) completed++;
                        if (!dayData.lust) completed++;
                        
                        return completed >= Object.keys(goals).length + 1;
                    });
                    
                    if (perfectDays.length >= 7) {
                        totalPoints += pointsConfig.weeklyConsistencyBonus;
                        pointsBreakdown.push({ emoji: 'üìÖ', description: 'Weekly Consistency Bonus', points: pointsConfig.weeklyConsistencyBonus, multiplier: '7+ days', isNegative: false });
                    }
                }
                
                // Daily completion bonus
                if (completedGoals === totalGoals) {
                    totalPoints += pointsConfig.dailyCompletionBonus;
                    pointsBreakdown.push({ emoji: 'üèÜ', description: 'All Goals Completed!', points: pointsConfig.dailyCompletionBonus, multiplier: 'BONUS', isNegative: false });
                }
                
                return { total: Math.round(totalPoints), breakdown: pointsBreakdown, completedGoals, totalGoals };
            }
            
            function getEmojiForActivity(activity) {
                const emojis = { 
                    stretching: 'üßò', 
                    steps: 'üëü', 
                    sleep: 'üò¥', 
                    water: 'üíß', 
                    screenTime: 'üì±', 
                    pages: 'üìö', 
                    training: 'üí™',
                    healthyEating: 'ü•ó',
                    makeBed: 'üõèÔ∏è',
                    hygiene: 'üßº'
                };
                return emojis[activity] || '‚≠ê';
            }
            
            function updatePointsDisplay() {
                const lifetimePoints = calculateLifetimePoints();
                
                // Update total points
                document.getElementById('totalPoints').textContent = lifetimePoints.total;
                
                // Calculate today's points
                if (!todayDataSaved) {
                    const pointsData = calculateTodayPoints();
                    const targetDate = getTargetDate();
                    const today = new Date().toISOString().split('T')[0];
                    
                    if (targetDate === today) {
                        document.getElementById('todayPoints').textContent = `Today: ${pointsData.total} points`;
                    } else {
                        document.getElementById('todayPoints').textContent = `This date: ${pointsData.total} points`;
                    }
                    
                    let html = '';
                    if (pointsData.breakdown.length > 0) {
                        pointsData.breakdown.forEach(item => {
                            const pointsClass = item.isNegative ? 'points-negative' : 'points-value';
                            const pointsDisplay = item.points > 0 ? `+${item.points}` : item.points;
                            
                            html += `
                                <div class="points-item">
                                    <div class="points-activity">
                                        <span class="points-emoji">${item.emoji}</span>
                                        <span>${item.description}</span>
                                    </div>
                                    <div>
                                        <span class="${pointsClass}">${pointsDisplay}</span>
                                        ${item.multiplier ? `<span class="points-multiplier">${item.multiplier}</span>` : ''}
                                    </div>
                                </div>
                            `;
                        });
                    } else {
                        html = `<div style="text-align: center; color: #a0aec0; padding: 10px;">Complete goals to earn points!</div>`;
                    }
                    
                    document.getElementById('pointsBreakdown').innerHTML = html;
                } else {
                    // Show saved points for this date
                    const targetDate = getTargetDate();
                    const pointsHistory = JSON.parse(localStorage.getItem('lifeTrackerPoints')) || { days: {} };
                    const datePoints = pointsHistory.days[targetDate];
                    const today = new Date().toISOString().split('T')[0];
                    
                    if (datePoints) {
                        if (targetDate === today) {
                            document.getElementById('todayPoints').textContent = `Today: ${datePoints.points} points`;
                        } else {
                            document.getElementById('todayPoints').textContent = `This date: ${datePoints.points} points`;
                        }
                        
                        let html = '';
                        datePoints.breakdown.forEach(item => {
                            const pointsClass = item.isNegative ? 'points-negative' : 'points-value';
                            const pointsDisplay = item.points > 0 ? `+${item.points}` : item.points;
                            
                            html += `
                                <div class="points-item">
                                    <div class="points-activity">
                                        <span class="points-emoji">${item.emoji}</span>
                                        <span>${item.description}</span>
                                    </div>
                                    <div>
                                        <span class="${pointsClass}">${pointsDisplay}</span>
                                        ${item.multiplier ? `<span class="points-multiplier">${item.multiplier}</span>` : ''}
                                    </div>
                                </div>
                            `;
                        });
                        
                        document.getElementById('pointsBreakdown').innerHTML = html;
                    } else {
                        document.getElementById('todayPoints').textContent = targetDate === today ? 'Today: 0 points' : 'This date: 0 points';
                        document.getElementById('pointsBreakdown').innerHTML = 
                            `<div style="text-align: center; color: #a0aec0; padding: 10px;">No points data for this date</div>`;
                    }
                }
                
                updateLevelProgress(lifetimePoints.total);
            }
            
            function calculateLifetimePoints() {
                const storedPoints = JSON.parse(localStorage.getItem('lifeTrackerPoints')) || { 
                    total: 0, 
                    days: {} 
                };
                
                // Calculate total from all days to ensure accuracy
                let calculatedTotal = 0;
                Object.values(storedPoints.days).forEach(day => {
                    calculatedTotal += day.points || 0;
                });
                
                // Update if mismatch
                if (storedPoints.total !== calculatedTotal) {
                    storedPoints.total = calculatedTotal;
                    localStorage.setItem('lifeTrackerPoints', JSON.stringify(storedPoints));
                }
                
                return { 
                    total: storedPoints.total,
                    days: storedPoints.days 
                };
            }
            
            function updateLevelProgress(totalPoints) {
                const levelProgress = document.getElementById('levelProgress');
                const levelText = document.getElementById('levelText');
                
                let level = 1;
                let pointsNeededForLevel = 100;
                let pointsForNextLevel = 100;
                let pointsInCurrentLevel = totalPoints;
                
                while (pointsInCurrentLevel >= pointsNeededForLevel) {
                    pointsInCurrentLevel -= pointsNeededForLevel;
                    level++;
                    pointsNeededForLevel = level * 100;
                    pointsForNextLevel = level * 100;
                }
                
                const progressPercent = (pointsInCurrentLevel / pointsForNextLevel) * 100;
                levelProgress.style.width = `${progressPercent}%`;
                levelText.textContent = `Level ${level} (${pointsInCurrentLevel}/${pointsForNextLevel})`;
            }
            
            // ==================== STREAK CALCULATION ====================
            function calculateStreaks(dates, allData) {
                const streaks = { 
                    stretching: 0, steps: 0, sleep: 0, water: 0, screenTime: 0, pages: 0, 
                    training: 0, coldShower: 0, lustControl: 0, pushUps: 0, pullUps: 0,
                    healthyEating: 0, makeBed: 0, hygiene: 0
                };
                if (dates.length === 0) return streaks;
                
                const today = new Date();
                
                function goalMet(date, goalKey) {
                    const dayData = allData[date];
                    if (!dayData) return false;
                    
                    if (goalKey === 'coldShower') return dayData.coldShower === true;
                    if (goalKey === 'lustControl') return dayData.lust !== true;
                    if (goalKey === 'training') return dayData.completedTrainings >= goals.training;
                    if (goalKey === 'healthyEating' || goalKey === 'makeBed') return dayData[goalKey] === true;
                    if (goalKey === 'hygiene') {
                        const value = dayData[goalKey] || 0;
                        return value >= goals[goalKey];
                    }
                    if (goalKey === 'pushUps' || goalKey === 'pullUps') {
                        const value = parseInt(dayData[goalKey]) || 0;
                        const goal = goals[goalKey];
                        return value >= goal;
                    }
                    
                    const value = parseFloat(dayData[goalKey]) || 0;
                    const goal = goals[goalKey];
                    return goalKey === 'screenTime' ? value <= goal : value >= goal;
                }
                
                Object.keys(streaks).forEach(goalKey => {
                    let streak = 0;
                    let checkingDate = new Date(today);
                    
                    for (let i = 0; i < 365; i++) {
                        const dateStr = checkingDate.toISOString().split('T')[0];
                        const dayData = allData[dateStr];
                        
                        if (dayData && goalMet(dateStr, goalKey)) {
                            streak++;
                        } else {
                            break;
                        }
                        
                        checkingDate.setDate(checkingDate.getDate() - 1);
                    }
                    
                    streaks[goalKey] = streak;
                });
                
                return streaks;
            }
            
            function calculateStreaksWithPause(dates, allData) {
                const streaks = calculateStreaks(dates, allData);
                
                // Don't break streaks for paused activities or sick/rest days
                const targetDate = getTargetDate();
                
                if (sickRestDays.sick.active || (sickRestDays.sick.history && sickRestDays.sick.history.includes(targetDate))) {
                    streaks.steps = Math.max(streaks.steps, 1);
                    streaks.pushUps = Math.max(streaks.pushUps, 1);
                    streaks.pullUps = Math.max(streaks.pullUps, 1);
                    streaks.training = Math.max(streaks.training, 1);
                }
                
                if (sickRestDays.rest.active || (sickRestDays.rest.history && sickRestDays.rest.history.includes(targetDate))) {
                    streaks.training = Math.max(streaks.training, 1);
                }
                
                if (isActivityPaused('pullUps', targetDate)) {
                    streaks.pullUps = Math.max(streaks.pullUps, 1);
                }
                
                if (isActivityPaused('coldShower', targetDate)) {
                    streaks.coldShower = Math.max(streaks.coldShower, 1);
                }
                
                return streaks;
            }
            
            function updateStreakTracker() {
                const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
                const dates = Object.keys(allData).sort();
                const streaks = calculateStreaksWithPause(dates, allData);
                
                let html = '';
                Object.keys(streaks).forEach(key => {
                    const streak = streaks[key];
                    let displayName = key.charAt(0).toUpperCase() + key.slice(1);
                    if (key === 'screenTime') displayName = 'Screen Time';
                    if (key === 'coldShower') displayName = 'Cold Shower';
                    if (key === 'lustControl') displayName = 'Lust Control';
                    if (key === 'pushUps') displayName = 'Push-ups';
                    if (key === 'pullUps') displayName = 'Pull-ups';
                    if (key === 'healthyEating') displayName = 'Healthy Eating';
                    if (key === 'makeBed') displayName = 'Make Bed';
                    if (key === 'hygiene') displayName = 'Hygiene';
                    
                    let streakColor = '#a0aec0';
                    let flameIcon = '';
                    let pausedIndicator = '';
                    
                    const targetDate = getTargetDate();
                    let isPaused = false;
                    
                    if (key === 'pullUps') {
                        isPaused = isActivityPaused('pullUps', targetDate);
                    } else if (key === 'coldShower') {
                        isPaused = isActivityPaused('coldShower', targetDate);
                    } else if (key === 'training') {
                        isPaused = sickRestDays.sick.active || sickRestDays.rest.active;
                    } else if (key === 'steps' || key === 'pushUps') {
                        isPaused = sickRestDays.sick.active;
                    }
                    
                    if (isPaused) {
                        pausedIndicator = ' ‚è∏Ô∏è';
                        streakColor = '#718096';
                    } else if (streak >= 7) {
                        streakColor = '#48bb78';
                        flameIcon = 'üî•';
                    } else if (streak >= 3) {
                        streakColor = '#f6ad55';
                        flameIcon = 'üî•';
                    } else if (streak > 0) {
                        streakColor = '#667eea';
                        flameIcon = '‚ú®';
                    }
                    
                    html += `
                        <div class="consistency-item">
                            <span>${displayName}</span>
                            <div style="color: ${streakColor}; font-weight: bold; font-size: 1.1rem;">
                                ${streak} day${streak !== 1 ? 's' : ''} ${flameIcon}${pausedIndicator}
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('streakTracker').innerHTML = html;
            }
            
            // ==================== HABIT CONSISTENCY ====================
            function calculateHabitConsistency() {
                const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
                const dates = Object.keys(allData).sort();
                const totalDays = dates.length;
                
                const consistency = {};
                Object.keys(goals).forEach(goalKey => {
                    let completedDays = 0;
                    
                    dates.forEach(date => {
                        const dayData = allData[date];
                        if (dayData && isGoalMetForDay(dayData, goalKey)) {
                            completedDays++;
                        }
                    });
                    
                    consistency[goalKey] = totalDays > 0 ? Math.round((completedDays / totalDays) * 100) : 0;
                });
                
                const values = Object.values(consistency);
                const overall = values.length > 0 ? Math.round(values.reduce((a, b) => a + b, 0) / values.length) : 0;
                
                return { overall, habits: consistency };
            }
            
            function updateHabitConsistency() {
                const consistency = calculateHabitConsistency();
                const habitConsistencyElement = document.getElementById('habitConsistency');
                
                document.getElementById('overallConsistency').textContent = `${consistency.overall}%`;
                
                let html = '';
                Object.keys(consistency.habits).forEach(key => {
                    const value = consistency.habits[key];
                    let displayName = key.charAt(0).toUpperCase() + key.slice(1);
                    if (key === 'screenTime') displayName = 'Screen Time';
                    if (key === 'pushUps') displayName = 'Push-ups';
                    if (key === 'pullUps') displayName = 'Pull-ups';
                    if (key === 'healthyEating') displayName = 'Healthy Eating';
                    if (key === 'makeBed') displayName = 'Make Bed';
                    if (key === 'hygiene') displayName = 'Hygiene';
                    
                    html += `
                        <div class="consistency-item">
                            <span>${displayName}</span>
                            <div style="font-weight: bold; color: ${getConsistencyColor(value)};">
                                ${value}%
                            </div>
                        </div>
                    `;
                });
                
                habitConsistencyElement.innerHTML = html;
            }
            
            function getConsistencyColor(value) {
                if (value >= 90) return '#48bb78';
                if (value >= 70) return '#f6ad55';
                if (value >= 50) return '#fbd38d';
                return '#f56565';
            }
            
            // ==================== TOTAL STATISTICS ====================
            function updateTotalStats() {
                const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
                const totalStatsElement = document.getElementById('totalStats');
                
                const totals = { 
                    stretching: 0, steps: 0, sleep: 0, water: 0, screenTime: 0, pages: 0, 
                    gymSessions: 0, runs: 0, totalRunDistance: 0, coldShowers: 0, naps: 0,
                    pushUps: 0, pullUps: 0, healthyEatingDays: 0, makeBedDays: 0, hygieneScore: 0,
                    totalTrainings: 0
                };
                let totalDays = 0;
                
                Object.keys(allData).forEach(date => {
                    const dayData = allData[date];
                    totalDays++;
                    
                    totals.stretching += parseFloat(dayData.stretching) || 0;
                    totals.steps += parseFloat(dayData.steps) || 0;
                    totals.sleep += parseFloat(dayData.sleep) || 0;
                    totals.water += parseFloat(dayData.water) || 0;
                    totals.screenTime += parseFloat(dayData.screenTime) || 0;
                    totals.pages += parseFloat(dayData.pages) || 0;
                    totals.pushUps += parseInt(dayData.pushUps) || 0;
                    totals.pullUps += parseInt(dayData.pullUps) || 0;
                    totals.healthyEatingDays += dayData.healthyEating ? 1 : 0;
                    totals.makeBedDays += dayData.makeBed ? 1 : 0;
                    totals.hygieneScore += parseInt(dayData.hygiene) || 0;
                    totals.totalTrainings += dayData.totalTrainings || 0;
                    
                    if (dayData.trainingSessions) {
                        dayData.trainingSessions.forEach(session => {
                            if (session.type === 'gym') totals.gymSessions++;
                            if (session.type === 'run') {
                                totals.runs++;
                                totals.totalRunDistance += parseFloat(session.distance) || 0;
                            }
                        });
                    }
                    
                    if (dayData.coldShower === true) totals.coldShowers++;
                    if (dayData.napped === true) totals.naps++;
                });
                
                const formatNumber = (num) => {
                    if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
                    if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
                    return Math.round(num * 10) / 10;
                };
                
                totalStatsElement.innerHTML = `
                    <div class="consistency-item"><span>üßò Total Stretching</span><div style="font-weight: bold; color: #667eea;">${formatNumber(totals.stretching)}</div></div>
                    <div class="consistency-item"><span>üëü Total Steps</span><div style="font-weight: bold; color: #667eea;">${formatNumber(totals.steps)}</div></div>
                    <div class="consistency-item"><span>üò¥ Total Sleep</span><div style="font-weight: bold; color: #667eea;">${formatNumber(totals.sleep)}h</div></div>
                    <div class="consistency-item"><span>üíß Total Water</span><div style="font-weight: bold; color: #667eea;">${formatNumber(totals.water)}L</div></div>
                    <div class="consistency-item"><span>üì± Total Screen Time</span><div style="font-weight: bold; color: #667eea;">${formatNumber(totals.screenTime)}h</div></div>
                    <div class="consistency-item"><span>üìö Total Pages</span><div style="font-weight: bold; color: #667eea;">${formatNumber(totals.pages)}</div></div>
                    <div class="consistency-item"><span>ü•ó Healthy Eating Days</span><div style="font-weight: bold; color: #48bb78;">${totals.healthyEatingDays}</div></div>
                    <div class="consistency-item"><span>üõèÔ∏è Make Bed Days</span><div style="font-weight: bold; color: #f6ad55;">${totals.makeBedDays}</div></div>
                    <div class="consistency-item"><span>üßº Hygiene Score</span><div style="font-weight: bold; color: #00bcd4;">${totals.hygieneScore}</div></div>
                    <div class="consistency-item"><span>üí™ Total Push-ups</span><div style="font-weight: bold; color: #667eea;">${formatNumber(totals.pushUps)}</div></div>
                    <div class="consistency-item"><span>ü§∏ Total Pull-ups</span><div style="font-weight: bold; color: #667eea;">${formatNumber(totals.pullUps)}</div></div>
                    <div class="consistency-item"><span>üèãÔ∏è Gym Sessions</span><div style="font-weight: bold; color: #667eea;">${totals.gymSessions}</div></div>
                    <div class="consistency-item"><span>üèÉ Total Runs</span><div style="font-weight: bold; color: #667eea;">${totals.runs}</div></div>
                    <div class="consistency-item"><span>üìè Total Distance</span><div style="font-weight: bold; color: #667eea;">${formatNumber(totals.totalRunDistance)}km</div></div>
                    <div class="consistency-item"><span>üí™ Total Training Sessions</span><div style="font-weight: bold; color: #667eea;">${totals.totalTrainings}</div></div>
                    <div class="consistency-item"><span>üöø Cold Showers</span><div style="font-weight: bold; color: #48bb78;">${totals.coldShowers}</div></div>
                    <div class="consistency-item"><span>üò¥ Naps Taken</span><div style="font-weight: bold; color: #667eea;">${totals.naps}</div></div>
                    <div class="consistency-item"><span>üìÖ Days Tracked</span><div style="font-weight: bold; color: #9c27b0;">${totalDays}</div></div>
                `;
            }
            
            // ==================== CHART FUNCTIONS ====================
            function initializeChart() {
                const ctx = document.getElementById('mainChart').getContext('2d');
                currentChart = new Chart(ctx, {
                    type: 'line',
                    data: { labels: [], datasets: [] },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: { 
                            y: { 
                                beginAtZero: true,
                                grid: { color: '#4a5568' },
                                ticks: { color: '#cbd5e0' }
                            },
                            x: {
                                grid: { color: '#4a5568' },
                                ticks: { color: '#cbd5e0' }
                            }
                        },
                        plugins: { 
                            legend: { 
                                display: true, 
                                position: 'top',
                                labels: { color: '#e2e8f0' }
                            } 
                        }
                    }
                });
                updateChart();
            }
            
            function showChart(type) {
                currentView = type;
                document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');
                updateChart();
            }
            
            function changePeriod(period) {
                currentPeriod = period;
                document.querySelectorAll('.period-btn').forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');
                updateChart();
            }
            
            function updateChart() {
                const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
                const dates = Object.keys(allData).sort();
                const chartData = getChartData(dates, allData);
                
                if (currentChart) {
                    currentChart.data = chartData;
                    currentChart.update();
                }
                
                const titles = {
                    stretching: 'Stretching Sessions',
                    steps: 'Steps Taken',
                    sleep: 'Sleep Hours',
                    water: 'Water Intake (Liters)',
                    screenTime: 'Screen Time (Hours)',
                    pages: 'Pages Read',
                    training: 'Training Sessions',
                    healthyEating: 'Healthy Eating Days',
                    makeBed: 'Make Bed Days',
                    hygiene: 'Hygiene Score',
                    consistency: 'Overall Consistency'
                };
                
                const periodText = currentPeriod === 'daily' ? 'Last 7 Days' : 
                                  currentPeriod === 'weekly' ? 'Last 4 Weeks' : 'Last 6 Months';
                
                document.getElementById('chartTitle').textContent = `${titles[currentView] || currentView} - ${periodText}`;
            }
            
            function getChartData(dates, allData) {
                const now = new Date();
                let filteredDates = [];
                
                if (currentPeriod === 'daily') {
                    for (let i = 6; i >= 0; i--) {
                        const date = new Date(now);
                        date.setDate(date.getDate() - i);
                        filteredDates.push(date.toISOString().split('T')[0]);
                    }
                } else if (currentPeriod === 'weekly') {
                    for (let i = 3; i >= 0; i--) {
                        const date = new Date(now);
                        date.setDate(date.getDate() - (i * 7));
                        filteredDates.push(`Week of ${date.toLocaleDateString()}`);
                    }
                } else {
                    for (let i = 5; i >= 0; i--) {
                        const date = new Date(now);
                        date.setMonth(date.getMonth() - i);
                        filteredDates.push(date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' }));
                    }
                }
                
                if (currentView === 'consistency') {
                    return getConsistencyChartData(filteredDates, allData);
                } else {
                    return getSingleMetricChartData(filteredDates, allData, currentView);
                }
            }
            
            function getSingleMetricChartData(labels, allData, metric) {
                const data = labels.map(label => {
                    if (currentPeriod === 'daily') {
                        const dayData = allData[label];
                        if (metric === 'training') {
                            return dayData ? (dayData.completedTrainings || 0) : 0;
                        } else if (metric === 'healthyEating' || metric === 'makeBed') {
                            return dayData ? (dayData[metric] ? 1 : 0) : 0;
                        } else if (metric === 'hygiene') {
                            return dayData ? (dayData[metric] || 0) : 0;
                        }
                        return dayData ? (parseFloat(dayData[metric]) || 0) : 0;
                    }
                    return 0;
                });
                
                const colors = {
                    stretching: '#667eea',
                    steps: '#48bb78',
                    sleep: '#4299e1',
                    water: '#00bcd4',
                    screenTime: '#f6ad55',
                    pages: '#9c27b0',
                    training: '#f56565',
                    healthyEating: '#68d391',
                    makeBed: '#fbd38d',
                    hygiene: '#00bcd4'
                };
                
                return {
                    labels,
                    datasets: [{
                        label: metric.charAt(0).toUpperCase() + metric.slice(1),
                        data,
                        borderColor: colors[metric] || '#667eea',
                        backgroundColor: (colors[metric] || '#667eea') + '20',
                        tension: 0.4,
                        fill: true
                    }]
                };
            }
            
            function getConsistencyChartData(labels, allData) {
                const consistencyData = labels.map(label => {
                    if (currentPeriod === 'daily') {
                        const dayData = allData[label];
                        if (dayData) {
                            let completed = 0;
                            let total = Object.keys(goals).length + 2;
                            
                            Object.keys(goals).forEach(key => {
                                if (isGoalMetForDay(dayData, key)) completed++;
                            });
                            
                            if (dayData.coldShower) completed++;
                            if (!dayData.lust) completed++;
                            
                            return Math.round((completed / total) * 100);
                        }
                    }
                    return 0;
                });
                
                return {
                    labels,
                    datasets: [{
                        label: 'Consistency %',
                        data: consistencyData,
                        borderColor: '#48bb78',
                        backgroundColor: '#48bb7820',
                        tension: 0.4,
                        fill: true
                    }]
                };
            }
            
            // ==================== RESET FUNCTIONS ====================
            function showResetConfirm() {
                document.getElementById('resetConfirm').style.display = 'block';
            }
            
            function hideResetConfirm() {
                document.getElementById('resetConfirm').style.display = 'none';
            }
            
            function hardReset() {
                if (confirm("Are you sure you want to delete ALL data? This cannot be undone!")) {
                    localStorage.removeItem('lifeTrackerData');
                    localStorage.removeItem('sickRestDays');
                    localStorage.removeItem('activityPauses');
                    localStorage.removeItem('inactivityTracker');
                    localStorage.removeItem('lifeTrackerPoints');
                    
                    // Reset state
                    todayDataSaved = false;
                    trainingSessionCounter = 0;
                    currentDateOffset = 0;
                    sickRestDays = { sick: { active: false, history: [] }, rest: { active: false, history: [] } };
                    activityPauses = {
                        pullUps: { active: false, startDate: null, endDate: null },
                        coldShower: { active: false, startDate: null, endDate: null }
                    };
                    inactivityTracker = {};
                    
                    // Enable inputs
                    enableAllInputs();
                    
                    // Clear all inputs
                    clearInputFields();
                    
                    // Update UI
                    displayCurrentDate();
                    updateCheckboxStyles();
                    updateConsistencyTracker();
                    updateSleepAnalysis();
                    updateBodyweightGoals();
                    updateStreakTracker();
                    updateTotalStats();
                    updateSickRestDisplay();
                    updateActivityPauseDisplay();
                    updatePointsDisplay();
                    updateHabitConsistency();
                    updateChart();
                    
                    hideResetConfirm();
                    
                    // Show success message
                    const resetBtn = document.querySelector('.reset-btn');
                    resetBtn.textContent = '‚úÖ All Data Cleared!';
                    resetBtn.style.background = 'linear-gradient(135deg, #48bb78, #38a169)';
                    setTimeout(() => {
                        resetBtn.textContent = 'üóëÔ∏è Hard Reset All Data';
                        resetBtn.style.background = 'linear-gradient(135deg, #f56565, #c53030)';
                    }, 3000);
                }
            }
            
            // ==================== DEBUG FUNCTIONS ====================
            function checkPointsIntegrity() {
                const pointsHistory = JSON.parse(localStorage.getItem('lifeTrackerPoints')) || { total: 0, days: {} };
                let calculatedTotal = 0;
                
                Object.values(pointsHistory.days).forEach(day => {
                    calculatedTotal += day.points || 0;
                });
                
                console.log("Stored total:", pointsHistory.total);
                console.log("Calculated total:", calculatedTotal);
                console.log("Days recorded:", Object.keys(pointsHistory.days).length);
                
                if (pointsHistory.total !== calculatedTotal) {
                    console.log("Points mismatch! Fixing...");
                    pointsHistory.total = calculatedTotal;
                    localStorage.setItem('lifeTrackerPoints', JSON.stringify(pointsHistory));
                    updatePointsDisplay();
                }
                
                return pointsHistory.total;
            }
        </script>
    
    Now you need to add the HTML structure for the new features. Add this to your HTML where you want the date navigation and pause toggles to appear:
    html
    
    <!-- Add this near your date display -->
    <div class="date-navigation" style="display: flex; align-items: center; justify-content: center; gap: 10px; margin: 10px 0;">
        <button id="prevDayBtn" onclick="goToPreviousDay()" style="padding: 5px 15px; background: #4a5568; border: none; border-radius: 5px; color: white; cursor: pointer; display: flex; align-items: center;">
            ‚Üê Previous Day
        </button>
        
        <div id="dateOffsetDisplay" style="color: #48bb78; font-weight: bold; min-width: 100px; text-align: center;">
            Today
        </div>
        
        <button id="nextDayBtn" onclick="goToNextDay()" style="padding: 5px 15px; background: #4a5568; border: none; border-radius: 5px; color: white; cursor: pointer; display: none; align-items: center;">
            Next Day ‚Üí
        </button>
        
        <button id="todayBtn" onclick="goToToday()" style="padding: 5px 15px; background: #48bb78; border: none; border-radius: 5px; color: white; cursor: pointer; display: none; align-items: center;">
            Back to Today
        </button>
    </div>
    
    <!-- Add these pause toggles near your sick/rest toggles -->
    <div class="pause-controls" style="margin: 15px 0;">
        <div class="pause-toggle-item" style="margin-bottom: 10px;">
            <div class="pause-toggle pullups-pause-toggle" onclick="togglePullUpsPause()" style="display: flex; align-items: center; justify-content: space-between; background: #4a5568; padding: 10px 15px; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.2rem;">ü§∏</span>
                    <span style="font-weight: bold;">Pause Pull-ups</span>
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span id="pullUpsPauseIndicator" style="font-size: 0.8rem; color: #a0aec0;">ACTIVE</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="pullUpsPauseToggle" style="display: none;">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
            <div style="font-size: 0.8rem; color: #a0aec0; margin-top: 5px; padding-left: 10px;">
                Use when traveling or no pull-up bar available
            </div>
        </div>
        
        <div class="pause-toggle-item">
            <div class="pause-toggle coldshower-pause-toggle" onclick="toggleColdShowerPause()" style="display: flex; align-items: center; justify-content: space-between; background: #4a5568; padding: 10px 15px; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.2rem;">üöø</span>
                    <span style="font-weight: bold;">Pause Cold Shower</span>
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span id="coldShowerPauseIndicator" style="font-size: 0.8rem; color: #a0aec0;">ACTIVE</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="coldShowerPauseToggle" style="display: none;">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
            <div style="font-size: 0.8rem; color: #a0aec0; margin-top: 5px; padding-left: 10px;">
                Use when traveling or cold shower unavailable
            </div>
        </div>
    </div>
    </script>
</body>
</html>








