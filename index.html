<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeTracker Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* [Keep all your existing CSS styles - they remain exactly the same] */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .date-display {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
        }
        
        .tracking-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            min-height: calc(100vh - 200px);
        }
        
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: sticky;
            top: 20px;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
        }
        
        /* [All other CSS styles remain exactly the same] */
        /* ... */
        
        /* Add this new style for consistency cards */
        .consistency-overall {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        
        .consistency-overall-title {
            font-size: 1.4rem;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
        }
        
        .consistency-percentage {
            font-size: 3rem;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .consistency-days {
            text-align: center;
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .habit-break-warning {
            background: rgba(255, 193, 7, 0.2);
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
        }
        
        .habit-break-title {
            font-weight: bold;
            color: #ff9800;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .habit-break-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 193, 7, 0.3);
        }
        
        .habit-break-item:last-child {
            border-bottom: none;
        }
    </style>
    <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåü LifeTracker Pro</h1>
            <div class="date-display" id="currentDate"></div>
        </div>
        <div class="main-content">
            <div class="tracking-section">
                <!-- CONSISTENCY OVERALL CARD (ADDED AT TOP) -->
                <div class="consistency-overall">
                    <div class="consistency-overall-title">üìä Overall Consistency</div>
                    <div class="consistency-percentage" id="overallConsistency">0%</div>
                    <div class="consistency-days" id="consistencyDays">0/0 days completed</div>
                    <div id="habitBreakWarning" class="habit-break-warning" style="display: none;">
                        <div class="habit-break-title">‚ö†Ô∏è Streak Breaks Detected</div>
                        <div id="habitBreakList"></div>
                    </div>
                </div>
                
                <div class="input-grid">
                    <div class="input-group"><label for="stretching">üßò Stretching Sessions</label> <input type="number" id="stretching" placeholder="Enter sessions"></div>
                    <div class="input-group"><label for="steps">üëü Steps Taken</label> <input type="number" id="steps" placeholder="Enter steps"></div>
                    <div class="input-group sleep-expanded">
                        <label for="sleepHours">üò¥ Sleep Time</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                            <div>
                                <label for="sleepHours" style="font-size: 0.9rem; color: #666;">Hours</label>
                                <input type="number" id="sleepHours" step="0.5" placeholder="Hours" min="0" max="24">
                            </div>
                            <div>
                                <label for="sleepMinutes" style="font-size: 0.9rem; color: #666;">Minutes</label>
                                <input type="number" id="sleepMinutes" placeholder="Minutes" min="0" max="59">
                            </div>
                        </div>
                        <div class="sleep-details">
                            <div class="sleep-detail-item">
                                <label for="sleepQuality">Sleep Score (1-100)</label>
                                <input type="number" id="sleepQuality" min="1" max="100" placeholder="Rate 1-100">
                            </div>
                            
                            <div class="sleep-detail-item">
                                <label>REM Sleep</label>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                                    <input type="number" id="remHours" placeholder="H" min="0" max="24" style="text-align: center;">
                                    <input type="number" id="remMinutes" placeholder="M" min="0" max="59" style="text-align: center;">
                                </div>
                            </div>
                            
                            <div class="sleep-detail-item">
                                <label>Deep Sleep</label>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                                    <input type="number" id="deepHours" placeholder="H" min="0" max="24" style="text-align: center;">
                                    <input type="number" id="deepMinutes" placeholder="M" min="0" max="59" style="text-align: center;">
                                </div>
                            </div>
                            
                            <div class="sleep-detail-item">
                                <label>Light Sleep</label>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                                    <input type="number" id="lightHours" placeholder="H" min="0" max="24" style="text-align: center;">
                                    <input type="number" id="lightMinutes" placeholder="M" min="0" max="59" style="text-align: center;">
                                </div>
                            </div>
                            
                            <div class="checkbox-group" style="margin-top: 10px;">
                                <input type="checkbox" id="napped">
                                <label for="napped">Took a nap today</label>
                            </div>
                        </div>
                    </div>
                    <div class="input-group"><label for="water">üíß Water (Liters)</label> <input type="number" id="water" step="0.1" placeholder="Enter liters"></div>
                    <div class="input-group"><label for="screenTime">üì± Screen Time (Hours)</label> <input type="number" id="screenTime" step="0.5" placeholder="Enter hours"></div>
                    <div class="input-group"><label for="pages">üìö Pages Read</label> <input type="number" id="pages" placeholder="Enter pages"></div>
                    <div class="input-group training-expanded">
                        <label>üí™ Training Sessions</label>
                        
                        <!-- REST DAY BUTTON (NEW) -->
                        <div style="margin-bottom: 15px; text-align: center;">
                            <button id="restDayBtn" class="nav-btn" style="background: #6c757d; width: 100%;" onclick="toggleRestDay()">
                                üõå Rest Day (Pause Training Streaks)
                            </button>
                            <div id="restDayStatus" style="font-size: 0.8rem; color: #666; margin-top: 5px; display: none;">
                                ‚úÖ Training streaks paused for today
                            </div>
                        </div>
                        
                        <div class="training-checkboxes">
                            <!-- Gym Session 1 -->
                            <div class="checkbox-group">
                                <input type="checkbox" id="hadGym">
                                <label for="hadGym">üèãÔ∏è Gym Session 1</label>
                            </div>
                            
                            <div id="gymDetails" class="training-details" style="display: none;">
                                <div style="margin-bottom: 10px;">
                                    <label style="display: block; margin-bottom: 5px; font-size: 0.9rem; color: #666;">Workout Focus:</label>
                                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="gymCore">
                                            <label for="gymCore" style="font-size: 0.9rem;">Core</label>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="gymLegs">
                                            <label for="gymLegs" style="font-size: 0.9rem;">Legs</label>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="gymUpper">
                                            <label for="gymUpper" style="font-size: 0.9rem;">Upper</label>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="gymFull">
                                            <label for="gymFull" style="font-size: 0.9rem;">Full Body</label>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="gymCardio">
                                            <label for="gymCardio" style="font-size: 0.9rem;">Cardio</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div>
                                        <label for="gymDuration" style="font-size: 0.9rem; color: #666;">Duration (min)</label>
                                        <input type="number" id="gymDuration" placeholder="Minutes" min="0">
                                    </div>
                                    <div>
                                        <label for="gymIntensity" style="font-size: 0.9rem; color: #666;">Intensity (1-10)</label>
                                        <input type="number" id="gymIntensity" min="1" max="10" placeholder="1-10">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Gym Session 2 -->
                            <div class="checkbox-group" style="margin-top: 15px;">
                                <input type="checkbox" id="hadGym2">
                                <label for="hadGym2">üèãÔ∏è Gym Session 2</label>
                            </div>
                            
                            <div id="gymDetails2" class="training-details" style="display: none;">
                                <div style="margin-bottom: 10px;">
                                    <label style="display: block; margin-bottom: 5px; font-size: 0.9rem; color: #666;">Workout Focus:</label>
                                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="gym2Core">
                                            <label for="gym2Core" style="font-size: 0.9rem;">Core</label>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="gym2Legs">
                                            <label for="gym2Legs" style="font-size: 0.9rem;">Legs</label>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="gym2Upper">
                                            <label for="gym2Upper" style="font-size: 0.9rem;">Upper</label>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="gym2Full">
                                            <label for="gym2Full" style="font-size: 0.9rem;">Full Body</label>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="gym2Cardio">
                                            <label for="gym2Cardio" style="font-size: 0.9rem;">Cardio</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div>
                                        <label for="gym2Duration" style="font-size: 0.9rem; color: #666;">Duration (min)</label>
                                        <input type="number" id="gym2Duration" placeholder="Minutes" min="0">
                                    </div>
                                    <div>
                                        <label for="gym2Intensity" style="font-size: 0.9rem; color: #666;">Intensity (1-10)</label>
                                        <input type="number" id="gym2Intensity" min="1" max="10" placeholder="1-10">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Home Workout -->
                            <div class="checkbox-group" style="margin-top: 15px;">
                                <input type="checkbox" id="hadHome">
                                <label for="hadHome">üè† Home Workout</label>
                            </div>
                            
                            <div id="homeDetails" class="training-details" style="display: none;">
                                <div style="margin-bottom: 10px;">
                                    <label style="display: block; margin-bottom: 5px; font-size: 0.9rem; color: #666;">Workout Type:</label>
                                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="homeBodyweight">
                                            <label for="homeBodyweight" style="font-size: 0.9rem;">Bodyweight</label>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="homeYoga">
                                            <label for="homeYoga" style="font-size: 0.9rem;">Yoga/Stretch</label>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="homeHIIT">
                                            <label for="homeHIIT" style="font-size: 0.9rem;">HIIT</label>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="homeOther">
                                            <label for="homeOther" style="font-size: 0.9rem;">Other</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div>
                                        <label for="homeDuration" style="font-size: 0.9rem; color: #666;">Duration (min)</label>
                                        <input type="number" id="homeDuration" placeholder="Minutes" min="0">
                                    </div>
                                    <div>
                                        <label for="homeIntensity" style="font-size: 0.9rem; color: #666;">Intensity (1-10)</label>
                                        <input type="number" id="homeIntensity" min="1" max="10" placeholder="1-10">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Running Session 1 -->
                            <div class="checkbox-group" style="margin-top: 15px;">
                                <input type="checkbox" id="hadRun">
                                <label for="hadRun">üèÉ Running Session 1</label>
                            </div>
                            
                            <div id="runDetails" class="run-details" style="display: none;">
                                <div class="run-detail-item">
                                    <label for="runType">Run Type</label>
                                    <select id="runType">
                                        <option value="">Select type</option>
                                        <option value="interval">Interval Training</option>
                                        <option value="free">Free Run</option>
                                        <option value="race">Race</option>
                                        <option value="tempo">Tempo Run</option>
                                        <option value="long">Long Distance</option>
                                        <option value="recovery">Recovery Run</option>
                                        <option value="hill">Hill Training</option>
                                    </select>
                                </div>
                                <div class="run-detail-item">
                                    <label for="runDistance">Distance (km)</label>
                                    <input type="number" id="runDistance" step="0.1" placeholder="Enter distance">
                                </div>
                                <div class="run-detail-item">
                                    <label for="runDuration">Duration (min)</label>
                                    <input type="number" id="runDuration" placeholder="Minutes">
                                </div>
                                <div class="run-detail-item">
                                    <label for="runIntensity">Intensity (1-10)</label>
                                    <input type="number" id="runIntensity" min="1" max="10" placeholder="1-10">
                                </div>
                            </div>
                            
                            <!-- Running Session 2 -->
                            <div class="checkbox-group" style="margin-top: 15px;">
                                <input type="checkbox" id="hadRun2">
                                <label for="hadRun2">üèÉ Running Session 2</label>
                            </div>
                            
                            <div id="runDetails2" class="run-details" style="display: none;">
                                <div class="run-detail-item">
                                    <label for="runType2">Run Type</label>
                                    <select id="runType2">
                                        <option value="">Select type</option>
                                        <option value="interval">Interval Training</option>
                                        <option value="free">Free Run</option>
                                        <option value="race">Race</option>
                                        <option value="tempo">Tempo Run</option>
                                        <option value="long">Long Distance</option>
                                        <option value="recovery">Recovery Run</option>
                                        <option value="hill">Hill Training</option>
                                    </select>
                                </div>
                                <div class="run-detail-item">
                                    <label for="runDistance2">Distance (km)</label>
                                    <input type="number" id="runDistance2" step="0.1" placeholder="Enter distance">
                                </div>
                                <div class="run-detail-item">
                                    <label for="runDuration2">Duration (min)</label>
                                    <input type="number" id="runDuration2" placeholder="Minutes">
                                </div>
                                <div class="run-detail-item">
                                    <label for="runIntensity2">Intensity (1-10)</label>
                                    <input type="number" id="runIntensity2" min="1" max="10" placeholder="1-10">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Bodyweight Goals -->
                        <div class="bodyweight-goals">
                            <div class="bodyweight-title">üèãÔ∏è Bodyweight Goals</div>
                            <div class="bodyweight-inputs">
                                <div class="bodyweight-item">
                                    <label for="pushUps">Push-ups Count</label>
                                    <input type="number" id="pushUps" placeholder="Enter push-ups count" min="0">
                                </div>
                                <div class="bodyweight-item">
                                    <label for="pullUps">Pull-ups Count</label>
                                    <input type="number" id="pullUps" placeholder="Enter pull-ups count" min="0">
                                </div>
                            </div>
                            <div class="bodyweight-goal-display">
                                <div class="bodyweight-goal">
                                    <div class="bodyweight-goal-value" id="pushUpsGoal">0/50</div>
                                    <div class="bodyweight-goal-label">Push-ups Goal</div>
                                </div>
                                <div class="bodyweight-goal">
                                    <div class="bodyweight-goal-value" id="pullUpsGoal">0/20</div>
                                    <div class="bodyweight-goal-label">Pull-ups Goal</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="input-group" id="coldShowerGroup"><label>üöø Cold Shower</label>
                        <div class="checkbox-group"><input type="checkbox" id="coldShower"> <label for="coldShower">Took cold shower today</label></div>
                    </div>
                    <div class="input-group" id="lustGroup"><label>üö´ Lust Control</label>
                        <div class="checkbox-group"><input type="checkbox" id="lust"> <label for="lust">Broke lust control (check if failed)</label></div>
                    </div>
                </div>
                <button class="save-btn" onclick="saveData()">üíæ Save Today's Data</button>
                <div class="nav-buttons">
                    <button class="nav-btn active" onclick="showChart('stretching')">üßò Stretching</button>
                    <button class="nav-btn" onclick="showChart('steps')">üëü Steps</button>
                    <button class="nav-btn" onclick="showChart('sleep')">üò¥ Sleep</button>
                    <button class="nav-btn" onclick="showChart('water')">üíß Water</button>
                    <button class="nav-btn" onclick="showChart('screenTime')">üì± Screen Time</button>
                    <button class="nav-btn" onclick="showChart('pages')">üìö Reading</button>
                    <button class="nav-btn" onclick="showChart('training')">üí™ Training</button>
                    <button class="nav-btn" onclick="showChart('consistency')">üìä Consistency</button>
                </div>
                <div class="chart-container">
                    <div class="period-selector">
                        <button class="period-btn active" onclick="changePeriod('daily')">Daily</button>
                        <button class="period-btn" onclick="changePeriod('weekly')">Weekly</button>
                        <button class="period-btn" onclick="changePeriod('monthly')">Monthly</button>
                    </div>
                    <div class="chart-title" id="chartTitle">Stretching Sessions - Last 7 Days</div>
                    <div class="chart-wrapper">
                        <canvas id="mainChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="points-card">
                    <div class="points-header">
                        <div class="points-title">üéÆ Points System</div>
                        <div class="points-total" id="totalPoints">0</div>
                    </div>
                    <div class="level-indicator">
                        <div class="level-text" id="levelText">Level 1 (0/100)</div>
                        <div class="level-bar">
                            <div class="level-progress" id="levelProgress" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="points-today" id="todayPoints">Today: 0 points</div>
                    <div class="points-breakdown" id="pointsBreakdown">
                        <!-- Points breakdown will be added here by JavaScript -->
                    </div>
                </div>
                <div class="pause-section">
                    <div class="pause-title">‚è∏Ô∏è Pause Streaks</div>
                    <div class="pause-toggle" onclick="togglePause('steps')">
                        <input type="checkbox" class="pause-checkbox" id="pauseSteps">
                        <span class="pause-label">Steps Taken</span>
                        <span class="pause-days" id="pauseStepsDays">0 days</span>
                    </div>
                    <div class="pause-toggle" onclick="togglePause('training')">
                        <input type="checkbox" class="pause-checkbox" id="pauseTraining">
                        <span class="pause-label">Training Sessions</span>
                        <span class="pause-days" id="pauseTrainingDays">0 days</span>
                    </div>
                    <div class="pause-toggle" onclick="togglePause('coldShower')">
                        <input type="checkbox" class="pause-checkbox" id="pauseColdShower">
                        <span class="pause-label">Cold Showers</span>
                        <span class="pause-days" id="pauseColdShowerDays">0 days</span>
                    </div>
                    <!-- NEW: Pause for bodyweight training -->
                    <div class="pause-toggle" onclick="togglePause('pushUps')">
                        <input type="checkbox" class="pause-checkbox" id="pausePushUps">
                        <span class="pause-label">Push-ups</span>
                        <span class="pause-days" id="pausePushUpsDays">0 days</span>
                    </div>
                    <div class="pause-toggle" onclick="togglePause('pullUps')">
                        <input type="checkbox" class="pause-checkbox" id="pausePullUps">
                        <span class="pause-label">Pull-ups</span>
                        <span class="pause-days" id="pausePullUpsDays">0 days</span>
                    </div>
                    <div class="pause-note">Toggle on to freeze streak when sick/resting</div>
                    <div class="reset-section">
                        <div class="reset-title">‚ö†Ô∏è Reset All Data</div>
                        <button class="reset-btn" onclick="showResetConfirm()">üóëÔ∏è Hard Reset All Data</button>
                        <div class="reset-confirm" id="resetConfirm">
                            <div style="color: #856404; margin-bottom: 10px; font-weight: 600;">
                                ‚ö†Ô∏è Are you sure? This will delete ALL data permanently!
                            </div>
                            <div class="reset-confirm-buttons">
                                <button class="reset-confirm-btn reset-confirm-yes" onclick="hardReset()">Yes, Delete Everything</button>
                                <button class="reset-confirm-btn reset-confirm-no" onclick="hideResetConfirm()">Cancel</button>
                            </div>
                        </div>
                        <div class="reset-note">This will clear all input fields and delete all saved data</div>
                    </div>
                </div>
                <div class="quote-card">
                    <div class="quote-text" id="dailyQuote"></div>
                    <div class="quote-author" id="quoteAuthor"></div>
                </div>
                <div class="sleep-card">
                    <div class="consistency-title">üò¥ Sleep Analysis</div>
                    <div id="sleepAnalysis">
                        <div style="text-align: center; color: #888; padding: 20px;">Enter sleep data to see analysis</div>
                    </div>
                </div>
                <div class="consistency-card">
                    <div class="consistency-title">üéØ Today's Goals</div>
                    <div id="consistencyTracker"></div>
                </div>
                <div class="consistency-card">
                    <div class="consistency-title">üî• Consistency Streaks</div>
                    <div id="streakTracker"></div>
                </div>
                <div class="consistency-card">
                    <div class="consistency-title">üìä Total Statistics</div>
                    <div id="totalStats"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ==================== UPDATED CONFIGURATION ====================
        
        // Motivational quotes
        const quotes = [
            { text: "The only way to do great work is to love what you do.", author: "Steve Jobs" },
            { text: "Success is not final, failure is not fatal: it is the courage to continue that counts.", author: "Winston Churchill" },
            { text: "The future belongs to those who believe in the beauty of their dreams.", author: "Eleanor Roosevelt" },
            { text: "It is during our darkest moments that we must focus to see the light.", author: "Aristotle" },
            { text: "The only impossible journey is the one you never begin.", author: "Tony Robbins" },
            { text: "In the middle of difficulty lies opportunity.", author: "Albert Einstein" },
            { text: "Believe you can and you're halfway there.", author: "Theodore Roosevelt" },
            { text: "The way to get started is to quit talking and begin doing.", author: "Walt Disney" },
            { text: "Don't watch the clock; do what it does. Keep going.", author: "Sam Levenson" },
            { text: "A year from now you may wish you had started today.", author: "Karen Lamb" }
        ];
        
        // Goals for consistency tracking
        const goals = {
            steps: 10000,
            water: 2,
            pages: 20,
            stretching: 2,
            sleep: 8,
            screenTime: 2,
            training: 1,
            pushUps: 50,
            pullUps: 20
        };
        
        // Pause/Freeze functionality storage
        let pausedStreaks = JSON.parse(localStorage.getItem('pausedStreaks')) || {
            steps: { paused: false, days: 0 },
            training: { paused: false, days: 0 },
            coldShower: { paused: false, days: 0 },
            pushUps: { paused: false, days: 0 },
            pullUps: { paused: false, days: 0 }
        };
        
        // Rest day tracking
        let isRestDay = JSON.parse(localStorage.getItem('isRestDay')) || false;
        const todayStr = new Date().toISOString().split('T')[0];
        const lastRestDay = localStorage.getItem('lastRestDay');
        
        // Points System Configuration - UPDATED BASED ON YOUR REQUEST
        const pointsConfig = {
            // Base points for completing habits
            stretching: 10,
            steps: 15,
            sleep: 25, // Only given when BOTH conditions met
            water: 10,
            screenTime: 15,
            pages: 10,
            training: {
                base: 20,
                bonus_1h15: 10, // Bonus for training > 1h15
                bonus_intense: 15, // Bonus for intensity > 7
                per_session: 5 // Additional per session after first
            },
            coldShower: 20,
            lustControl: 30,
            pushUps: 15,
            pullUps: 15,
            bodyweightBonus: 10, // Bonus for completing both push-ups and pull-ups
            
            // Points deductions
            deductions: {
                sleepScoreLow: -15, // Score <= 60
                sleepShort: -20, // < 7h
                sleepWrongRange: -10, // < 8h or > 9.5h (even with good score)
                stretching: -10,
                steps: -15,
                water: -10,
                screenTime: -10,
                pages: -10,
                pushUps: -10,
                pullUps: -10,
                training: -20,
                streakBreak: -30, // For breaking streak > 3 days
                lust: -50
            },
            
            // Bonuses for exceeding goals
            exceedBonuses: {
                steps: 0.005, // 0.5 points per 100 extra steps
                water: 5,
                pages: 0.5,
                stretching: 3,
                pushUps: 1,
                pullUps: 1
            },
            
            // Streak multipliers
            streakMultipliers: {
                3: 1.2,
                7: 1.5,
                14: 2.0,
                30: 3.0
            },
            
            // Daily completion bonus
            dailyCompletionBonus: 50
        };
        
        let currentChart = null;
        let currentView = 'stretching';
        let currentPeriod = 'daily';
        
        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            displayCurrentDate();
            displayDailyQuote();
            loadTodaysData();
            updateConsistencyTracker();
            updateStreakTracker();
            updateTotalStats();
            updatePointsDisplay();
            initializeChart();
            updateOverallConsistency();
            
            // Initialize pause system
            updatePauseDisplay();
            resetPauseCounters();
            
            // Initialize rest day
            updateRestDayDisplay();
            
            // Training session toggle listeners
            document.getElementById('hadGym').addEventListener('change', function() {
                document.getElementById('gymDetails').style.display = this.checked ? 'block' : 'none';
                updateConsistencyTracker();
                updatePointsDisplay();
            });
            
            document.getElementById('hadGym2').addEventListener('change', function() {
                document.getElementById('gymDetails2').style.display = this.checked ? 'block' : 'none';
                updateConsistencyTracker();
                updatePointsDisplay();
            });
            
            document.getElementById('hadHome').addEventListener('change', function() {
                document.getElementById('homeDetails').style.display = this.checked ? 'block' : 'none';
                updateConsistencyTracker();
                updatePointsDisplay();
            });
            
            document.getElementById('hadRun').addEventListener('change', function() {
                document.getElementById('runDetails').style.display = this.checked ? 'grid' : 'none';
                if (!this.checked) {
                    document.getElementById('runType').value = '';
                    document.getElementById('runDistance').value = '';
                    document.getElementById('runDuration').value = '';
                    document.getElementById('runIntensity').value = '';
                }
                updateConsistencyTracker();
                updatePointsDisplay();
            });
            
            document.getElementById('hadRun2').addEventListener('change', function() {
                document.getElementById('runDetails2').style.display = this.checked ? 'grid' : 'none';
                if (!this.checked) {
                    document.getElementById('runType2').value = '';
                    document.getElementById('runDistance2').value = '';
                    document.getElementById('runDuration2').value = '';
                    document.getElementById('runIntensity2').value = '';
                }
                updateConsistencyTracker();
                updatePointsDisplay();
            });
            
            // Bodyweight inputs listeners
            document.getElementById('pushUps').addEventListener('input', function() {
                updateBodyweightGoals();
                updateConsistencyTracker();
                updatePointsDisplay();
            });
            
            document.getElementById('pullUps').addEventListener('input', function() {
                updateBodyweightGoals();
                updateConsistencyTracker();
                updatePointsDisplay();
            });
            
            // Training input listeners
            const trainingInputs = ['gymDuration', 'gymIntensity', 'gym2Duration', 'gym2Intensity', 
                                   'homeDuration', 'homeIntensity', 'runDistance', 'runDuration', 
                                   'runIntensity', 'runDistance2', 'runDuration2', 'runIntensity2',
                                   'runType', 'runType2'];
            
            trainingInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', function() {
                        updateConsistencyTracker();
                        updatePointsDisplay();
                    });
                }
            });
            
            // Workout type checkboxes
            ['gymCore', 'gymLegs', 'gymUpper', 'gymFull', 'gymCardio',
             'gym2Core', 'gym2Legs', 'gym2Upper', 'gym2Full', 'gym2Cardio',
             'homeBodyweight', 'homeYoga', 'homeHIIT', 'homeOther'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', function() {
                        updatePointsDisplay();
                    });
                }
            });
            
            // General input listeners
            ['stretching', 'steps', 'sleepHours', 'water', 'screenTime', 'pages'].forEach(id => {
                document.getElementById(id).addEventListener('input', function() {
                    updateConsistencyTracker();
                    updatePointsDisplay();
                    updateOverallConsistency();
                });
            });
            
            // Sleep input listeners
            ['sleepHours', 'sleepMinutes', 'sleepQuality', 'remHours', 'remMinutes', 
             'deepHours', 'deepMinutes', 'lightHours', 'lightMinutes'].forEach(id => {
                document.getElementById(id).addEventListener('input', function() {
                    updateSleepAnalysis();
                    updateConsistencyTracker();
                    updatePointsDisplay();
                    updateOverallConsistency();
                });
            });
            
            // Checkbox listeners
            ['coldShower', 'lust', 'napped'].forEach(id => {
                document.getElementById(id).addEventListener('change', function() {
                    if (id === 'coldShower' || id === 'lust') updateCheckboxStyles();
                    if (id === 'napped') updateSleepAnalysis();
                    updateConsistencyTracker();
                    updatePointsDisplay();
                    updateOverallConsistency();
                });
            });
            
            // Initialize displays
            updateSleepAnalysis();
            updateBodyweightGoals();
        });
        
        // ==================== BASIC FUNCTIONS ====================
        function displayCurrentDate() {
            const today = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            document.getElementById('currentDate').textContent = today.toLocaleDateString('en-US', options);
            clearOldData();
        }
        
        function clearOldData() {
            const today = new Date().toISOString().split('T')[0];
            const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
            
            if (allData[today]) return; // Don't clear if data exists for today
            
            // Clear inputs
            ['stretching', 'steps', 'sleepHours', 'sleepMinutes', 'water', 'screenTime', 'pages', 
             'sleepQuality', 'remHours', 'remMinutes', 'deepHours', 'deepMinutes', 
             'lightHours', 'lightMinutes', 'runDistance', 'runDistance2',
             'gymDuration', 'gymIntensity', 'gym2Duration', 'gym2Intensity',
             'homeDuration', 'homeIntensity', 'runDuration', 'runIntensity',
             'runDuration2', 'runIntensity2', 'pushUps', 'pullUps'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.value = '';
            });
            
            // Clear checkboxes
            ['hadGym', 'hadGym2', 'hadHome', 'hadRun', 'hadRun2', 'coldShower', 'lust', 'napped'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.checked = false;
            });
            
            // Clear workout type checkboxes
            ['gymCore', 'gymLegs', 'gymUpper', 'gymFull', 'gymCardio',
             'gym2Core', 'gym2Legs', 'gym2Upper', 'gym2Full', 'gym2Cardio',
             'homeBodyweight', 'homeYoga', 'homeHIIT', 'homeOther'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.checked = false;
            });
            
            // Clear selects
            ['runType', 'runType2'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.value = '';
            });
            
            // Hide details
            ['gymDetails', 'gymDetails2', 'homeDetails', 'runDetails', 'runDetails2'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.style.display = 'none';
            });
            
            updateCheckboxStyles();
            updateConsistencyTracker();
            updateSleepAnalysis();
            updateBodyweightGoals();
            updateOverallConsistency();
        }
        
        function displayDailyQuote() {
            const today = new Date();
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
            const quoteIndex = dayOfYear % quotes.length;
            document.getElementById('dailyQuote').textContent = `"${quotes[quoteIndex].text}"`;
            document.getElementById('quoteAuthor').textContent = `‚Äî ${quotes[quoteIndex].author}`;
        }
        
        function updateCheckboxStyles() {
            const coldShowerGroup = document.getElementById('coldShowerGroup');
            const lustGroup = document.getElementById('lustGroup');
            const coldShowerChecked = document.getElementById('coldShower').checked;
            const lustChecked = document.getElementById('lust').checked;
            
            coldShowerGroup.classList.toggle('cold-shower-checked', coldShowerChecked);
            lustGroup.classList.toggle('lust-checked', lustChecked);
            updateConsistencyTracker();
        }
        
        function updateBodyweightGoals() {
            const pushUps = parseInt(document.getElementById('pushUps').value) || 0;
            const pullUps = parseInt(document.getElementById('pullUps').value) || 0;
            
            document.getElementById('pushUpsGoal').textContent = `${pushUps}/${goals.pushUps}`;
            document.getElementById('pullUpsGoal').textContent = `${pullUps}/${goals.pullUps}`;
        }
        
        function toggleRestDay() {
            isRestDay = !isRestDay;
            localStorage.setItem('isRestDay', JSON.stringify(isRestDay));
            
            if (isRestDay) {
                localStorage.setItem('lastRestDay', todayStr);
                // Auto-pause training streaks on rest day
                pausedStreaks.training.paused = true;
                pausedStreaks.pushUps.paused = true;
                pausedStreaks.pullUps.paused = true;
                localStorage.setItem('pausedStreaks', JSON.stringify(pausedStreaks));
            } else {
                // Unpause if not rest day
                pausedStreaks.training.paused = false;
                pausedStreaks.pushUps.paused = false;
                pausedStreaks.pullUps.paused = false;
                localStorage.setItem('pausedStreaks', JSON.stringify(pausedStreaks));
            }
            
            updateRestDayDisplay();
            updatePauseDisplay();
            updatePointsDisplay();
            updateConsistencyTracker();
        }
        
        function updateRestDayDisplay() {
            const restDayBtn = document.getElementById('restDayBtn');
            const restDayStatus = document.getElementById('restDayStatus');
            
            if (isRestDay) {
                restDayBtn.textContent = '‚úÖ Rest Day Active';
                restDayBtn.style.background = 'linear-gradient(135deg, #4CAF50, #45a049)';
                restDayStatus.style.display = 'block';
            } else {
                restDayBtn.textContent = 'üõå Rest Day (Pause Training Streaks)';
                restDayBtn.style.background = '#6c757d';
                restDayStatus.style.display = 'none';
            }
        }
        
        // ==================== INPUT DATA FUNCTIONS ====================
        function getCurrentInputs() {
            // Sleep calculations
            const sleepHours = parseFloat(document.getElementById('sleepHours').value) || 0;
            const sleepMinutes = parseFloat(document.getElementById('sleepMinutes').value) || 0;
            const totalSleepHours = sleepHours + (sleepMinutes / 60);
            
            const remHours = parseFloat(document.getElementById('remHours').value) || 0;
            const remMinutes = parseFloat(document.getElementById('remMinutes').value) || 0;
            const totalRemMinutes = (remHours * 60) + remMinutes;
            
            const deepHours = parseFloat(document.getElementById('deepHours').value) || 0;
            const deepMinutes = parseFloat(document.getElementById('deepMinutes').value) || 0;
            const totalDeepMinutes = (deepHours * 60) + deepMinutes;
            
            const lightHours = parseFloat(document.getElementById('lightHours').value) || 0;
            const lightMinutes = parseFloat(document.getElementById('lightMinutes').value) || 0;
            const totalLightMinutes = (lightHours * 60) + lightMinutes;
            
            // Bodyweight goals
            const pushUps = parseInt(document.getElementById('pushUps').value) || 0;
            const pullUps = parseInt(document.getElementById('pullUps').value) || 0;
            
            // Helper function for workout types
            const getSelectedTypes = (prefix, types) => {
                const selected = [];
                types.forEach(type => {
                    const checkbox = document.getElementById(prefix + type);
                    if (checkbox && checkbox.checked) selected.push(type);
                });
                return selected;
            };
            
            return {
                // Basic inputs
                stretching: document.getElementById('stretching').value,
                steps: document.getElementById('steps').value,
                sleep: totalSleepHours.toFixed(2),
                sleepHours: sleepHours,
                sleepMinutes: sleepMinutes,
                sleepQuality: document.getElementById('sleepQuality').value,
                remSleep: totalRemMinutes,
                remHours: remHours,
                remMinutes: remMinutes,
                deepSleep: totalDeepMinutes,
                deepHours: deepHours,
                deepMinutes: deepMinutes,
                lightSleep: totalLightMinutes,
                lightHours: lightHours,
                lightMinutes: lightMinutes,
                napped: document.getElementById('napped').checked,
                water: document.getElementById('water').value,
                screenTime: document.getElementById('screenTime').value,
                pages: document.getElementById('pages').value,
                coldShower: document.getElementById('coldShower').checked,
                lust: document.getElementById('lust').checked,
                
                // Bodyweight goals
                pushUps: pushUps,
                pullUps: pullUps,
                
                // Training sessions
                hadGym: document.getElementById('hadGym').checked,
                hadGym2: document.getElementById('hadGym2').checked,
                hadHome: document.getElementById('hadHome').checked,
                hadRun: document.getElementById('hadRun').checked,
                hadRun2: document.getElementById('hadRun2').checked,
                
                // Gym 1
                gymTypes: getSelectedTypes('gym', ['Core', 'Legs', 'Upper', 'Full', 'Cardio']),
                gymDuration: document.getElementById('gymDuration').value,
                gymIntensity: document.getElementById('gymIntensity').value,
                
                // Gym 2
                gym2Types: getSelectedTypes('gym2', ['Core', 'Legs', 'Upper', 'Full', 'Cardio']),
                gym2Duration: document.getElementById('gym2Duration').value,
                gym2Intensity: document.getElementById('gym2Intensity').value,
                
                // Home
                homeTypes: getSelectedTypes('home', ['Bodyweight', 'Yoga', 'HIIT', 'Other']),
                homeDuration: document.getElementById('homeDuration').value,
                homeIntensity: document.getElementById('homeIntensity').value,
                
                // Run 1
                runType: document.getElementById('runType').value,
                runDistance: document.getElementById('runDistance').value,
                runDuration: document.getElementById('runDuration').value,
                runIntensity: document.getElementById('runIntensity').value,
                
                // Run 2
                runType2: document.getElementById('runType2').value,
                runDistance2: document.getElementById('runDistance2').value,
                runDuration2: document.getElementById('runDuration2').value,
                runIntensity2: document.getElementById('runIntensity2').value,
                
                // Rest day
                isRestDay: isRestDay
            };
        }
        
        // ==================== OVERALL CONSISTENCY ====================
        function updateOverallConsistency() {
            const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
            const dates = Object.keys(allData).sort();
            
            if (dates.length === 0) {
                document.getElementById('overallConsistency').textContent = '0%';
                document.getElementById('consistencyDays').textContent = '0/0 days completed';
                document.getElementById('habitBreakWarning').style.display = 'none';
                return;
            }
            
            let completedDays = 0;
            const habitBreaks = {};
            
            dates.forEach(date => {
                const dayData = allData[date];
                let dayCompleted = true;
                
                // Check each habit for this day
                Object.keys(goals).forEach(habit => {
                    if (!isHabitCompleted(habit, dayData)) {
                        dayCompleted = false;
                        if (!habitBreaks[habit]) habitBreaks[habit] = 0;
                        habitBreaks[habit]++;
                    }
                });
                
                if (dayCompleted) completedDays++;
            });
            
            const consistency = Math.round((completedDays / dates.length) * 100);
            document.getElementById('overallConsistency').textContent = `${consistency}%`;
            document.getElementById('consistencyDays').textContent = `${completedDays}/${dates.length} days completed`;
            
            // Check for streak breaks > 3 days
            const streakBreaks = checkStreakBreaks(allData, dates);
            if (streakBreaks.length > 0) {
                let html = '<div class="habit-break-title">‚ö†Ô∏è Streak Breaks Detected</div>';
                streakBreaks.forEach(breakInfo => {
                    html += `
                        <div class="habit-break-item">
                            <span>${breakInfo.habit}</span>
                            <span style="color: #f44336; font-weight: bold;">${breakInfo.days} days missed</span>
                        </div>
                    `;
                });
                document.getElementById('habitBreakList').innerHTML = html;
                document.getElementById('habitBreakWarning').style.display = 'block';
            } else {
                document.getElementById('habitBreakWarning').style.display = 'none';
            }
        }
        
        function isHabitCompleted(habit, dayData) {
            if (!dayData) return false;
            
            switch(habit) {
                case 'training':
                    let trainingSessions = 0;
                    if (dayData.hadGym) trainingSessions++;
                    if (dayData.hadRun) trainingSessions++;
                    return trainingSessions >= goals.training;
                    
                case 'pushUps':
                    return (parseInt(dayData.pushUps) || 0) >= goals.pushUps;
                    
                case 'pullUps':
                    return (parseInt(dayData.pullUps) || 0) >= goals.pullUps;
                    
                case 'screenTime':
                    return (parseFloat(dayData.screenTime) || 0) <= goals.screenTime;
                    
                default:
                    return (parseFloat(dayData[habit]) || 0) >= goals[habit];
            }
        }
        
        function checkStreakBreaks(allData, dates) {
            const breaks = [];
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            
            Object.keys(goals).forEach(habit => {
                let streakBroken = false;
                let missedDays = 0;
                let checkingDate = new Date(today);
                
                // Check last 7 days for breaks
                for (let i = 0; i < 7; i++) {
                    const dateStr = checkingDate.toISOString().split('T')[0];
                    const dayData = allData[dateStr];
                    
                    if (dayData) {
                        if (!isHabitCompleted(habit, dayData)) {
                            missedDays++;
                        } else {
                            break; // Streak restored
                        }
                    } else {
                        missedDays++;
                    }
                    
                    checkingDate.setDate(checkingDate.getDate() - 1);
                }
                
                if (missedDays > 3) {
                    // Check if streak was paused
                    const paused = (habit === 'steps' && pausedStreaks.steps.paused) ||
                                  (habit === 'training' && pausedStreaks.training.paused) ||
                                  (habit === 'pushUps' && pausedStreaks.pushUps.paused) ||
                                  (habit === 'pullUps' && pausedStreaks.pullUps.paused);
                    
                    if (!paused) {
                        breaks.push({
                            habit: getHabitDisplayName(habit),
                            days: missedDays
                        });
                    }
                }
            });
            
            return breaks;
        }
        
        function getHabitDisplayName(habit) {
            const names = {
                stretching: 'Stretching',
                steps: 'Steps',
                sleep: 'Sleep',
                water: 'Water',
                screenTime: 'Screen Time',
                pages: 'Reading',
                training: 'Training',
                pushUps: 'Push-ups',
                pullUps: 'Pull-ups'
            };
            return names[habit] || habit;
        }
        
        // ==================== UPDATED POINTS CALCULATION ====================
        function calculateTodayPoints() {
            const currentData = getCurrentInputs();
            const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
            const dates = Object.keys(allData).sort();
            const streaks = calculateStreaksWithPause(dates, allData);
            
            let totalPoints = 0;
            let pointsBreakdown = [];
            let completedGoals = 0;
            const totalGoals = Object.keys(goals).length + 2; // +2 for cold shower and lust control
            
            // Calculate points for each goal
            Object.keys(goals).forEach(key => {
                let points = 0;
                let multiplier = 1;
                let description = '';
                let emoji = '';
                let deduction = 0;
                
                // Streak multiplier
                const streak = streaks[key] || 0;
                for (const [days, mult] of Object.entries(pointsConfig.streakMultipliers).sort((a, b) => b[0] - a[0])) {
                    if (streak >= parseInt(days)) {
                        multiplier = mult;
                        break;
                    }
                }
                
                if (key === 'training') {
                    // Check if it's a rest day
                    if (isRestDay && !pausedStreaks.training.paused) {
                        points = 0;
                        description = 'Training (Rest Day)';
                        emoji = 'üõå';
                    } else {
                        let trainingSessions = 0;
                        if (currentData.hadGym) trainingSessions++;
                        if (currentData.hadGym2) trainingSessions++;
                        if (currentData.hadHome) trainingSessions++;
                        if (currentData.hadRun) trainingSessions++;
                        if (currentData.hadRun2) trainingSessions++;
                        
                        if (trainingSessions >= goals.training) {
                            points = pointsConfig.training.base * multiplier;
                            description = `Training (${trainingSessions} sessions)`;
                            emoji = 'üí™';
                            completedGoals++;
                            
                            // Bonus for > 1h15
                            const totalDuration = (parseInt(currentData.gymDuration) || 0) + 
                                                 (parseInt(currentData.gym2Duration) || 0) +
                                                 (parseInt(currentData.homeDuration) || 0) +
                                                 (parseInt(currentData.runDuration) || 0) +
                                                 (parseInt(currentData.runDuration2) || 0);
                            
                            if (totalDuration > 75) { // 1h15 = 75min
                                const bonus = pointsConfig.training.bonus_1h15;
                                points += bonus;
                                description += ` (+${bonus} for >1h15)`;
                            }
                            
                            // Bonus for high intensity
                            const maxIntensity = Math.max(
                                parseInt(currentData.gymIntensity) || 0,
                                parseInt(currentData.gym2Intensity) || 0,
                                parseInt(currentData.homeIntensity) || 0,
                                parseInt(currentData.runIntensity) || 0,
                                parseInt(currentData.runIntensity2) || 0
                            );
                            
                            if (maxIntensity > 7) {
                                const bonus = pointsConfig.training.bonus_intense;
                                points += bonus;
                                description += ` (+${bonus} for intensity >7)`;
                            }
                            
                            // Bonus for additional sessions
                            if (trainingSessions > 1) {
                                const extraSessions = trainingSessions - 1;
                                const bonus = extraSessions * pointsConfig.training.per_session;
                                points += bonus;
                                description += ` (+${bonus} for ${extraSessions} extra session${extraSessions > 1 ? 's' : ''})`;
                            }
                        } else if (!pausedStreaks.training.paused) {
                            // Deduction for missing training when not paused
                            deduction = pointsConfig.deductions.training;
                            points += deduction;
                            description = `Training (${trainingSessions}/${goals.training})`;
                            emoji = '‚ùå';
                        }
                    }
                } else if (key === 'sleep') {
                    const sleepHours = parseFloat(currentData.sleep) || 0;
                    const sleepScore = parseInt(currentData.sleepQuality) || 0;
                    
                    // Check both conditions: score > 80 AND hours between 8-9.5
                    if (sleepScore > 80 && sleepHours >= 8 && sleepHours <= 9.5) {
                        points = pointsConfig.sleep * multiplier;
                        description = `Sleep (${sleepHours}h, score: ${sleepScore})`;
                        emoji = 'üòä';
                        completedGoals++;
                    } else {
                        // Check for deductions
                        if (sleepScore <= 60) {
                            deduction += pointsConfig.deductions.sleepScoreLow;
                            description = `Sleep score low (${sleepScore})`;
                        }
                        if (sleepHours < 7) {
                            deduction += pointsConfig.deductions.sleepShort;
                            description += description ? ', hours short' : `Sleep hours short (${sleepHours}h)`;
                        }
                        if ((sleepHours < 8 || sleepHours > 9.5) && sleepScore > 80) {
                            deduction += pointsConfig.deductions.sleepWrongRange;
                            description = `Sleep outside ideal range (${sleepHours}h)`;
                        }
                        
                        if (deduction < 0) {
                            points += deduction;
                            emoji = 'üòü';
                        }
                    }
                } else if (key === 'pushUps' || key === 'pullUps') {
                    const current = parseInt(currentData[key]) || 0;
                    const goal = goals[key];
                    
                    if (current >= goal) {
                        points = pointsConfig[key] * multiplier;
                        description = key === 'pushUps' ? 'Push-ups' : 'Pull-ups';
                        emoji = key === 'pushUps' ? 'üí™' : 'ü§∏';
                        completedGoals++;
                        
                        // Bonus for exceeding
                        if (current > goal) {
                            const exceeded = current - goal;
                            const bonus = exceeded * pointsConfig.exceedBonuses[key];
                            points += bonus;
                            description += ` (+${bonus.toFixed(1)} bonus)`;
                        }
                    } else if (!pausedStreaks[key].paused) {
                        // Deduction for missing bodyweight goal
                        deduction = pointsConfig.deductions[key];
                        points += deduction;
                        description = key === 'pushUps' ? 'Push-ups' : 'Pull-ups';
                        emoji = '‚ùå';
                    }
                } else {
                    const current = parseFloat(currentData[key]) || 0;
                    const goal = goals[key];
                    const metGoal = key === 'screenTime' ? current <= goal : current >= goal;
                    const isPaused = (key === 'steps' && pausedStreaks.steps.paused);
                    
                    if (metGoal) {
                        points = pointsConfig[key] * multiplier;
                        description = getHabitDisplayName(key);
                        emoji = getEmojiForActivity(key);
                        completedGoals++;
                        
                        // Bonus for exceeding (except screen time)
                        if (key !== 'screenTime' && current > goal) {
                            const exceeded = current - goal;
                            let bonus = 0;
                            
                            if (key === 'steps') bonus = Math.floor(exceeded * pointsConfig.exceedBonuses.steps);
                            else if (key === 'water') bonus = Math.floor(exceeded * pointsConfig.exceedBonuses.water);
                            else if (key === 'pages') bonus = Math.floor(exceeded * pointsConfig.exceedBonuses.pages);
                            else if (key === 'stretching') bonus = Math.floor(exceeded * pointsConfig.exceedBonuses.stretching);
                            
                            if (bonus > 0) {
                                points += bonus;
                                description += ` (+${bonus} bonus)`;
                            }
                        }
                    } else if (!isPaused) {
                        // Deduction for missing goal when not paused
                        deduction = pointsConfig.deductions[key];
                        points += deduction;
                        description = getHabitDisplayName(key);
                        emoji = '‚ùå';
                    }
                }
                
                // Check for streak breaks > 3 days (additional penalty)
                if (streak === 0 && !pausedStreaks[key]?.paused) {
                    const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
                    const dates = Object.keys(allData).sort();
                    const lastEntry = dates[dates.length - 1];
                    
                    if (lastEntry) {
                        const lastDate = new Date(lastEntry);
                        const today = new Date();
                        const daysSince = Math.floor((today - lastDate) / (1000 * 60 * 60 * 24));
                        
                        if (daysSince > 3) {
                            const breakPenalty = pointsConfig.deductions.streakBreak;
                            points += breakPenalty;
                            if (deduction === 0) {
                                description += ` (${daysSince} day streak break)`;
                                emoji = '‚ö†Ô∏è';
                            }
                        }
                    }
                }
                
                if (points !== 0) {
                    totalPoints += points;
                    const isNegative = points < 0;
                    pointsBreakdown.push({ 
                        emoji, 
                        description, 
                        points: Math.round(points), 
                        multiplier: multiplier > 1 ? `x${multiplier}` : '',
                        isNegative 
                    });
                }
            });
            
            // Cold shower points
            if (currentData.coldShower) {
                const streak = streaks.coldShower || 0;
                let multiplier = 1;
                for (const [days, mult] of Object.entries(pointsConfig.streakMultipliers).sort((a, b) => b[0] - a[0])) {
                    if (streak >= parseInt(days)) {
                        multiplier = mult;
                        break;
                    }
                }
                const points = pointsConfig.coldShower * multiplier;
                totalPoints += points;
                completedGoals++;
                pointsBreakdown.push({ emoji: 'üöø', description: 'Cold Shower', points: Math.round(points), multiplier: multiplier > 1 ? `x${multiplier}` : '' });
            }
            
            // Bodyweight bonus (for completing both)
            const pushUpsDone = (parseInt(currentData.pushUps) || 0) >= goals.pushUps;
            const pullUpsDone = (parseInt(currentData.pullUps) || 0) >= goals.pullUps;
            if (pushUpsDone && pullUpsDone) {
                const points = pointsConfig.bodyweightBonus;
                totalPoints += points;
                pointsBreakdown.push({ emoji: 'üèÜ', description: 'Bodyweight Combo Bonus', points: points, multiplier: 'BONUS' });
            }
            
            // Lust control points/deductions
            if (!currentData.lust) {
                const streak = streaks.lustControl || 0;
                let multiplier = 1;
                for (const [days, mult] of Object.entries(pointsConfig.streakMultipliers).sort((a, b) => b[0] - a[0])) {
                    if (streak >= parseInt(days)) {
                        multiplier = mult;
                        break;
                    }
                }
                const points = pointsConfig.lustControl * multiplier;
                totalPoints += points;
                completedGoals++;
                pointsBreakdown.push({ emoji: 'üö´', description: 'Lust Control', points: Math.round(points), multiplier: multiplier > 1 ? `x${multiplier}` : '' });
            } else {
                // Deduct points for lust
                const deduction = pointsConfig.deductions.lust;
                totalPoints += deduction;
                pointsBreakdown.push({ emoji: '‚ö†Ô∏è', description: 'Lust (Deduction)', points: deduction, multiplier: '', isNegative: true });
            }
            
            // Daily bonus
            if (completedGoals === totalGoals) {
                totalPoints += pointsConfig.dailyCompletionBonus;
                pointsBreakdown.push({ emoji: 'üèÜ', description: 'All Goals Completed!', points: pointsConfig.dailyCompletionBonus, multiplier: 'BONUS' });
            }
            
            return { total: Math.round(totalPoints), breakdown: pointsBreakdown, completedGoals, totalGoals };
        }
        
        function getEmojiForActivity(activity) {
            const emojis = { stretching: 'üßò', steps: 'üëü', sleep: 'üò¥', water: 'üíß', screenTime: 'üì±', pages: 'üìö', training: 'üí™' };
            return emojis[activity] || '‚≠ê';
        }
        
        // ==================== UPDATED STREAK CALCULATION ====================
        function calculateStreaksWithPause(dates, allData) {
            const streaks = calculateStreaks(dates, allData);
            
            // Apply pause days
            if (pausedStreaks.steps.paused) streaks.steps = Math.max(streaks.steps, pausedStreaks.steps.days + 1);
            if (pausedStreaks.training.paused) streaks.training = Math.max(streaks.training, pausedStreaks.training.days + 1);
            if (pausedStreaks.coldShower.paused) streaks.coldShower = Math.max(streaks.coldShower, pausedStreaks.coldShower.days + 1);
            if (pausedStreaks.pushUps.paused) streaks.pushUps = Math.max(streaks.pushUps, pausedStreaks.pushUps.days + 1);
            if (pausedStreaks.pullUps.paused) streaks.pullUps = Math.max(streaks.pullUps, pausedStreaks.pullUps.days + 1);
            
            return streaks;
        }
        
        // ==================== UPDATED PAUSE SYSTEM ====================
        function togglePause(streakType) {
            const checkbox = document.getElementById(`pause${streakType.charAt(0).toUpperCase() + streakType.slice(1)}`);
            const toggleElement = checkbox.parentElement;
            
            pausedStreaks[streakType].paused = !pausedStreaks[streakType].paused;
            checkbox.checked = pausedStreaks[streakType].paused;
            toggleElement.classList.toggle('active', pausedStreaks[streakType].paused);
            
            if (pausedStreaks[streakType].paused) {
                pausedStreaks[streakType].days++;
                updatePauseDisplay();
            }
            
            localStorage.setItem('pausedStreaks', JSON.stringify(pausedStreaks));
            updateStreakTracker();
            updatePointsDisplay();
        }
        
        function updatePauseDisplay() {
            Object.keys(pausedStreaks).forEach(streakType => {
                const daysElement = document.getElementById(`pause${streakType.charAt(0).toUpperCase() + streakType.slice(1)}Days`);
                if (daysElement) {
                    daysElement.textContent = `${pausedStreaks[streakType].days} day${pausedStreaks[streakType].days !== 1 ? 's' : ''}`;
                }
                
                const checkbox = document.getElementById(`pause${streakType.charAt(0).toUpperCase() + streakType.slice(1)}`);
                if (checkbox) {
                    const toggleElement = checkbox.parentElement;
                    checkbox.checked = pausedStreaks[streakType].paused;
                    if (toggleElement) {
                        toggleElement.classList.toggle('active', pausedStreaks[streakType].paused);
                    }
                }
            });
        }
        
        // ==================== SAVE & LOAD DATA ====================
        function saveData() {
            const today = new Date().toISOString().split('T')[0];
            const data = getCurrentInputs();
            
            let allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
            allData[today] = data;
            localStorage.setItem('lifeTrackerData', JSON.stringify(allData));
            
            // Save points
            const pointsData = calculateTodayPoints();
            let pointsHistory = JSON.parse(localStorage.getItem('lifeTrackerPoints')) || { total: 0, days: {} };
            if (!pointsHistory.days[today]) {
                pointsHistory.total += pointsData.total;
                pointsHistory.days[today] = { points: pointsData.total, breakdown: pointsData.breakdown };
                localStorage.setItem('lifeTrackerPoints', JSON.stringify(pointsHistory));
            }
            
            // Success message
            const btn = document.querySelector('.save-btn');
            btn.textContent = '‚úÖ Saved Successfully!';
            btn.style.background = 'linear-gradient(135deg, #4CAF50, #45a049)';
            setTimeout(() => {
                btn.textContent = 'üíæ Save Today\'s Data';
                btn.style.background = 'linear-gradient(135deg, #4CAF50, #45a049)';
            }, 2000);
            
            updateChart();
            updateStreakTracker();
            updateTotalStats();
            updatePointsDisplay();
            updateOverallConsistency();
        }
        
        // ==================== CHART FUNCTIONS (UPDATED) ====================
        function showChart(type) {
            currentView = type;
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updateChart();
        }
        
        function getChartData(dates, allData) {
            if (currentView === 'consistency') {
                return getConsistencyChartData(dates, allData);
            } else {
                return getSingleMetricChartData(dates, allData, currentView);
            }
        }
        
        function getConsistencyChartData(labels, allData) {
            const consistencyData = labels.map(label => {
                if (currentPeriod === 'daily') {
                    const dayData = allData[label];
                    if (!dayData) return 0;
                    
                    let completedHabits = 0;
                    let totalHabits = Object.keys(goals).length + 2; // +2 for cold shower and lust control
                    
                    Object.keys(goals).forEach(habit => {
                        if (isHabitCompleted(habit, dayData)) {
                            completedHabits++;
                        }
                    });
                    
                    if (dayData.coldShower) completedHabits++;
                    if (!dayData.lust) completedHabits++;
                    
                    return Math.round((completedHabits / totalHabits) * 100);
                }
                return 0;
            });
            
            return {
                labels,
                datasets: [{
                    label: 'Consistency %',
                    data: consistencyData,
                    borderColor: '#764ba2',
                    backgroundColor: '#764ba220',
                    tension: 0.4,
                    fill: true
                }]
            };
        }
        
        // [Keep all other existing functions like updatePointsDisplay, updateSleepAnalysis, 
        // updateConsistencyTracker, updateStreakTracker, etc. They remain mostly the same]
        
        // ==================== RESET FUNCTIONS ====================
        function showResetConfirm() {
            document.getElementById('resetConfirm').style.display = 'block';
        }
        
        function hideResetConfirm() {
            document.getElementById('resetConfirm').style.display = 'none';
        }
        
        function hardReset() {
            localStorage.removeItem('lifeTrackerData');
            localStorage.removeItem('pausedStreaks');
            localStorage.removeItem('lastPauseReset');
            localStorage.removeItem('lifeTrackerPoints');
            localStorage.removeItem('isRestDay');
            localStorage.removeItem('lastRestDay');
            
            // Reset all variables
            pausedStreaks = {
                steps: { paused: false, days: 0 },
                training: { paused: false, days: 0 },
                coldShower: { paused: false, days: 0 },
                pushUps: { paused: false, days: 0 },
                pullUps: { paused: false, days: 0 }
            };
            isRestDay = false;
            
            // Clear all inputs
            document.querySelectorAll('input, select').forEach(el => {
                if (el.type === 'checkbox' || el.type === 'radio') {
                    el.checked = false;
                } else {
                    el.value = '';
                }
            });
            
            // Hide details
            ['gymDetails', 'gymDetails2', 'homeDetails', 'runDetails', 'runDetails2'].forEach(id => {
                document.getElementById(id).style.display = 'none';
            });
            
            hideResetConfirm();
            
            // Update UI
            updateCheckboxStyles();
            updateConsistencyTracker();
            updateSleepAnalysis();
            updateBodyweightGoals();
            updateStreakTracker();
            updateTotalStats();
            updatePauseDisplay();
            updatePointsDisplay();
            updateChart();
            updateOverallConsistency();
            updateRestDayDisplay();
            
            // Success message
            const resetBtn = document.querySelector('.reset-btn');
            resetBtn.textContent = '‚úÖ All Data Cleared!';
            resetBtn.style.background = 'linear-gradient(135deg, #4CAF50, #45a049)';
            setTimeout(() => {
                resetBtn.textContent = 'üóëÔ∏è Hard Reset All Data';
                resetBtn.style.background = 'linear-gradient(135deg, #f44336, #d32f2f)';
            }, 3000);
        }
        
        // [Include all other functions from the original code that weren't modified]
        // They should be copied exactly as they were in the original
        
    </script>
</body>
</html>
