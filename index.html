<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LifeTracker Pro</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .date-display {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
        }
        
        .tracking-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            min-height: calc(100vh - 200px);
        }
        
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .quote-card {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .quote-text {
            font-style: italic;
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: #555;
        }
        
        .quote-author {
            font-weight: bold;
            color: #667eea;
        }
        
        .consistency-card {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .consistency-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #333;
            text-align: center;
        }
        
        .consistency-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .consistency-item:last-child {
            border-bottom: none;
        }
        
        .consistency-status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.8rem;
        }
        
        .status-good {
            background: #4CAF50;
        }
        
        .status-bad {
            background: #f44336;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .input-group {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .input-group:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }
        
        .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .sleep-expanded, .training-expanded {
            grid-column: span 2;
        }
        
        .sleep-details, .training-checkboxes, .run-details {
            margin-top: 15px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
       
        .sleep-card {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .sleep-score {
            text-align: center;
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
            color: #667eea;
        }

         /* Style for hour/minute input pairs */
        .hour-minute-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
        }
        
        .hour-minute-group input {
            text-align: center;
            padding: 8px;
        }
        
        /* Style for sleep time inputs */
        .sleep-time-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .sleep-time-inputs > div {
            display: flex;
            flex-direction: column;
        }
        
        .sleep-time-inputs label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }
        .sleep-breakdown {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .sleep-metric {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }
        
        .sleep-metric-label {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .sleep-metric-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
        }
        
        .sleep-stage-bar {
            height: 8px;
            border-radius: 4px;
            margin-top: 5px;
            overflow: hidden;
            background: #e0e0e0;
        }
        
        .sleep-stage-fill {
            height: 100%;
            border-radius: 4px;
        }
        
        .sleep-detail-item, .run-detail-item {
            display: flex;
            flex-direction: column;
        }
        
        .sleep-detail-item label, .run-detail-item label {
            font-size: 0.9rem;
            margin-bottom: 5px;
            color: #666;
        }
        
        .sleep-detail-item input, .run-detail-item input, .run-detail-item select {
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 0.95rem;
        }
        
        .run-detail-item select {
            cursor: pointer;
            background: white;
        }
        
        .training-checkboxes {
            grid-template-columns: 1fr;
            gap: 10px;
        }
        
        .run-details {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #e0e0e0;
        }
        
        @media (max-width: 768px) {
            .sleep-expanded, .training-expanded {
                grid-column: span 1;
            }
            
            .sleep-details {
                grid-template-columns: 1fr;
            }
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .checkbox-group label {
            margin: 0;
            cursor: pointer;
        }
        
        .cold-shower-checked {
            background: linear-gradient(135deg, #4CAF50, #45a049) !important;
            color: white;
        }
        
        .lust-checked {
            background: linear-gradient(135deg, #f44336, #d32f2f) !important;
            color: white;
        }
        
        .nav-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }
        
        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            background: #667eea;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .nav-btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        
        .nav-btn.active {
            background: #764ba2;
        }
        
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            height: 480px; 
            position: relative;
        }
        
        .chart-title {
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.5rem;
            color: #333;
        }

        .chart-wrapper {
            position: absolute;
            top: 70px; /* Space for title and period selector */
            bottom: 20px;
            left: 20px;
            right: 20px;
        }
        
        .period-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .period-btn {
            padding: 8px 16px;
            border: 2px solid #667eea;
            border-radius: 20px;
            background: white;
            color: #667eea;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .period-btn.active {
            background: #667eea;
            color: white;
        }
        
        .save-btn {
            display: block;
            width: 200px;
            margin: 30px auto;
            padding: 15px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .input-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container">
   <div class="header">
    <h1>üåü LifeTracker Pro</h1>
    <div class="date-display" id="currentDate"></div>
   </div>
   <div class="main-content">
    <div class="tracking-section">
     <div class="input-grid">
      <button class="nav-btn" onclick="showChart('sleepQuality')">‚≠ê Sleep Quality</button>
      <div class="input-group"><label for="stretching">üßò Stretching Sessions</label> <input type="number" id="stretching" placeholder="Enter sessions">
      </div>
      <div class="input-group"><label for="steps">üëü Steps Taken</label> <input type="number" id="steps" placeholder="Enter steps">
      </div>
      <div class="input-group sleep-expanded">
        <label for="sleepHours">üò¥ Sleep Time</label>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
          <div>
            <label for="sleepHours" style="font-size: 0.9rem; color: #666;">Hours</label>
            <input type="number" id="sleepHours" step="0.5" placeholder="Hours" min="0" max="24">
          </div>
          <div>
            <label for="sleepMinutes" style="font-size: 0.9rem; color: #666;">Minutes</label>
            <input type="number" id="sleepMinutes" placeholder="Minutes" min="0" max="59">
          </div>
        </div>
        <div class="sleep-details">
          <div class="sleep-detail-item">
            <label for="sleepQuality">Quality (1-100)</label>
            <input type="number" id="sleepQuality" min="1" max="100" placeholder="Rate 1-100">
          </div>
          
          <div class="sleep-detail-item">
            <label>REM Sleep</label>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
              <input type="number" id="remHours" placeholder="H" min="0" max="24" style="text-align: center;">
              <input type="number" id="remMinutes" placeholder="M" min="0" max="59" style="text-align: center;">
            </div>
          </div>
          
          <div class="sleep-detail-item">
            <label>Deep Sleep</label>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
              <input type="number" id="deepHours" placeholder="H" min="0" max="24" style="text-align: center;">
              <input type="number" id="deepMinutes" placeholder="M" min="0" max="59" style="text-align: center;">
            </div>
          </div>
          
          <div class="sleep-detail-item">
            <label>Light Sleep</label>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
              <input type="number" id="lightHours" placeholder="H" min="0" max="24" style="text-align: center;">
              <input type="number" id="lightMinutes" placeholder="M" min="0" max="59" style="text-align: center;">
            </div>
          </div>
          
          <div class="checkbox-group" style="margin-top: 10px;">
            <input type="checkbox" id="napped">
            <label for="napped">Took a nap today</label>
          </div>
        </div>
      </div>
      <div class="input-group"><label for="water">üíß Water (Liters)</label> <input type="number" id="water" step="0.1" placeholder="Enter liters">
      </div>
      <div class="input-group"><label for="screenTime">üì± Screen Time (Hours)</label> <input type="number" id="screenTime" step="0.5" placeholder="Enter hours">
      </div>
      <div class="input-group"><label for="pages">üìö Pages Read</label> <input type="number" id="pages" placeholder="Enter pages">
      </div>
      <div class="input-group training-expanded"><label>üí™ Training Sessions</label>
       <div class="training-checkboxes">
        <div class="checkbox-group"><input type="checkbox" id="hadGym"> <label for="hadGym">Gym Session</label>
        </div>
        <div class="checkbox-group"><input type="checkbox" id="hadRun"> <label for="hadRun">Running Session</label>
        </div>
       </div>
       <div id="runDetails" class="run-details" style="display: none;">
        <div class="run-detail-item"><label for="runType">Run Type</label> <select id="runType"> <option value="">Select type</option> <option value="interval">Interval Training</option> <option value="free">Free Run</option> <option value="race">Race</option> <option value="tempo">Tempo Run</option> <option value="long">Long Distance</option> <option value="recovery">Recovery Run</option> </select>
        </div>
        <div class="run-detail-item"><label for="runDistance">Distance (km)</label> <input type="number" id="runDistance" step="0.1" placeholder="Enter distance">
        </div>
       </div>
      </div>
      <div class="input-group" id="coldShowerGroup"><label>üöø Cold Shower</label>
       <div class="checkbox-group"><input type="checkbox" id="coldShower"> <label for="coldShower">Took cold shower today</label>
       </div>
      </div>
      <div class="input-group" id="lustGroup"><label>üö´ Lust Control</label>
       <div class="checkbox-group"><input type="checkbox" id="lust"> <label for="lust">Broke lust control (check if failed)</label>
       </div>
      </div>
     </div><button class="save-btn" onclick="saveData()">üíæ Save Today's Data</button>
     <div class="nav-buttons"><button class="nav-btn active" onclick="showChart('stretching')">üßò Stretching</button> <button class="nav-btn" onclick="showChart('steps')">üëü Steps</button> <button class="nav-btn" onclick="showChart('sleep')">üò¥ Sleep</button> <button class="nav-btn" onclick="showChart('water')">üíß Water</button> <button class="nav-btn" onclick="showChart('screenTime')">üì± Screen Time</button> <button class="nav-btn" onclick="showChart('pages')">üìö Reading</button> <button class="nav-btn" onclick="showChart('training')">üí™ Training</button>
     </div>
     <div class="chart-container">
      <div class="period-selector"><button class="period-btn active" onclick="changePeriod('daily')">Daily</button> <button class="period-btn" onclick="changePeriod('weekly')">Weekly</button> <button class="period-btn" onclick="changePeriod('monthly')">Monthly</button>
      </div>
      <div class="chart-title" id="chartTitle">
       Stretching Sessions - Last 7 Days
      </div>
      <div class="chart-wrapper">
       <canvas id="mainChart"></canvas>
      </div>
      <canvas id="mainChart" width="400" height="150"></canvas>
     </div>
    </div>
    <div class="sidebar">
     <div class="quote-card">
      <div class="quote-text" id="dailyQuote"></div>
      <div class="quote-author" id="quoteAuthor"></div>
     </div>
     <div class="sleep-card">
      <div class="consistency-title">
        üò¥ Sleep Analysis
      </div>
      <div id="sleepAnalysis">
        <div style="text-align: center; color: #888; padding: 20px;">
          Enter sleep data to see analysis
        </div>
      </div>
    </div>
     <div class="consistency-card">
      <div class="consistency-title">
       üéØ Today's Goals
      </div>
      <div id="consistencyTracker"></div>
     </div>
     <div class="consistency-card">
      <div class="consistency-title">
       üî• Consistency Streaks
      </div>
      <div id="streakTracker"></div>
     </div>
     <div class="consistency-card">
      <div class="consistency-title">
       üìä Total Statistics
      </div>
      <div id="totalStats"></div>
     </div>
    </div>
   </div>
  </div>
  <script>
        // Motivational quotes
       const quotes = [
           { text: "The only way to do great work is to love what you do.", author: "Steve Jobs" },
           { text: "Success is not final, failure is not fatal: it is the courage to continue that counts.", author: "Winston Churchill" },
           { text: "The future belongs to those who believe in the beauty of their dreams.", author: "Eleanor Roosevelt" },
           { text: "It is during our darkest moments that we must focus to see the light.", author: "Aristotle" },
           { text: "The only impossible journey is the one you never begin.", author: "Tony Robbins" },
           { text: "In the middle of difficulty lies opportunity.", author: "Albert Einstein" },
           { text: "Believe you can and you're halfway there.", author: "Theodore Roosevelt" },
           { text: "The way to get started is to quit talking and begin doing.", author: "Walt Disney" },
           { text: "Don't watch the clock; do what it does. Keep going.", author: "Sam Levenson" },
           { text: "A year from now you may wish you had started today.", author: "Karen Lamb" }
       ];
       
       // Goals for consistency tracking
       const goals = {
           steps: 10000,
           water: 2,
           pages: 20,
           stretching: 2,
           sleep: 8,
           screenTime: 2,
           training: 2
       };
       
       let currentChart = null;
       let currentView = 'stretching';
       let currentPeriod = 'daily';
       
       // Initialize the app
       document.addEventListener('DOMContentLoaded', function() {
           displayCurrentDate();
           displayDailyQuote();
           loadTodaysData();
           updateConsistencyTracker();
           updateStreakTracker();
           updateTotalStats();
           initializeChart();
           
           // Add event listeners for checkboxes
           document.getElementById('coldShower').addEventListener('change', updateCheckboxStyles);
           document.getElementById('lust').addEventListener('change', updateCheckboxStyles);
           
           // Add input event listeners for real-time consistency updates
           const inputs = ['stretching', 'steps', 'sleepHours', 'water', 'screenTime', 'pages'];
           inputs.forEach(input => {
               document.getElementById(input).addEventListener('input', updateConsistencyTracker);
           });
           
           // Add event listener for run checkbox to show/hide run details
           document.getElementById('hadRun').addEventListener('change', function() {
               const runDetails = document.getElementById('runDetails');
               if (this.checked) {
                   runDetails.style.display = 'grid';
               } else {
                   runDetails.style.display = 'none';
                   document.getElementById('runType').value = '';
                   document.getElementById('runDistance').value = '';
               }
               updateConsistencyTracker();
           });
           
           // Add event listeners for gym and run checkboxes
           document.getElementById('hadGym').addEventListener('change', updateConsistencyTracker);
           
           // Sleep input listeners - update to include all new inputs
           ['sleepHours', 'sleepMinutes', 'sleepQuality', 'remHours', 'remMinutes', 
            'deepHours', 'deepMinutes', 'lightHours', 'lightMinutes'].forEach(id => {
               document.getElementById(id).addEventListener('input', function() {
                   updateSleepAnalysis();
                   updateConsistencyTracker();
               });
           });
           
           document.getElementById('napped').addEventListener('change', function() {
               updateSleepAnalysis();
           });
           
           // Initialize sleep analysis
           updateSleepAnalysis();
       });
       
       function displayCurrentDate() {
           const today = new Date();
           const options = { 
               weekday: 'long', 
               year: 'numeric', 
               month: 'long', 
               day: 'numeric' 
           };
           document.getElementById('currentDate').textContent = today.toLocaleDateString('en-US', options);
       }
       
       function displayDailyQuote() {
           const today = new Date();
           const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
           const quoteIndex = dayOfYear % quotes.length;
           const todaysQuote = quotes[quoteIndex];
           
           document.getElementById('dailyQuote').textContent = `"${todaysQuote.text}"`;
           document.getElementById('quoteAuthor').textContent = `‚Äî ${todaysQuote.author}`;
       }
       
       function updateCheckboxStyles() {
           const coldShowerGroup = document.getElementById('coldShowerGroup');
           const lustGroup = document.getElementById('lustGroup');
           const coldShowerChecked = document.getElementById('coldShower').checked;
           const lustChecked = document.getElementById('lust').checked;
           
           if (coldShowerChecked) {
               coldShowerGroup.classList.add('cold-shower-checked');
           } else {
               coldShowerGroup.classList.remove('cold-shower-checked');
           }
           
           if (lustChecked) {
               lustGroup.classList.add('lust-checked');
           } else {
               lustGroup.classList.remove('lust-checked');
           }
           
           updateConsistencyTracker();
       }
       
       function updateStreakTracker() {
           const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
           const dates = Object.keys(allData).sort();
           const streakTracker = document.getElementById('streakTracker');
           
           const streaks = calculateStreaks(dates, allData);
           
           let html = '';
           Object.keys(streaks).forEach(key => {
               const streak = streaks[key];
               let displayName = key.charAt(0).toUpperCase() + key.slice(1);
               if (key === 'screenTime') displayName = 'Screen Time';
               if (key === 'coldShower') displayName = 'Cold Shower';
               if (key === 'lustControl') displayName = 'Lust Control';
               
               // Determine color based on streak length
               let streakColor = '#666';
               let flameIcon = '';
               
               if (streak >= 7) {
                   streakColor = '#4CAF50';
                   flameIcon = 'üî•';
               } else if (streak >= 3) {
                   streakColor = '#FF9800';
                   flameIcon = 'üî•';
               } else if (streak > 0) {
                   streakColor = '#667eea';
                   flameIcon = '‚ú®';
               }
               
               html += `
                   <div class="consistency-item">
                       <span>${displayName}</span>
                       <div style="color: ${streakColor}; font-weight: bold; font-size: 1.1rem;">
                           ${streak} day${streak !== 1 ? 's' : ''} ${flameIcon}
                       </div>
                   </div>
               `;
           });
           
           streakTracker.innerHTML = html;
       }
       
       function calculateStreaks(dates, allData) {
          const streaks = {
              stretching: 0,
              steps: 0,
              sleep: 0,
              water: 0,
              screenTime: 0,
              pages: 0,
              training: 0,
              coldShower: 0,
              lustControl: 0
          };
          
          if (dates.length === 0) return streaks;
          
          // Sort dates in descending order (most recent first)
          const sortedDates = [...dates].sort((a, b) => new Date(b) - new Date(a));
          
          // Helper function to check if a goal was met on a specific day
          function goalMet(date, goalKey) {
              const dayData = allData[date];
              if (!dayData) return false;
              
              if (goalKey === 'coldShower') {
                  return dayData.coldShower === true;
              }
              
              if (goalKey === 'lustControl') {
                  return dayData.lust !== true; // Note: lust control means NOT checking the box
              }
              
              if (goalKey === 'training') {
                  const hadGym = dayData.hadGym === true ? 1 : 0;
                  const hadRun = dayData.hadRun === true ? 1 : 0;
                  return (hadGym + hadRun) >= goals.training;
              }
              
              const value = parseFloat(dayData[goalKey]) || 0;
              const goal = goals[goalKey];
              
              if (goalKey === 'screenTime') {
                  return value <= goal; // For screen time, lower is better
              }
              
              return value >= goal; // For others, higher is better
          }
          
          // Calculate current streak for each goal
          Object.keys(streaks).forEach(goalKey => {
              let currentStreak = 0;
              let streakBroken = false;
              
              // Get today's date
              const today = new Date();
              const todayStr = today.toISOString().split('T')[0];
              
              // Check if today's goal is met (if data exists for today)
              if (allData[todayStr]) {
                  if (goalMet(todayStr, goalKey)) {
                      currentStreak = 1;
                  }
              }
              
              // Now check previous days
              for (let i = 0; i < sortedDates.length; i++) {
                  const currentDate = sortedDates[i];
                  const currentDateObj = new Date(currentDate);
                  const prevDate = new Date(currentDateObj);
                  prevDate.setDate(prevDate.getDate() - 1);
                  const prevDateStr = prevDate.toISOString().split('T')[0];
                  
                  // Skip if we're checking today (already handled above)
                  if (currentDate === todayStr) continue;
                  
                  // Check if current day's goal was met
                  if (goalMet(currentDate, goalKey)) {
                      // If this is the first day we're checking, start the streak
                      if (currentStreak === 0) {
                          currentStreak = 1;
                      }
                      
                      // Check if there's consecutive data for the previous day
                      if (allData[prevDateStr] && goalMet(prevDateStr, goalKey)) {
                          currentStreak++;
                      } else {
                          // If previous day doesn't exist or goal wasn't met, stop counting
                          // but keep the streak for this isolated day
                          streakBroken = true;
                          break;
                      }
                  } else {
                      // Goal wasn't met on this day, streak is broken
                      streakBroken = true;
                      break;
                  }
                  
                  // Safety break to prevent infinite loops
                  if (i > 100) break;
              }
              
              streaks[goalKey] = currentStreak;
          });
          
          return streaks;
      }
       
       function updateTotalStats() {
           const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
           const totalStatsElement = document.getElementById('totalStats');
           
           // Calculate totals
           const totals = {
               stretching: 0,
               steps: 0,
               sleep: 0,
               water: 0,
               screenTime: 0,
               pages: 0,
               gymSessions: 0,
               runs: 0,
               totalRunDistance: 0,
               coldShowers: 0,
               naps: 0
           };
           
           let totalDays = 0;
           
           Object.keys(allData).forEach(date => {
               const dayData = allData[date];
               totalDays++;
               
               totals.stretching += parseFloat(dayData.stretching) || 0;
               totals.steps += parseFloat(dayData.steps) || 0;
               totals.sleep += parseFloat(dayData.sleep) || 0;
               totals.water += parseFloat(dayData.water) || 0;
               totals.screenTime += parseFloat(dayData.screenTime) || 0;
               totals.pages += parseFloat(dayData.pages) || 0;
               
               if (dayData.hadGym === true) totals.gymSessions++;
               if (dayData.hadRun === true) {
                   totals.runs++;
                   totals.totalRunDistance += parseFloat(dayData.runDistance) || 0;
               }
               
               if (dayData.coldShower === true) totals.coldShowers++;
               if (dayData.napped === true) totals.naps++;
           });
           
           let html = '';
           
           // Format numbers nicely
           const formatNumber = (num) => {
               if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
               if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
               return Math.round(num * 10) / 10;
           };
           
           html += `
               <div class="consistency-item">
                   <span>üßò Total Stretching</span>
                   <div style="font-weight: bold; color: #667eea;">${formatNumber(totals.stretching)}</div>
               </div>
               <div class="consistency-item">
                   <span>üëü Total Steps</span>
                   <div style="font-weight: bold; color: #667eea;">${formatNumber(totals.steps)}</div>
               </div>
               <div class="consistency-item">
                   <span>üò¥ Total Sleep</span>
                   <div style="font-weight: bold; color: #667eea;">${formatNumber(totals.sleep)}h</div>
               </div>
               <div class="consistency-item">
                   <span>üíß Total Water</span>
                   <div style="font-weight: bold; color: #667eea;">${formatNumber(totals.water)}L</div>
               </div>
               <div class="consistency-item">
                   <span>üì± Total Screen Time</span>
                   <div style="font-weight: bold; color: #667eea;">${formatNumber(totals.screenTime)}h</div>
               </div>
               <div class="consistency-item">
                   <span>üìö Total Pages</span>
                   <div style="font-weight: bold; color: #667eea;">${formatNumber(totals.pages)}</div>
               </div>
               <div class="consistency-item">
                   <span>üèãÔ∏è Gym Sessions</span>
                   <div style="font-weight: bold; color: #667eea;">${totals.gymSessions}</div>
               </div>
               <div class="consistency-item">
                   <span>üèÉ Total Runs</span>
                   <div style="font-weight: bold; color: #667eea;">${totals.runs}</div>
               </div>
               <div class="consistency-item">
                   <span>üìè Total Distance</span>
                   <div style="font-weight: bold; color: #667eea;">${formatNumber(totals.totalRunDistance)}km</div>
               </div>
               <div class="consistency-item">
                   <span>üöø Cold Showers</span>
                   <div style="font-weight: bold; color: #4CAF50;">${totals.coldShowers}</div>
               </div>
               <div class="consistency-item">
                   <span>üò¥ Naps Taken</span>
                   <div style="font-weight: bold; color: #667eea;">${totals.naps}</div>
               </div>
               <div class="consistency-item">
                   <span>üìÖ Days Tracked</span>
                   <div style="font-weight: bold; color: #764ba2;">${totalDays}</div>
               </div>
           `;
           
           totalStatsElement.innerHTML = html;
       }
       
       function updateConsistencyTracker() {
           const tracker = document.getElementById('consistencyTracker');
           const currentData = getCurrentInputs();
           
           let html = '';
           
           // Regular metrics
           Object.keys(goals).forEach(key => {
               if (key === 'training') {
                   // Special handling for training
                   const hadGym = currentData.hadGym;
                   const hadRun = currentData.hadRun;
                   const trainingSessions = (hadGym ? 1 : 0) + (hadRun ? 1 : 0);
                   const isGood = trainingSessions >= goals.training;
                   const status = isGood ? 'good' : 'bad';
                   const icon = isGood ? '‚úì' : '‚úó';
                   
                   html += `
                       <div class="consistency-item">
                           <span>Training</span>
                           <div class="consistency-status status-${status}">${icon}</div>
                       </div>
                   `;
               } else {
                   const current = parseFloat(currentData[key]) || 0;
                   const goal = goals[key];
                   const isGood = key === 'screenTime' ? current <= goal : current >= goal;
                   const status = isGood ? 'good' : 'bad';
                   const icon = isGood ? '‚úì' : '‚úó';
                   
                   let displayName = key.charAt(0).toUpperCase() + key.slice(1);
                   if (key === 'screenTime') displayName = 'Screen Time';
                   
                   html += `
                       <div class="consistency-item">
                           <span>${displayName}</span>
                           <div class="consistency-status status-${status}">${icon}</div>
                       </div>
                   `;
               }
           });
           
           // Cold shower
           const coldShower = document.getElementById('coldShower').checked;
           html += `
               <div class="consistency-item">
                   <span>Cold Shower</span>
                   <div class="consistency-status status-${coldShower ? 'good' : 'bad'}">${coldShower ? '‚úì' : '‚úó'}</div>
               </div>
           `;
           
           // Lust control (inverted - checked is bad)
           const lust = document.getElementById('lust').checked;
           html += `
               <div class="consistency-item">
                   <span>Lust Control</span>
                   <div class="consistency-status status-${lust ? 'bad' : 'good'}">${lust ? '‚úó' : '‚úì'}</div>
               </div>
           `;
           
           tracker.innerHTML = html;
       }
       
       function getCurrentInputs() {
           // Calculate total sleep in hours (including decimals)
           const sleepHours = parseFloat(document.getElementById('sleepHours').value) || 0;
           const sleepMinutes = parseFloat(document.getElementById('sleepMinutes').value) || 0;
           const totalSleepHours = sleepHours + (sleepMinutes / 60);
           
           // Calculate REM sleep in minutes
           const remHours = parseFloat(document.getElementById('remHours').value) || 0;
           const remMinutes = parseFloat(document.getElementById('remMinutes').value) || 0;
           const totalRemMinutes = (remHours * 60) + remMinutes;
           
           // Calculate Deep sleep in minutes
           const deepHours = parseFloat(document.getElementById('deepHours').value) || 0;
           const deepMinutes = parseFloat(document.getElementById('deepMinutes').value) || 0;
           const totalDeepMinutes = (deepHours * 60) + deepMinutes;
           
           // Calculate Light sleep in minutes
           const lightHours = parseFloat(document.getElementById('lightHours').value) || 0;
           const lightMinutes = parseFloat(document.getElementById('lightMinutes').value) || 0;
           const totalLightMinutes = (lightHours * 60) + lightMinutes;
           
           return {
               stretching: document.getElementById('stretching').value,
               steps: document.getElementById('steps').value,
               sleep: totalSleepHours.toFixed(2), // Keep as decimal hours for chart
               sleepHours: sleepHours,
               sleepMinutes: sleepMinutes,
               sleepQuality: document.getElementById('sleepQuality').value,
               remSleep: totalRemMinutes, // Store as total minutes
               remHours: remHours,
               remMinutes: remMinutes,
               deepSleep: totalDeepMinutes, // Store as total minutes
               deepHours: deepHours,
               deepMinutes: deepMinutes,
               lightSleep: totalLightMinutes, // Store as total minutes
               lightHours: lightHours,
               lightMinutes: lightMinutes,
               napped: document.getElementById('napped').checked,
               water: document.getElementById('water').value,
               screenTime: document.getElementById('screenTime').value,
               pages: document.getElementById('pages').value,
               hadGym: document.getElementById('hadGym').checked,
               hadRun: document.getElementById('hadRun').checked,
               runType: document.getElementById('runType').value,
               runDistance: document.getElementById('runDistance').value,
               coldShower: document.getElementById('coldShower').checked,
               lust: document.getElementById('lust').checked
           };
       }
       
       function updateSleepAnalysis() {
           const sleepQuality = parseInt(document.getElementById('sleepQuality').value) || 0;
           const sleepHours = parseFloat(document.getElementById('sleepHours').value) || 0;
           const sleepMinutes = parseFloat(document.getElementById('sleepMinutes').value) || 0;
           const totalSleepHours = sleepHours + (sleepMinutes / 60);
           
           // Calculate REM sleep in minutes
           const remHours = parseFloat(document.getElementById('remHours').value) || 0;
           const remMinutes = parseFloat(document.getElementById('remMinutes').value) || 0;
           const totalRemMinutes = (remHours * 60) + remMinutes;
           
           // Calculate Deep sleep in minutes
           const deepHours = parseFloat(document.getElementById('deepHours').value) || 0;
           const deepMinutes = parseFloat(document.getElementById('deepMinutes').value) || 0;
           const totalDeepMinutes = (deepHours * 60) + deepMinutes;
           
           // Calculate Light sleep in minutes
           const lightHours = parseFloat(document.getElementById('lightHours').value) || 0;
           const lightMinutes = parseFloat(document.getElementById('lightMinutes').value) || 0;
           const totalLightMinutes = (lightHours * 60) + lightMinutes;
           
           const napped = document.getElementById('napped').checked;
           
           const sleepAnalysis = document.getElementById('sleepAnalysis');
           
           let html = '';
           
           // Sleep Score with emoji based on quality
           let sleepEmoji = 'üò¥';
           let sleepColor = '#667eea';
           if (sleepQuality >= 80) {
               sleepEmoji = 'üòä';
               sleepColor = '#4CAF50';
           } else if (sleepQuality >= 60) {
               sleepEmoji = 'üòê';
               sleepColor = '#FF9800';
           } else if (sleepQuality > 0) {
               sleepEmoji = 'üòü';
               sleepColor = '#f44336';
           }
           
           // Format sleep time display
           let sleepTimeDisplay = '';
           if (sleepHours > 0 || sleepMinutes > 0) {
               if (sleepHours > 0 && sleepMinutes > 0) {
                   sleepTimeDisplay = `${sleepHours}h ${sleepMinutes}m`;
               } else if (sleepHours > 0) {
                   sleepTimeDisplay = `${sleepHours}h`;
               } else {
                   sleepTimeDisplay = `${sleepMinutes}m`;
               }
           }
           
           html += `
               <div class="sleep-score" style="color: ${sleepColor}">
                   ${sleepQuality > 0 ? sleepQuality : '--'}/100 ${sleepEmoji}
               </div>
               <div style="text-align: center; color: #666; margin-bottom: 15px;">
                   ${sleepTimeDisplay || 'No sleep data'}
                   ${napped ? ' + Nap üí§' : ''}
               </div>
           `;
           
           // Sleep stage breakdown (only show if we have data)
           const totalMinutes = totalRemMinutes + totalDeepMinutes + totalLightMinutes;
           if (totalMinutes > 0) {
               const remPercent = Math.round((totalRemMinutes/totalMinutes)*100);
               const deepPercent = Math.round((totalDeepMinutes/totalMinutes)*100);
               const lightPercent = Math.round((totalLightMinutes/totalMinutes)*100);
               
               // Format function for display
               const formatTime = (totalMinutes) => {
                   const hours = Math.floor(totalMinutes / 60);
                   const minutes = totalMinutes % 60;
                   if (hours > 0 && minutes > 0) {
                       return `${hours}h ${minutes}m`;
                   } else if (hours > 0) {
                       return `${hours}h`;
                   } else {
                       return `${minutes}m`;
                   }
               };
               
               html += `
                   <div class="sleep-breakdown">
                       <div class="sleep-metric" style="border-left: 4px solid #667eea;">
                           <div class="sleep-metric-label">REM Sleep</div>
                           <div class="sleep-metric-value">${formatTime(totalRemMinutes)}</div>
                           <div style="font-size: 0.7rem; color: #888;">
                               ${remPercent}%
                           </div>
                           <div class="sleep-stage-bar">
                               <div class="sleep-stage-fill" style="width: ${remPercent}%; background: #667eea;"></div>
                           </div>
                       </div>
                       <div class="sleep-metric" style="border-left: 4px solid #4CAF50;">
                           <div class="sleep-metric-label">Deep Sleep</div>
                           <div class="sleep-metric-value">${formatTime(totalDeepMinutes)}</div>
                           <div style="font-size: 0.7rem; color: #888;">
                               ${deepPercent}%
                           </div>
                           <div class="sleep-stage-bar">
                               <div class="sleep-stage-fill" style="width: ${deepPercent}%; background: #4CAF50;"></div>
                           </div>
                       </div>
                       <div class="sleep-metric" style="border-left: 4px solid #FF9800;">
                           <div class="sleep-metric-label">Light Sleep</div>
                           <div class="sleep-metric-value">${formatTime(totalLightMinutes)}</div>
                           <div style="font-size: 0.7rem; color: #888;">
                               ${lightPercent}%
                           </div>
                           <div class="sleep-stage-bar">
                               <div class="sleep-stage-fill" style="width: ${lightPercent}%; background: #FF9800;"></div>
                           </div>
                       </div>
                       <div class="sleep-metric" style="border-left: 4px solid #9C27B0;">
                           <div class="sleep-metric-label">Total Stages</div>
                           <div class="sleep-metric-value">${formatTime(totalMinutes)}</div>
                           <div style="font-size: 0.7rem; color: #888;">
                               ${Math.floor(totalMinutes/60)}h ${totalMinutes%60}m
                           </div>
                           <div class="sleep-stage-bar">
                               <div class="sleep-stage-fill" style="width: 100%; background: #9C27B0;"></div>
                           </div>
                       </div>
                   </div>
                   
                   <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; text-align: center; font-size: 0.9rem; color: #666;">
                       <div>üí° Ideal: 1.5-2h REM, 1-1.5h Deep sleep</div>
                       <div style="font-size: 0.8rem; color: #888; margin-top: 3px;">(20-25% each of total sleep)</div>
                   </div>
               `;
           } else if (totalSleepHours > 0) {
               html += `
                   <div style="text-align: center; color: #888; padding: 20px;">
                       Enter sleep stage details for breakdown
                   </div>
               `;
           } else {
               html += `
                   <div style="text-align: center; color: #888; padding: 20px;">
                       Enter sleep data to see analysis
                   </div>
               `;
           }
           
           sleepAnalysis.innerHTML = html;
       }
       
       function saveData() {
           const today = new Date().toISOString().split('T')[0];
           const data = getCurrentInputs();
           
           // Get existing data
           let allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
           allData[today] = data;
           
           // Save to localStorage
           localStorage.setItem('lifeTrackerData', JSON.stringify(allData));
           
           // Show success message
           const btn = document.querySelector('.save-btn');
           const originalText = btn.textContent;
           btn.textContent = '‚úÖ Saved Successfully!';
           btn.style.background = 'linear-gradient(135deg, #4CAF50, #45a049)';
           
           setTimeout(() => {
               btn.textContent = originalText;
               btn.style.background = 'linear-gradient(135deg, #4CAF50, #45a049)';
           }, 2000);
           
           // Update chart and streaks
           updateChart();
           updateStreakTracker();
           updateTotalStats();
       }
       
       function loadTodaysData() {
           const today = new Date().toISOString().split('T')[0];
           const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
           const todaysData = allData[today];
           
           if (todaysData) {
               // List of all possible fields
               const fields = [
                   'stretching', 'steps', 'sleep', 'sleepHours', 'sleepMinutes',
                   'sleepQuality', 'remSleep', 'remHours', 'remMinutes',
                   'deepSleep', 'deepHours', 'deepMinutes', 'lightSleep', 
                   'lightHours', 'lightMinutes', 'water', 'screenTime', 'pages',
                   'runType', 'runDistance'
               ];
               
               const checkboxes = ['napped', 'hadGym', 'hadRun', 'coldShower', 'lust'];
               
               // Set values for regular fields
               fields.forEach(key => {
                   const element = document.getElementById(key);
                   if (element && todaysData[key] !== undefined) {
                       element.value = todaysData[key];
                   }
               });
               
               // Set values for checkboxes
               checkboxes.forEach(key => {
                   const element = document.getElementById(key);
                   if (element && todaysData[key] !== undefined) {
                       element.checked = todaysData[key];
                   }
               });
               
               // Show run details if hadRun is checked
               if (todaysData.hadRun) {
                   document.getElementById('runDetails').style.display = 'grid';
               }
               
               updateCheckboxStyles();
               updateConsistencyTracker();
               updateSleepAnalysis();
           }
       }
       
       function showChart(type) {
           currentView = type;
           
           // Update active button
           document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
           event.target.classList.add('active');
           
           updateChart();
       }
       
       function changePeriod(period) {
           currentPeriod = period;
           
           // Update active button
           document.querySelectorAll('.period-btn').forEach(btn => btn.classList.remove('active'));
           event.target.classList.add('active');
           
           updateChart();
       }
       
       function initializeChart() {
           const ctx = document.getElementById('mainChart').getContext('2d');
           currentChart = new Chart(ctx, {
               type: 'line',
               data: {
                   labels: [],
                   datasets: []
               },
               options: {
                   responsive: true,
                   maintainAspectRatio: false,
                   scales: {
                       y: {
                           beginAtZero: true
                       }
                   },
                   plugins: {
                       legend: {
                           display: true,
                           position: 'top'
                       }
                   }
               }
           });
           
           updateChart();
       }
       
       function updateChart() {
           const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
           const dates = Object.keys(allData).sort();
           
           let chartData = getChartData(dates, allData);
           
           if (currentChart) {
               currentChart.data = chartData;
               currentChart.update();
           }
           
           // Update chart title
           const titles = {
               stretching: 'Stretching Sessions',
               steps: 'Steps Taken',
               sleep: 'Sleep Hours',
               sleepQuality: 'Sleep Quality & Hours',
               water: 'Water Intake (Liters)',
               screenTime: 'Screen Time (Hours)',
               pages: 'Pages Read',
               training: 'Training Sessions'
           };
           
           const periodText = currentPeriod === 'daily' ? 'Last 7 Days' : 
                             currentPeriod === 'weekly' ? 'Last 4 Weeks' : 'Last 6 Months';
           
           document.getElementById('chartTitle').textContent = `${titles[currentView] || currentView} - ${periodText}`;
       }
       
       function getChartData(dates, allData) {
           const now = new Date();
           let filteredDates = [];
           
           if (currentPeriod === 'daily') {
               // Last 7 days
               for (let i = 6; i >= 0; i--) {
                   const date = new Date(now);
                   date.setDate(date.getDate() - i);
                   filteredDates.push(date.toISOString().split('T')[0]);
               }
           } else if (currentPeriod === 'weekly') {
               // Last 4 weeks (weekly averages)
               for (let i = 3; i >= 0; i--) {
                   const date = new Date(now);
                   date.setDate(date.getDate() - (i * 7));
                   filteredDates.push(`Week of ${date.toLocaleDateString()}`);
               }
           } else {
               // Last 6 months (monthly averages)
               for (let i = 5; i >= 0; i--) {
                   const date = new Date(now);
                   date.setMonth(date.getMonth() - i);
                   filteredDates.push(date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' }));
               }
           }
           
           return getSingleMetricChartData(filteredDates, allData, currentView);
       }
       
       function getSingleMetricChartData(labels, allData, metric) {
           if (metric === 'sleepQuality') {
               // For sleep quality, show quality score and hours
               const qualityData = labels.map(label => {
                   if (currentPeriod === 'daily') {
                       const dayData = allData[label];
                       return dayData ? (parseFloat(dayData.sleepQuality) || 0) : 0;
                   }
                   return 0;
               });
               
               const sleepHoursData = labels.map(label => {
                   if (currentPeriod === 'daily') {
                       const dayData = allData[label];
                       return dayData ? (parseFloat(dayData.sleep) || 0) : 0;
                   }
                   return 0;
               });
               
               return {
                   labels,
                   datasets: [
                       {
                           label: 'Sleep Quality (1-100)',
                           data: qualityData,
                           borderColor: '#667eea',
                           backgroundColor: '#667eea20',
                           tension: 0.4,
                           fill: true,
                           yAxisID: 'y'
                       },
                       {
                           label: 'Sleep Hours',
                           data: sleepHoursData,
                           borderColor: '#4CAF50',
                           backgroundColor: '#4CAF5020',
                           tension: 0.4,
                           fill: false,
                           yAxisID: 'y1'
                       }
                   ]
               };
           }
           
           const data = labels.map(label => {
               if (currentPeriod === 'daily') {
                   const dayData = allData[label];
                   if (metric === 'training') {
                       // Special handling for training
                       if (dayData) {
                           const hadGym = dayData.hadGym === true ? 1 : 0;
                           const hadRun = dayData.hadRun === true ? 1 : 0;
                           return hadGym + hadRun;
                       }
                       return 0;
                   }
                   return dayData ? (parseFloat(dayData[metric]) || 0) : 0;
               }
               return 0; // Simplified for demo
           });
           
           // Chart colors based on metric
           const colors = {
               stretching: '#667eea',
               steps: '#4CAF50',
               sleep: '#2196F3',
               water: '#00BCD4',
               screenTime: '#FF9800',
               pages: '#9C27B0',
               training: '#f44336'
           };
           
           return {
               labels,
               datasets: [{
                   label: metric.charAt(0).toUpperCase() + metric.slice(1),
                   data,
                   borderColor: colors[metric] || '#667eea',
                   backgroundColor: (colors[metric] || '#667eea') + '20',
                   tension: 0.4,
                   fill: true
               }]
           };
       }
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9af8e80117f65a7e',t:'MTc2NjAwMDU3My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>

</html>












