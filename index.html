<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LifeTracker Pro</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .date-display {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
        }
        
        .tracking-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .quote-card {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .quote-text {
            font-style: italic;
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: #555;
        }
        
        .quote-author {
            font-weight: bold;
            color: #667eea;
        }
        
        .consistency-card {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .consistency-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #333;
            text-align: center;
        }
        
        .consistency-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .consistency-item:last-child {
            border-bottom: none;
        }
        
        .consistency-status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.8rem;
        }
        
        .status-good {
            background: #4CAF50;
        }
        
        .status-bad {
            background: #f44336;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .input-group {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .input-group:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }
        
        .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .sleep-expanded, .training-expanded {
            grid-column: span 2;
        }
        
        .sleep-details, .training-checkboxes, .run-details {
            margin-top: 15px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .sleep-detail-item, .run-detail-item {
            display: flex;
            flex-direction: column;
        }
        
        .sleep-detail-item label, .run-detail-item label {
            font-size: 0.9rem;
            margin-bottom: 5px;
            color: #666;
        }
        
        .sleep-detail-item input, .run-detail-item input, .run-detail-item select {
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 0.95rem;
        }
        
        .run-detail-item select {
            cursor: pointer;
            background: white;
        }
        
        .training-checkboxes {
            grid-template-columns: 1fr;
            gap: 10px;
        }
        
        .run-details {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #e0e0e0;
        }
        
        @media (max-width: 768px) {
            .sleep-expanded, .training-expanded {
                grid-column: span 1;
            }
            
            .sleep-details {
                grid-template-columns: 1fr;
            }
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .checkbox-group label {
            margin: 0;
            cursor: pointer;
        }
        
        .cold-shower-checked {
            background: linear-gradient(135deg, #4CAF50, #45a049) !important;
            color: white;
        }
        
        .lust-checked {
            background: linear-gradient(135deg, #f44336, #d32f2f) !important;
            color: white;
        }
        
        .nav-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }
        
        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            background: #667eea;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .nav-btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        
        .nav-btn.active {
            background: #764ba2;
        }
        
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            height: 480px;
        }
        
        .chart-title {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.5rem;
            color: #333;
        }
        
        .period-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .period-btn {
            padding: 8px 16px;
            border: 2px solid #667eea;
            border-radius: 20px;
            background: white;
            color: #667eea;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .period-btn.active {
            background: #667eea;
            color: white;
        }
        
        .save-btn {
            display: block;
            width: 200px;
            margin: 30px auto;
            padding: 15px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .input-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container">
   <div class="header">
    <h1>üåü LifeTracker Pro</h1>
    <div class="date-display" id="currentDate"></div>
   </div>
   <div class="main-content">
    <div class="tracking-section">
     <div class="input-grid">
      <div class="input-group"><label for="stretching">üßò Stretching Sessions</label> <input type="number" id="stretching" placeholder="Enter sessions">
      </div>
      <div class="input-group"><label for="steps">üëü Steps Taken</label> <input type="number" id="steps" placeholder="Enter steps">
      </div>
      <div class="input-group sleep-expanded"><label for="sleep">üò¥ Sleep Hours</label> <input type="number" id="sleep" step="0.5" placeholder="Enter hours">
       <div class="sleep-details">
        <div class="sleep-detail-item"><label for="sleepQuality">Quality (1-100)</label> <input type="number" id="sleepQuality" min="1" max="100" placeholder="Rate 1-100">
        </div>
        <div class="sleep-detail-item"><label for="remSleep">REM Sleep (min)</label> <input type="number" id="remSleep" placeholder="Minutes">
        </div>
        <div class="sleep-detail-item"><label for="deepSleep">Deep Sleep (min)</label> <input type="number" id="deepSleep" placeholder="Minutes">
        </div>
        <div class="sleep-detail-item"><label for="lightSleep">Light Sleep (min)</label> <input type="number" id="lightSleep" placeholder="Minutes">
        </div>
        <div class="checkbox-group" style="margin-top: 10px;"><input type="checkbox" id="napped"> <label for="napped">Took a nap today</label>
        </div>
       </div>
      </div>
      <div class="input-group"><label for="water">üíß Water (Liters)</label> <input type="number" id="water" step="0.1" placeholder="Enter liters">
      </div>
      <div class="input-group"><label for="screenTime">üì± Screen Time (Hours)</label> <input type="number" id="screenTime" step="0.5" placeholder="Enter hours">
      </div>
      <div class="input-group"><label for="pages">üìö Pages Read</label> <input type="number" id="pages" placeholder="Enter pages">
      </div>
      <div class="input-group training-expanded"><label>üí™ Training Sessions</label>
       <div class="training-checkboxes">
        <div class="checkbox-group"><input type="checkbox" id="hadGym"> <label for="hadGym">Gym Session</label>
        </div>
        <div class="checkbox-group"><input type="checkbox" id="hadRun"> <label for="hadRun">Running Session</label>
        </div>
       </div>
       <div id="runDetails" class="run-details" style="display: none;">
        <div class="run-detail-item"><label for="runType">Run Type</label> <select id="runType"> <option value="">Select type</option> <option value="interval">Interval Training</option> <option value="free">Free Run</option> <option value="race">Race</option> <option value="tempo">Tempo Run</option> <option value="long">Long Distance</option> <option value="recovery">Recovery Run</option> </select>
        </div>
        <div class="run-detail-item"><label for="runDistance">Distance (km)</label> <input type="number" id="runDistance" step="0.1" placeholder="Enter distance">
        </div>
       </div>
      </div>
      <div class="input-group" id="coldShowerGroup"><label>üöø Cold Shower</label>
       <div class="checkbox-group"><input type="checkbox" id="coldShower"> <label for="coldShower">Took cold shower today</label>
       </div>
      </div>
      <div class="input-group" id="lustGroup"><label>üö´ Lust Control</label>
       <div class="checkbox-group"><input type="checkbox" id="lust"> <label for="lust">Broke lust control (check if failed)</label>
       </div>
      </div>
     </div><button class="save-btn" onclick="saveData()">üíæ Save Today's Data</button>
     <div class="nav-buttons"><button class="nav-btn active" onclick="showChart('stretching')">üßò Stretching</button> <button class="nav-btn" onclick="showChart('steps')">üëü Steps</button> <button class="nav-btn" onclick="showChart('sleep')">üò¥ Sleep</button> <button class="nav-btn" onclick="showChart('water')">üíß Water</button> <button class="nav-btn" onclick="showChart('screenTime')">üì± Screen Time</button> <button class="nav-btn" onclick="showChart('pages')">üìö Reading</button> <button class="nav-btn" onclick="showChart('training')">üí™ Training</button>
     </div>
     <div class="chart-container">
      <div class="period-selector"><button class="period-btn active" onclick="changePeriod('daily')">Daily</button> <button class="period-btn" onclick="changePeriod('weekly')">Weekly</button> <button class="period-btn" onclick="changePeriod('monthly')">Monthly</button>
      </div>
      <div class="chart-title" id="chartTitle">
       Stretching Sessions - Last 7 Days
      </div>
      <canvas id="mainChart" width="400" height="150"></canvas>
     </div>
    </div>
    <div class="sidebar">
     <div class="quote-card">
      <div class="quote-text" id="dailyQuote"></div>
      <div class="quote-author" id="quoteAuthor"></div>
     </div>
     <div class="consistency-card">
      <div class="consistency-title">
       üéØ Today's Goals
      </div>
      <div id="consistencyTracker"></div>
     </div>
     <div class="consistency-card">
      <div class="consistency-title">
       üî• Consistency Streaks
      </div>
      <div id="streakTracker"></div>
     </div>
     <div class="consistency-card">
      <div class="consistency-title">
       üìä Total Statistics
      </div>
      <div id="totalStats"></div>
     </div>
    </div>
   </div>
  </div>
  <script>
        // Motivational quotes
        const quotes = [
            { text: "The only way to do great work is to love what you do.", author: "Steve Jobs" },
            { text: "Success is not final, failure is not fatal: it is the courage to continue that counts.", author: "Winston Churchill" },
            { text: "The future belongs to those who believe in the beauty of their dreams.", author: "Eleanor Roosevelt" },
            { text: "It is during our darkest moments that we must focus to see the light.", author: "Aristotle" },
            { text: "The only impossible journey is the one you never begin.", author: "Tony Robbins" },
            { text: "In the middle of difficulty lies opportunity.", author: "Albert Einstein" },
            { text: "Believe you can and you're halfway there.", author: "Theodore Roosevelt" },
            { text: "The way to get started is to quit talking and begin doing.", author: "Walt Disney" },
            { text: "Don't watch the clock; do what it does. Keep going.", author: "Sam Levenson" },
            { text: "A year from now you may wish you had started today.", author: "Karen Lamb" }
        ];

        // Goals for consistency tracking
        const goals = {
            steps: 10000,
            water: 2,
            pages: 20,
            stretching: 2,
            sleep: 8,
            screenTime: 2,
            training: 2
        };

        let currentChart = null;
        let currentView = 'stretching';
        let currentPeriod = 'daily';

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            displayCurrentDate();
            displayDailyQuote();
            loadTodaysData();
            updateConsistencyTracker();
            updateStreakTracker();
            updateTotalStats();
            initializeChart();
            
            // Add event listeners for checkboxes
            document.getElementById('coldShower').addEventListener('change', updateCheckboxStyles);
            document.getElementById('lust').addEventListener('change', updateCheckboxStyles);
            
            // Add input event listeners for real-time consistency updates
            const inputs = ['stretching', 'steps', 'sleep', 'water', 'screenTime', 'pages'];
            inputs.forEach(input => {
                document.getElementById(input).addEventListener('input', updateConsistencyTracker);
            });
            
            // Add event listener for run checkbox to show/hide run details
            document.getElementById('hadRun').addEventListener('change', function() {
                const runDetails = document.getElementById('runDetails');
                if (this.checked) {
                    runDetails.style.display = 'grid';
                } else {
                    runDetails.style.display = 'none';
                    document.getElementById('runType').value = '';
                    document.getElementById('runDistance').value = '';
                }
                updateConsistencyTracker();
            });
            
            // Add event listeners for gym and run checkboxes
            document.getElementById('hadGym').addEventListener('change', updateConsistencyTracker);
        });

        function displayCurrentDate() {
            const today = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            document.getElementById('currentDate').textContent = today.toLocaleDateString('en-US', options);
        }

        function displayDailyQuote() {
            const today = new Date();
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
            const quoteIndex = dayOfYear % quotes.length;
            const todaysQuote = quotes[quoteIndex];
            
            document.getElementById('dailyQuote').textContent = `"${todaysQuote.text}"`;
            document.getElementById('quoteAuthor').textContent = `‚Äî ${todaysQuote.author}`;
        }

        function updateCheckboxStyles() {
            const coldShowerGroup = document.getElementById('coldShowerGroup');
            const lustGroup = document.getElementById('lustGroup');
            const coldShowerChecked = document.getElementById('coldShower').checked;
            const lustChecked = document.getElementById('lust').checked;
            
            if (coldShowerChecked) {
                coldShowerGroup.classList.add('cold-shower-checked');
            } else {
                coldShowerGroup.classList.remove('cold-shower-checked');
            }
            
            if (lustChecked) {
                lustGroup.classList.add('lust-checked');
            } else {
                lustGroup.classList.remove('lust-checked');
            }
            
            updateConsistencyTracker();
            updateStreakTracker();
        }

        function updateStreakTracker() {
            const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
            const dates = Object.keys(allData).sort();
            const streakTracker = document.getElementById('streakTracker');
            
            const streaks = calculateStreaks(dates, allData);
            
            let html = '';
            Object.keys(streaks).forEach(key => {
                const streak = streaks[key];
                let displayName = key.charAt(0).toUpperCase() + key.slice(1);
                if (key === 'screenTime') displayName = 'Screen Time';
                if (key === 'coldShower') displayName = 'Cold Shower';
                if (key === 'lustControl') displayName = 'Lust Control';
                
                const streakColor = streak >= 7 ? '#4CAF50' : streak >= 3 ? '#FF9800' : '#666';
                
                html += `
                    <div class="consistency-item">
                        <span>${displayName}</span>
                        <div style="color: ${streakColor}; font-weight: bold; font-size: 1.1rem;">
                            ${streak} days üî•
                        </div>
                    </div>
                `;
            });
            
            streakTracker.innerHTML = html;
        }

        function updateTotalStats() {
            const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
            const totalStatsElement = document.getElementById('totalStats');
            
            // Calculate totals
            const totals = {
                stretching: 0,
                steps: 0,
                sleep: 0,
                water: 0,
                screenTime: 0,
                pages: 0,
                gymSessions: 0,
                runs: 0,
                totalRunDistance: 0,
                coldShowers: 0,
                naps: 0
            };
            
            let totalDays = 0;
            
            Object.keys(allData).forEach(date => {
                const dayData = allData[date];
                totalDays++;
                
                totals.stretching += parseFloat(dayData.stretching) || 0;
                totals.steps += parseFloat(dayData.steps) || 0;
                totals.sleep += parseFloat(dayData.sleep) || 0;
                totals.water += parseFloat(dayData.water) || 0;
                totals.screenTime += parseFloat(dayData.screenTime) || 0;
                totals.pages += parseFloat(dayData.pages) || 0;
                
                if (dayData.hadGym === true) totals.gymSessions++;
                if (dayData.hadRun === true) {
                    totals.runs++;
                    totals.totalRunDistance += parseFloat(dayData.runDistance) || 0;
                }
                
                if (dayData.coldShower === true) totals.coldShowers++;
                if (dayData.napped === true) totals.naps++;
            });
            
            let html = '';
            
            // Format numbers nicely
            const formatNumber = (num) => {
                if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
                if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
                return Math.round(num * 10) / 10;
            };
            
            html += `
                <div class="consistency-item">
                    <span>üßò Total Stretching</span>
                    <div style="font-weight: bold; color: #667eea;">${formatNumber(totals.stretching)}</div>
                </div>
                <div class="consistency-item">
                    <span>üëü Total Steps</span>
                    <div style="font-weight: bold; color: #667eea;">${formatNumber(totals.steps)}</div>
                </div>
                <div class="consistency-item">
                    <span>üò¥ Total Sleep</span>
                    <div style="font-weight: bold; color: #667eea;">${formatNumber(totals.sleep)}h</div>
                </div>
                <div class="consistency-item">
                    <span>üíß Total Water</span>
                    <div style="font-weight: bold; color: #667eea;">${formatNumber(totals.water)}L</div>
                </div>
                <div class="consistency-item">
                    <span>üì± Total Screen Time</span>
                    <div style="font-weight: bold; color: #667eea;">${formatNumber(totals.screenTime)}h</div>
                </div>
                <div class="consistency-item">
                    <span>üìö Total Pages</span>
                    <div style="font-weight: bold; color: #667eea;">${formatNumber(totals.pages)}</div>
                </div>
                <div class="consistency-item">
                    <span>üèãÔ∏è Gym Sessions</span>
                    <div style="font-weight: bold; color: #667eea;">${totals.gymSessions}</div>
                </div>
                <div class="consistency-item">
                    <span>üèÉ Total Runs</span>
                    <div style="font-weight: bold; color: #667eea;">${totals.runs}</div>
                </div>
                <div class="consistency-item">
                    <span>üìè Total Distance</span>
                    <div style="font-weight: bold; color: #667eea;">${formatNumber(totals.totalRunDistance)}km</div>
                </div>
                <div class="consistency-item">
                    <span>üöø Cold Showers</span>
                    <div style="font-weight: bold; color: #4CAF50;">${totals.coldShowers}</div>
                </div>
                <div class="consistency-item">
                    <span>üò¥ Naps Taken</span>
                    <div style="font-weight: bold; color: #667eea;">${totals.naps}</div>
                </div>
                <div class="consistency-item">
                    <span>üìÖ Days Tracked</span>
                    <div style="font-weight: bold; color: #764ba2;">${totalDays}</div>
                </div>
            `;
            
            totalStatsElement.innerHTML = html;
        }

        function calculateStreaks(dates, allData) {
            const streaks = {
                stretching: 0,
                steps: 0,
                sleep: 0,
                water: 0,
                screenTime: 0,
                pages: 0,
                training: 0,
                coldShower: 0,
                lustControl: 0
            };
            
            // Calculate streaks by going backwards from today
            const today = new Date();
            let currentStreak = {};
            
            // Initialize current streaks
            Object.keys(streaks).forEach(key => {
                currentStreak[key] = 0;
            });
            
            // Go backwards from today to calculate current streaks
            for (let i = 0; i < 365; i++) { // Check up to a year back
                const checkDate = new Date(today);
                checkDate.setDate(checkDate.getDate() - i);
                const dateStr = checkDate.toISOString().split('T')[0];
                
                const dayData = allData[dateStr];
                if (!dayData) {
                    // No data for this day, break all streaks
                    break;
                }
                
                // Check each metric
                let dayHasAnySuccess = false;
                
                Object.keys(goals).forEach(key => {
                    let metGoal = false;
                    
                    if (key === 'training') {
                        // Special handling for training
                        const trainingSessions = (dayData.hadGym ? 1 : 0) + (dayData.hadRun ? 1 : 0);
                        metGoal = trainingSessions >= goals[key];
                    } else {
                        const value = parseFloat(dayData[key]) || 0;
                        const goal = goals[key];
                        metGoal = key === 'screenTime' ? value <= goal : value >= goal;
                    }
                    
                    if (metGoal) {
                        currentStreak[key]++;
                        dayHasAnySuccess = true;
                    } else if (i === 0) {
                        // If today doesn't meet the goal, streak is 0
                        currentStreak[key] = 0;
                    } else {
                        // Previous day didn't meet goal, stop counting for this metric
                        // but don't reset if we're still building the streak
                    }
                });
                
                // Cold shower streak
                if (dayData.coldShower === true) {
                    currentStreak.coldShower++;
                    dayHasAnySuccess = true;
                } else if (i === 0) {
                    currentStreak.coldShower = 0;
                }
                
                // Lust control streak (inverted - not checking the box is good)
                if (dayData.lust !== true) {
                    currentStreak.lustControl++;
                    dayHasAnySuccess = true;
                } else if (i === 0) {
                    currentStreak.lustControl = 0;
                }
            }
            
            // For each metric, count consecutive days from today backwards
            Object.keys(streaks).forEach(key => {
                let streak = 0;
                for (let i = 0; i < dates.length && i < 365; i++) {
                    const checkDate = new Date(today);
                    checkDate.setDate(checkDate.getDate() - i);
                    const dateStr = checkDate.toISOString().split('T')[0];
                    
                    const dayData = allData[dateStr];
                    if (!dayData) break;
                    
                    let metGoal = false;
                    
                    if (key === 'coldShower') {
                        metGoal = dayData.coldShower === true;
                    } else if (key === 'lustControl') {
                        metGoal = dayData.lust !== true;
                    } else if (key === 'training') {
                        const trainingSessions = (dayData.hadGym ? 1 : 0) + (dayData.hadRun ? 1 : 0);
                        metGoal = trainingSessions >= goals[key];
                    } else if (goals[key]) {
                        const value = parseFloat(dayData[key]) || 0;
                        const goal = goals[key];
                        metGoal = key === 'screenTime' ? value <= goal : value >= goal;
                    }
                    
                    if (metGoal) {
                        streak++;
                    } else {
                        break;
                    }
                }
                streaks[key] = streak;
            });
            
            return streaks;
        }

        function updateConsistencyTracker() {
            const tracker = document.getElementById('consistencyTracker');
            const currentData = getCurrentInputs();
            
            let html = '';
            
            // Regular metrics
            Object.keys(goals).forEach(key => {
                if (key === 'training') {
                    // Special handling for training
                    const hadGym = currentData.hadGym;
                    const hadRun = currentData.hadRun;
                    const trainingSessions = (hadGym ? 1 : 0) + (hadRun ? 1 : 0);
                    const isGood = trainingSessions >= goals.training;
                    const status = isGood ? 'good' : 'bad';
                    const icon = isGood ? '‚úì' : '‚úó';
                    
                    html += `
                        <div class="consistency-item">
                            <span>Training</span>
                            <div class="consistency-status status-${status}">${icon}</div>
                        </div>
                    `;
                } else {
                    const current = parseFloat(currentData[key]) || 0;
                    const goal = goals[key];
                    const isGood = key === 'screenTime' ? current <= goal : current >= goal;
                    const status = isGood ? 'good' : 'bad';
                    const icon = isGood ? '‚úì' : '‚úó';
                    
                    let displayName = key.charAt(0).toUpperCase() + key.slice(1);
                    if (key === 'screenTime') displayName = 'Screen Time';
                    
                    html += `
                        <div class="consistency-item">
                            <span>${displayName}</span>
                            <div class="consistency-status status-${status}">${icon}</div>
                        </div>
                    `;
                }
            });
            
            // Cold shower
            const coldShower = document.getElementById('coldShower').checked;
            html += `
                <div class="consistency-item">
                    <span>Cold Shower</span>
                    <div class="consistency-status status-${coldShower ? 'good' : 'bad'}">${coldShower ? '‚úì' : '‚úó'}</div>
                </div>
            `;
            
            // Lust control (inverted - checked is bad)
            const lust = document.getElementById('lust').checked;
            html += `
                <div class="consistency-item">
                    <span>Lust Control</span>
                    <div class="consistency-status status-${lust ? 'bad' : 'good'}">${lust ? '‚úó' : '‚úì'}</div>
                </div>
            `;
            
            tracker.innerHTML = html;
        }

        function getCurrentInputs() {
            return {
                stretching: document.getElementById('stretching').value,
                steps: document.getElementById('steps').value,
                sleep: document.getElementById('sleep').value,
                sleepQuality: document.getElementById('sleepQuality').value,
                remSleep: document.getElementById('remSleep').value,
                deepSleep: document.getElementById('deepSleep').value,
                lightSleep: document.getElementById('lightSleep').value,
                napped: document.getElementById('napped').checked,
                water: document.getElementById('water').value,
                screenTime: document.getElementById('screenTime').value,
                pages: document.getElementById('pages').value,
                hadGym: document.getElementById('hadGym').checked,
                hadRun: document.getElementById('hadRun').checked,
                runType: document.getElementById('runType').value,
                runDistance: document.getElementById('runDistance').value,
                coldShower: document.getElementById('coldShower').checked,
                lust: document.getElementById('lust').checked
            };
        }

        function saveData() {
            const today = new Date().toISOString().split('T')[0];
            const data = getCurrentInputs();
            
            // Get existing data
            let allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
            allData[today] = data;
            
            // Save to localStorage
            localStorage.setItem('lifeTrackerData', JSON.stringify(allData));
            
            // Show success message
            const btn = document.querySelector('.save-btn');
            const originalText = btn.textContent;
            btn.textContent = '‚úÖ Saved Successfully!';
            btn.style.background = 'linear-gradient(135deg, #4CAF50, #45a049)';
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.style.background = 'linear-gradient(135deg, #4CAF50, #45a049)';
            }, 2000);
            
            // Update chart and streaks
            updateChart();
            updateStreakTracker();
            updateTotalStats();
        }

        function loadTodaysData() {
            const today = new Date().toISOString().split('T')[0];
            const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
            const todaysData = allData[today];
            
            if (todaysData) {
                Object.keys(todaysData).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = todaysData[key];
                        } else if (element.tagName === 'SELECT') {
                            element.value = todaysData[key] || '';
                        } else {
                            element.value = todaysData[key];
                        }
                    }
                });
                
                // Show run details if hadRun is checked
                if (todaysData.hadRun) {
                    document.getElementById('runDetails').style.display = 'grid';
                }
                
                updateCheckboxStyles();
                updateConsistencyTracker();
            }
        }

        function showChart(type) {
            currentView = type;
            
            // Update active button
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            updateChart();
        }

        function changePeriod(period) {
            currentPeriod = period;
            
            // Update active button
            document.querySelectorAll('.period-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            updateChart();
        }

        function initializeChart() {
            const ctx = document.getElementById('mainChart').getContext('2d');
            currentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    aspectRatio: 2.5,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
            
            updateChart();
        }

        function updateChart() {
            const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
            const dates = Object.keys(allData).sort();
            
            let chartData = getChartData(dates, allData);
            
            currentChart.data = chartData;
            currentChart.update();
            
            // Update chart title
            const titles = {
                stretching: 'Stretching Sessions',
                steps: 'Steps Taken',
                sleep: 'Sleep Hours',
                water: 'Water Intake (Liters)',
                screenTime: 'Screen Time (Hours)',
                pages: 'Pages Read',
                training: 'Training Sessions'
            };
            
            const periodText = currentPeriod === 'daily' ? 'Last 7 Days' : 
                              currentPeriod === 'weekly' ? 'Last 4 Weeks' : 'Last 6 Months';
            
            document.getElementById('chartTitle').textContent = `${titles[currentView]} - ${periodText}`;
        }

        function getChartData(dates, allData) {
            const now = new Date();
            let filteredDates = [];
            
            if (currentPeriod === 'daily') {
                // Last 7 days
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(now);
                    date.setDate(date.getDate() - i);
                    filteredDates.push(date.toISOString().split('T')[0]);
                }
            } else if (currentPeriod === 'weekly') {
                // Last 4 weeks (weekly averages)
                for (let i = 3; i >= 0; i--) {
                    const date = new Date(now);
                    date.setDate(date.getDate() - (i * 7));
                    filteredDates.push(`Week of ${date.toLocaleDateString()}`);
                }
            } else {
                // Last 6 months (monthly averages)
                for (let i = 5; i >= 0; i--) {
                    const date = new Date(now);
                    date.setMonth(date.getMonth() - i);
                    filteredDates.push(date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' }));
                }
            }
            
            return getSingleMetricChartData(filteredDates, allData, currentView);
        }

        function getSingleMetricChartData(labels, allData, metric) {
            const data = labels.map(label => {
                if (currentPeriod === 'daily') {
                    const dayData = allData[label];
                    return dayData ? (parseFloat(dayData[metric]) || 0) : 0;
                }
                return 0; // Simplified for demo
            });
            
            return {
                labels,
                datasets: [{
                    label: metric.charAt(0).toUpperCase() + metric.slice(1),
                    data,
                    borderColor: '#667eea',
                    backgroundColor: '#667eea20',
                    tension: 0.4,
                    fill: true
                }]
            };
        }
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9af8e80117f65a7e',t:'MTc2NjAwMDU3My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>

</html>

