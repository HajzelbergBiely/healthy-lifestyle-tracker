<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeTracker Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .date-display {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
        }
        
        .tracking-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            min-height: calc(100vh - 200px);
        }
        
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: sticky;
            top: 20px;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
        }
        
        .quote-card {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .quote-text {
            font-style: italic;
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: #555;
        }
        
        .quote-author {
            font-weight: bold;
            color: #667eea;
        }
        
        .consistency-card {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .consistency-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #333;
            text-align: center;
        }
        
        .consistency-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .consistency-item:last-child {
            border-bottom: none;
        }
        
        .consistency-status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.8rem;
        }
        
        .status-good {
            background: #4CAF50;
        }
        
        .status-bad {
            background: #f44336;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .input-group {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .input-group:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }
        
        .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .sleep-expanded, .training-expanded {
            grid-column: span 2;
        }
        
        .sleep-details, .training-checkboxes, .run-details, .bodyweight-details {
            margin-top: 15px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .sleep-card {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .sleep-score {
            text-align: center;
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
            color: #667eea;
        }
        
        .hour-minute-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
        }
        
        .hour-minute-group input {
            text-align: center;
            padding: 8px;
        }
        
        .sleep-time-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .sleep-time-inputs > div {
            display: flex;
            flex-direction: column;
        }
        
        .sleep-time-inputs label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .sleep-breakdown {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .sleep-metric {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }
        
        .sleep-metric-label {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .sleep-metric-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
        }
        
        .sleep-stage-bar {
            height: 8px;
            border-radius: 4px;
            margin-top: 5px;
            overflow: hidden;
            background: #e0e0e0;
        }
        
        .sleep-stage-fill {
            height: 100%;
            border-radius: 4px;
        }
        
        .sleep-detail-item, .run-detail-item {
            display: flex;
            flex-direction: column;
        }
        
        .sleep-detail-item label, .run-detail-item label {
            font-size: 0.9rem;
            margin-bottom: 5px;
            color: #666;
        }
        
        .sleep-detail-item input, .run-detail-item input, .run-detail-item select {
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 0.95rem;
        }
        
        .run-detail-item select {
            cursor: pointer;
            background: white;
        }
        
        .training-checkboxes {
            grid-template-columns: 1fr;
            gap: 10px;
        }
        
        .run-details {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #e0e0e0;
        }
        
        .pause-section {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-top: 10px;
        }
        
        .pause-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #333;
            text-align: center;
        }
        
        .pause-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .pause-toggle:hover {
            background: #e9ecef;
        }
        
        .pause-toggle.active {
            background: #fff3cd;
            border: 2px solid #ffc107;
        }
        
        .pause-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }
        
        .pause-label {
            flex-grow: 1;
            margin-left: 10px;
            font-weight: 600;
            color: #333;
        }
        
        .pause-days {
            font-size: 0.9rem;
            color: #666;
            background: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
        }
        
        .pause-note {
            font-size: 0.8rem;
            color: #666;
            text-align: center;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }

        .reset-section {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-top: 10px;
        }
        
        .reset-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #333;
            text-align: center;
        }
        
        .reset-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }
        
        .reset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.4);
        }
        
        .reset-confirm {
            display: none;
            margin-top: 10px;
            padding: 15px;
            background: #fff3cd;
            border-radius: 10px;
            border: 1px solid #ffc107;
        }
        
        .reset-confirm-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .reset-confirm-btn {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .reset-confirm-yes {
            background: #f44336;
            color: white;
        }
        
        .reset-confirm-yes:hover {
            background: #d32f2f;
        }
        
        .reset-confirm-no {
            background: #6c757d;
            color: white;
        }
        
        .reset-confirm-no:hover {
            background: #545b62;
        }
        
        .reset-note {
            font-size: 0.8rem;
            color: #666;
            text-align: center;
            margin-top: 5px;
        }

        .points-card {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .points-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .points-title {
            font-size: 1.3rem;
            color: #333;
        }
        
        .points-total {
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 4px rgba(255, 215, 0, 0.3);
        }
        
        .points-breakdown {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
        
        .points-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .points-item:last-child {
            border-bottom: none;
        }
        
        .points-activity {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .points-emoji {
            font-size: 1.2rem;
        }
        
        .points-value {
            font-weight: bold;
            color: #FF9800;
        }
        
        .points-multiplier {
            font-size: 0.8rem;
            color: #4CAF50;
            margin-left: 5px;
        }
        
        .points-negative {
            color: #f44336;
        }
        
        .points-today {
            text-align: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #FFD700;
            font-weight: bold;
            color: #333;
        }
        
        .level-indicator {
            margin-top: 10px;
            text-align: center;
        }
        
        .level-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 5px 0;
        }
        
        .level-progress {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .level-text {
            font-size: 0.9rem;
            color: #666;
        }
        
        @media (max-width: 768px) {
            .sleep-expanded, .training-expanded {
                grid-column: span 1;
            }
            
            .sleep-details {
                grid-template-columns: 1fr;
            }
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .checkbox-group label {
            margin: 0;
            cursor: pointer;
        }
        
        .cold-shower-checked {
            background: linear-gradient(135deg, #4CAF50, #45a049) !important;
            color: white;
        }
        
        .lust-checked {
            background: linear-gradient(135deg, #f44336, #d32f2f) !important;
            color: white;
        }
        
        .nav-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }
        
        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            background: #667eea;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .nav-btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        
        .nav-btn.active {
            background: #764ba2;
        }
        
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            height: 480px; 
            position: relative;
        }
        
        .chart-title {
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.5rem;
            color: #333;
        }

        .chart-wrapper {
            position: absolute;
            top: 70px;
            bottom: 20px;
            left: 20px;
            right: 20px;
        }
        
        .period-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .period-btn {
            padding: 8px 16px;
            border: 2px solid #667eea;
            border-radius: 20px;
            background: white;
            color: #667eea;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .period-btn.active {
            background: #667eea;
            color: white;
        }
        
        .save-btn {
            display: block;
            width: 200px;
            margin: 30px auto;
            padding: 15px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .training-details {
            margin-top: 10px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .training-details input {
            width: 100%;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 0.95rem;
            margin-top: 5px;
        }
        
        .run-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        
        .run-detail-item {
            display: flex;
            flex-direction: column;
        }
        
        .run-detail-item label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .run-detail-item input,
        .run-detail-item select {
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 0.95rem;
        }
        
        .run-detail-item select {
            cursor: pointer;
            background: white;
        }
        
        .bodyweight-goals {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            margin-top: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .bodyweight-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #333;
            text-align: center;
        }
        
        .bodyweight-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .bodyweight-item {
            display: flex;
            flex-direction: column;
        }
        
        .bodyweight-item label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .bodyweight-item input {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
        }
        
        .bodyweight-goal-display {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }
        
        .bodyweight-goal {
            text-align: center;
            flex: 1;
        }
        
        .bodyweight-goal-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }
        
        .bodyweight-goal-label {
            font-size: 0.8rem;
            color: #666;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .input-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .sidebar {
                position: static;
                max-height: none;
            }
        }
        
        /* New style for overall consistency card in sidebar */
        .consistency-overall-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .consistency-percentage {
            font-size: 3rem;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .consistency-days {
            text-align: center;
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        /* Rest day button */
        .rest-day-btn {
            width: 100%;
            padding: 12px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            margin-bottom: 5px;
        }
        
        .rest-day-btn.active {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }
        
        .rest-day-status {
            font-size: 0.8rem;
            color: #666;
            text-align: center;
            margin-top: 5px;
            display: none;
        }
        
        /* Chart type selector */
        .chart-type-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .chart-type-btn {
            padding: 6px 12px;
            border: 2px solid #667eea;
            border-radius: 15px;
            background: white;
            color: #667eea;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }
        
        .chart-type-btn.active {
            background: #667eea;
            color: white;
        }
        
        /* Habit break warning */
        .habit-break-warning {
            margin-top: 15px;
            padding: 10px;
            background: rgba(255, 193, 7, 0.2);
            border-radius: 8px;
            border: 1px solid #ffc107;
        }
        
        .habit-break-title {
            color: #ffc107;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
    </style>
    <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåü LifeTracker Pro</h1>
            <div class="date-display" id="currentDate"></div>
        </div>
        <div class="main-content">
            <div class="tracking-section">
                <div class="input-grid">
                    <div class="input-group"><label for="stretching">üßò Stretching Sessions</label> <input type="number" id="stretching" placeholder="Enter sessions"></div>
                    <div class="input-group"><label for="steps">üëü Steps Taken</label> <input type="number" id="steps" placeholder="Enter steps"></div>
                    <div class="input-group sleep-expanded">
                        <label for="sleepHours">üò¥ Sleep Time</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                            <div>
                                <label for="sleepHours" style="font-size: 0.9rem; color: #666;">Hours</label>
                                <input type="number" id="sleepHours" step="0.5" placeholder="Hours" min="0" max="24">
                            </div>
                            <div>
                                <label for="sleepMinutes" style="font-size: 0.9rem; color: #666;">Minutes</label>
                                <input type="number" id="sleepMinutes" placeholder="Minutes" min="0" max="59">
                            </div>
                        </div>
                        <div class="sleep-details">
                            <div class="sleep-detail-item">
                                <label for="sleepQuality">Sleep Score (1-100)</label>
                                <input type="number" id="sleepQuality" min="1" max="100" placeholder="Rate 1-100">
                            </div>
                            
                            <div class="sleep-detail-item">
                                <label>REM Sleep</label>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                                    <input type="number" id="remHours" placeholder="H" min="0" max="24" style="text-align: center;">
                                    <input type="number" id="remMinutes" placeholder="M" min="0" max="59" style="text-align: center;">
                                </div>
                            </div>
                            
                            <div class="sleep-detail-item">
                                <label>Deep Sleep</label>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                                    <input type="number" id="deepHours" placeholder="H" min="0" max="24" style="text-align: center;">
                                    <input type="number" id="deepMinutes" placeholder="M" min="0" max="59" style="text-align: center;">
                                </div>
                            </div>
                            
                            <div class="sleep-detail-item">
                                <label>Light Sleep</label>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                                    <input type="number" id="lightHours" placeholder="H" min="0" max="24" style="text-align: center;">
                                    <input type="number" id="lightMinutes" placeholder="M" min="0" max="59" style="text-align: center;">
                                </div>
                            </div>
                            
                            <div class="checkbox-group" style="margin-top: 10px;">
                                <input type="checkbox" id="napped">
                                <label for="napped">Took a nap today</label>
                            </div>
                        </div>
                    </div>
                    <div class="input-group"><label for="water">üíß Water (Liters)</label> <input type="number" id="water" step="0.1" placeholder="Enter liters"></div>
                    <div class="input-group"><label for="screenTime">üì± Screen Time (Hours)</label> <input type="number" id="screenTime" step="0.5" placeholder="Enter hours"></div>
                    <div class="input-group"><label for="pages">üìö Pages Read</label> <input type="number" id="pages" placeholder="Enter pages"></div>
                    <div class="input-group training-expanded">
                        <label>üí™ Training Sessions</label>
                        
                        <!-- REST DAY BUTTON -->
                        <button id="restDayBtn" class="rest-day-btn" onclick="toggleRestDay()">
                            üõå Rest Day (Pause Training Streaks)
                        </button>
                        <div id="restDayStatus" class="rest-day-status">
                            ‚úÖ Training streaks paused for today
                        </div>
                        
                        <div class="training-checkboxes">
                            <!-- Gym Session 1 -->
                            <div class="checkbox-group">
                                <input type="checkbox" id="hadGym">
                                <label for="hadGym">üèãÔ∏è Gym Session 1</label>
                            </div>
                            
                            <div id="gymDetails" class="training-details" style="display: none;">
                                <div style="margin-bottom: 10px;">
                                    <label style="display: block; margin-bottom: 5px; font-size: 0.9rem; color: #666;">Workout Focus:</label>
                                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="gymCore">
                                            <label for="gymCore" style="font-size: 0.9rem;">Core</label>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="gymLegs">
                                            <label for="gymLegs" style="font-size: 0.9rem;">Legs</label>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="gymUpper">
                                            <label for="gymUpper" style="font-size: 0.9rem;">Upper</label>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="gymFull">
                                            <label for="gymFull" style="font-size: 0.9rem;">Full Body</label>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="gymCardio">
                                            <label for="gymCardio" style="font-size: 0.9rem;">Cardio</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div>
                                        <label for="gymDuration" style="font-size: 0.9rem; color: #666;">Duration (min)</label>
                                        <input type="number" id="gymDuration" placeholder="Minutes" min="0">
                                    </div>
                                    <div>
                                        <label for="gymIntensity" style="font-size: 0.9rem; color: #666;">Intensity (1-10)</label>
                                        <input type="number" id="gymIntensity" min="1" max="10" placeholder="1-10">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Gym Session 2 -->
                            <div class="checkbox-group" style="margin-top: 15px;">
                                <input type="checkbox" id="hadGym2">
                                <label for="hadGym2">üèãÔ∏è Gym Session 2</label>
                            </div>
                            
                            <div id="gymDetails2" class="training-details" style="display: none;">
                                <div style="margin-bottom: 10px;">
                                    <label style="display: block; margin-bottom: 5px; font-size: 0.9rem; color: #666;">Workout Focus:</label>
                                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="gym2Core">
                                            <label for="gym2Core" style="font-size: 0.9rem;">Core</label>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="gym2Legs">
                                            <label for="gym2Legs" style="font-size: 0.9rem;">Legs</label>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="gym2Upper">
                                            <label for="gym2Upper" style="font-size: 0.9rem;">Upper</label>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="gym2Full">
                                            <label for="gym2Full" style="font-size: 0.9rem;">Full Body</label>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="gym2Cardio">
                                            <label for="gym2Cardio" style="font-size: 0.9rem;">Cardio</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div>
                                        <label for="gym2Duration" style="font-size: 0.9rem; color: #666;">Duration (min)</label>
                                        <input type="number" id="gym2Duration" placeholder="Minutes" min="0">
                                    </div>
                                    <div>
                                        <label for="gym2Intensity" style="font-size: 0.9rem; color: #666;">Intensity (1-10)</label>
                                        <input type="number" id="gym2Intensity" min="1" max="10" placeholder="1-10">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Home Workout -->
                            <div class="checkbox-group" style="margin-top: 15px;">
                                <input type="checkbox" id="hadHome">
                                <label for="hadHome">üè† Home Workout</label>
                            </div>
                            
                            <div id="homeDetails" class="training-details" style="display: none;">
                                <div style="margin-bottom: 10px;">
                                    <label style="display: block; margin-bottom: 5px; font-size: 0.9rem; color: #666;">Workout Type:</label>
                                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="homeBodyweight">
                                            <label for="homeBodyweight" style="font-size: 0.9rem;">Bodyweight</label>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="homeYoga">
                                            <label for="homeYoga" style="font-size: 0.9rem;">Yoga/Stretch</label>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="homeHIIT">
                                            <label for="homeHIIT" style="font-size: 0.9rem;">HIIT</label>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 5px;">
                                            <input type="checkbox" id="homeOther">
                                            <label for="homeOther" style="font-size: 0.9rem;">Other</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div>
                                        <label for="homeDuration" style="font-size: 0.9rem; color: #666;">Duration (min)</label>
                                        <input type="number" id="homeDuration" placeholder="Minutes" min="0">
                                    </div>
                                    <div>
                                        <label for="homeIntensity" style="font-size: 0.9rem; color: #666;">Intensity (1-10)</label>
                                        <input type="number" id="homeIntensity" min="1" max="10" placeholder="1-10">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Running Session 1 -->
                            <div class="checkbox-group" style="margin-top: 15px;">
                                <input type="checkbox" id="hadRun">
                                <label for="hadRun">üèÉ Running Session 1</label>
                            </div>
                            
                            <div id="runDetails" class="run-details" style="display: none;">
                                <div class="run-detail-item">
                                    <label for="runType">Run Type</label>
                                    <select id="runType">
                                        <option value="">Select type</option>
                                        <option value="interval">Interval Training</option>
                                        <option value="free">Free Run</option>
                                        <option value="race">Race</option>
                                        <option value="tempo">Tempo Run</option>
                                        <option value="long">Long Distance</option>
                                        <option value="recovery">Recovery Run</option>
                                        <option value="hill">Hill Training</option>
                                    </select>
                                </div>
                                <div class="run-detail-item">
                                    <label for="runDistance">Distance (km)</label>
                                    <input type="number" id="runDistance" step="0.1" placeholder="Enter distance">
                                </div>
                                <div class="run-detail-item">
                                    <label for="runDuration">Duration (min)</label>
                                    <input type="number" id="runDuration" placeholder="Minutes">
                                </div>
                                <div class="run-detail-item">
                                    <label for="runIntensity">Intensity (1-10)</label>
                                    <input type="number" id="runIntensity" min="1" max="10" placeholder="1-10">
                                </div>
                            </div>
                            
                            <!-- Running Session 2 -->
                            <div class="checkbox-group" style="margin-top: 15px;">
                                <input type="checkbox" id="hadRun2">
                                <label for="hadRun2">üèÉ Running Session 2</label>
                            </div>
                            
                            <div id="runDetails2" class="run-details" style="display: none;">
                                <div class="run-detail-item">
                                    <label for="runType2">Run Type</label>
                                    <select id="runType2">
                                        <option value="">Select type</option>
                                        <option value="interval">Interval Training</option>
                                        <option value="free">Free Run</option>
                                        <option value="race">Race</option>
                                        <option value="tempo">Tempo Run</option>
                                        <option value="long">Long Distance</option>
                                        <option value="recovery">Recovery Run</option>
                                        <option value="hill">Hill Training</option>
                                    </select>
                                </div>
                                <div class="run-detail-item">
                                    <label for="runDistance2">Distance (km)</label>
                                    <input type="number" id="runDistance2" step="0.1" placeholder="Enter distance">
                                </div>
                                <div class="run-detail-item">
                                    <label for="runDuration2">Duration (min)</label>
                                    <input type="number" id="runDuration2" placeholder="Minutes">
                                </div>
                                <div class="run-detail-item">
                                    <label for="runIntensity2">Intensity (1-10)</label>
                                    <input type="number" id="runIntensity2" min="1" max="10" placeholder="1-10">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Bodyweight Goals -->
                        <div class="bodyweight-goals">
                            <div class="bodyweight-title">üèãÔ∏è Bodyweight Goals</div>
                            <div class="bodyweight-inputs">
                                <div class="bodyweight-item">
                                    <label for="pushUps">Push-ups Count</label>
                                    <input type="number" id="pushUps" placeholder="Enter push-ups count" min="0">
                                </div>
                                <div class="bodyweight-item">
                                    <label for="pullUps">Pull-ups Count</label>
                                    <input type="number" id="pullUps" placeholder="Enter pull-ups count" min="0">
                                </div>
                            </div>
                            <div class="bodyweight-goal-display">
                                <div class="bodyweight-goal">
                                    <div class="bodyweight-goal-value" id="pushUpsGoal">0/50</div>
                                    <div class="bodyweight-goal-label">Push-ups Goal</div>
                                </div>
                                <div class="bodyweight-goal">
                                    <div class="bodyweight-goal-value" id="pullUpsGoal">0/20</div>
                                    <div class="bodyweight-goal-label">Pull-ups Goal</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="input-group" id="coldShowerGroup"><label>üöø Cold Shower</label>
                        <div class="checkbox-group"><input type="checkbox" id="coldShower"> <label for="coldShower">Took cold shower today</label></div>
                    </div>
                    <div class="input-group" id="lustGroup"><label>üö´ Lust Control</label>
                        <div class="checkbox-group"><input type="checkbox" id="lust"> <label for="lust">Broke lust control (check if failed)</label></div>
                    </div>
                </div>
                <button class="save-btn" onclick="saveData()">üíæ Save Today's Data</button>
                <div class="nav-buttons">
                    <button class="nav-btn active" onclick="showChart('stretching')">üßò Stretching</button>
                    <button class="nav-btn" onclick="showChart('steps')">üëü Steps</button>
                    <button class="nav-btn" onclick="showChart('sleep')">üò¥ Sleep</button>
                    <button class="nav-btn" onclick="showChart('water')">üíß Water</button>
                    <button class="nav-btn" onclick="showChart('screenTime')">üì± Screen Time</button>
                    <button class="nav-btn" onclick="showChart('pages')">üìö Reading</button>
                    <button class="nav-btn" onclick="showChart('training')">üí™ Training</button>
                    <button class="nav-btn" onclick="showChart('consistency')">üìä Consistency</button>
                </div>
                <div class="chart-container">
                    <div class="period-selector">
                        <button class="period-btn active" onclick="changePeriod('daily')">Daily</button>
                        <button class="period-btn" onclick="changePeriod('weekly')">Weekly</button>
                        <button class="period-btn" onclick="changePeriod('monthly')">Monthly</button>
                    </div>
                    <!-- New Chart Type Selector -->
                    <div class="chart-type-selector" id="chartTypeSelector" style="display: none;">
                        <button class="chart-type-btn active" onclick="changeChartType('line')">Line Chart</button>
                        <button class="chart-type-btn" onclick="changeChartType('pie')">Pie Chart</button>
                    </div>
                    <div class="chart-title" id="chartTitle">Stretching Sessions - Last 7 Days</div>
                    <div class="chart-wrapper">
                        <canvas id="mainChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Overall Consistency Card (ADDED AT TOP OF SIDEBAR) -->
                <div class="consistency-overall-card">
                    <div class="consistency-title" style="color: white;">üìä Overall Consistency</div>
                    <div class="consistency-percentage" id="overallConsistency">0%</div>
                    <div class="consistency-days" id="consistencyDays">0/0 days completed</div>
                    <div id="habitBreakWarning" class="habit-break-warning" style="display: none;">
                        <div class="habit-break-title">‚ö†Ô∏è Streak Breaks Detected</div>
                        <div id="habitBreakList" style="font-size: 0.8rem;"></div>
                    </div>
                </div>
                
                <div class="points-card">
                    <div class="points-header">
                        <div class="points-title">üéÆ Points System</div>
                        <div class="points-total" id="totalPoints">0</div>
                    </div>
                    <div class="level-indicator">
                        <div class="level-text" id="levelText">Level 1 (0/100)</div>
                        <div class="level-bar">
                            <div class="level-progress" id="levelProgress" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="points-today" id="todayPoints">Today: 0 points</div>
                    <div class="points-breakdown" id="pointsBreakdown">
                        <!-- Points breakdown will be added here by JavaScript -->
                    </div>
                </div>
                <div class="pause-section">
                    <div class="pause-title">‚è∏Ô∏è Pause Streaks</div>
                    <div class="pause-toggle" onclick="togglePause('steps')">
                        <input type="checkbox" class="pause-checkbox" id="pauseSteps">
                        <span class="pause-label">Steps Taken</span>
                        <span class="pause-days" id="pauseStepsDays">0 days</span>
                    </div>
                    <div class="pause-toggle" onclick="togglePause('training')">
                        <input type="checkbox" class="pause-checkbox" id="pauseTraining">
                        <span class="pause-label">Training Sessions</span>
                        <span class="pause-days" id="pauseTrainingDays">0 days</span>
                    </div>
                    <div class="pause-toggle" onclick="togglePause('coldShower')">
                        <input type="checkbox" class="pause-checkbox" id="pauseColdShower">
                        <span class="pause-label">Cold Showers</span>
                        <span class="pause-days" id="pauseColdShowerDays">0 days</span>
                    </div>
                    <!-- NEW: Pause for bodyweight training -->
                    <div class="pause-toggle" onclick="togglePause('pushUps')">
                        <input type="checkbox" class="pause-checkbox" id="pausePushUps">
                        <span class="pause-label">Push-ups</span>
                        <span class="pause-days" id="pausePushUpsDays">0 days</span>
                    </div>
                    <div class="pause-toggle" onclick="togglePause('pullUps')">
                        <input type="checkbox" class="pause-checkbox" id="pausePullUps">
                        <span class="pause-label">Pull-ups</span>
                        <span class="pause-days" id="pausePullUpsDays">0 days</span>
                    </div>
                    <div class="pause-note">Toggle on to freeze streak when sick/resting</div>
                    <div class="reset-section">
                        <div class="reset-title">‚ö†Ô∏è Reset All Data</div>
                        <button class="reset-btn" onclick="showResetConfirm()">üóëÔ∏è Hard Reset All Data</button>
                        <div class="reset-confirm" id="resetConfirm">
                            <div style="color: #856404; margin-bottom: 10px; font-weight: 600;">
                                ‚ö†Ô∏è Are you sure? This will delete ALL data permanently!
                            </div>
                            <div class="reset-confirm-buttons">
                                <button class="reset-confirm-btn reset-confirm-yes" onclick="hardReset()">Yes, Delete Everything</button>
                                <button class="reset-confirm-btn reset-confirm-no" onclick="hideResetConfirm()">Cancel</button>
                            </div>
                        </div>
                        <div class="reset-note">This will clear all input fields and delete all saved data</div>
                    </div>
                </div>
                <div class="quote-card">
                    <div class="quote-text" id="dailyQuote"></div>
                    <div class="quote-author" id="quoteAuthor"></div>
                </div>
                <div class="sleep-card">
                    <div class="consistency-title">üò¥ Sleep Analysis</div>
                    <div id="sleepAnalysis">
                        <div style="text-align: center; color: #888; padding: 20px;">Enter sleep data to see analysis</div>
                    </div>
                </div>
                <div class="consistency-card">
                    <div class="consistency-title">üéØ Today's Goals</div>
                    <div id="consistencyTracker"></div>
                </div>
                <div class="consistency-card">
                    <div class="consistency-title">üî• Consistency Streaks</div>
                    <div id="streakTracker"></div>
                </div>
                <div class="consistency-card">
                    <div class="consistency-title">üìä Total Statistics</div>
                    <div id="totalStats"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ==================== UPDATED CONFIGURATION ====================
        
        // Motivational quotes
        const quotes = [
            { text: "The only way to do great work is to love what you do.", author: "Steve Jobs" },
            { text: "Success is not final, failure is not fatal: it is the courage to continue that counts.", author: "Winston Churchill" },
            { text: "The future belongs to those who believe in the beauty of their dreams.", author: "Eleanor Roosevelt" },
            { text: "It is during our darkest moments that we must focus to see the light.", author: "Aristotle" },
            { text: "The only impossible journey is the one you never begin.", author: "Tony Robbins" },
            { text: "In the middle of difficulty lies opportunity.", author: "Albert Einstein" },
            { text: "Believe you can and you're halfway there.", author: "Theodore Roosevelt" },
            { text: "The way to get started is to quit talking and begin doing.", author: "Walt Disney" },
            { text: "Don't watch the clock; do what it does. Keep going.", author: "Sam Levenson" },
            { text: "A year from now you may wish you had started today.", author: "Karen Lamb" }
        ];
        
        // Goals for consistency tracking
        const goals = {
            steps: 10000,
            water: 2,
            pages: 20,
            stretching: 2,
            sleep: 8,
            screenTime: 2,
            training: 1,
            pushUps: 50,
            pullUps: 20
        };
        
        // Pause/Freeze functionality storage
        let pausedStreaks = JSON.parse(localStorage.getItem('pausedStreaks')) || {
            steps: { paused: false, days: 0 },
            training: { paused: false, days: 0 },
            coldShower: { paused: false, days: 0 },
            pushUps: { paused: false, days: 0 },
            pullUps: { paused: false, days: 0 }
        };
        
        // Rest day tracking
        let isRestDay = JSON.parse(localStorage.getItem('isRestDay')) || false;
        const todayStr = new Date().toISOString().split('T')[0];
        
        // Points System Configuration - UPDATED BASED ON YOUR REQUEST
        const pointsConfig = {
            // Base points for completing habits
            stretching: 10,
            steps: 15,
            sleep: 25, // Only given when BOTH conditions met
            water: 10,
            screenTime: 15,
            pages: 10,
            training: {
                base: 20,
                bonus_1h15: 10, // Bonus for training > 1h15
                bonus_intense: 15, // Bonus for intensity > 7
                per_session: 5 // Additional per session after first
            },
            coldShower: 20,
            lustControl: 30,
            pushUps: 15,
            pullUps: 15,
            bodyweightBonus: 10, // Bonus for completing both push-ups and pull-ups
            
            // Points deductions
            deductions: {
                sleepScoreLow: -15, // Score <= 60
                sleepShort: -20, // < 7h
                sleepWrongRange: -10, // < 8h or > 9.5h (even with good score)
                stretching: -10,
                steps: -15,
                water: -10,
                screenTime: -10,
                pages: -10,
                pushUps: -10,
                pullUps: -10,
                training: -20,
                streakBreak: -30, // For breaking streak > 3 days
                lust: -50
            },
            
            // Bonuses for exceeding goals
            exceedBonuses: {
                steps: 0.005, // 0.5 points per 100 extra steps
                water: 5,
                pages: 0.5,
                stretching: 3,
                pushUps: 1,
                pullUps: 1
            },
            
            // Streak multipliers
            streakMultipliers: {
                3: 1.2,
                7: 1.5,
                14: 2.0,
                30: 3.0
            },
            
            // Daily completion bonus
            dailyCompletionBonus: 50
        };
        
        let currentChart = null;
        let currentView = 'stretching';
        let currentPeriod = 'daily';
        let chartType = 'line'; // 'line' or 'pie'
        
        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            displayCurrentDate();
            displayDailyQuote();
            loadTodaysData();
            updateConsistencyTracker();
            updateStreakTracker();
            updateTotalStats();
            updatePointsDisplay();
            initializeChart();
            updateOverallConsistency();
            
            // Initialize pause system
            updatePauseDisplay();
            resetPauseCounters();
            
            // Initialize rest day
            updateRestDayDisplay();
            
            // Training session toggle listeners
            document.getElementById('hadGym').addEventListener('change', function() {
                document.getElementById('gymDetails').style.display = this.checked ? 'block' : 'none';
                updateConsistencyTracker();
                updatePointsDisplay();
            });
            
            document.getElementById('hadGym2').addEventListener('change', function() {
                document.getElementById('gymDetails2').style.display = this.checked ? 'block' : 'none';
                updateConsistencyTracker();
                updatePointsDisplay();
            });
            
            document.getElementById('hadHome').addEventListener('change', function() {
                document.getElementById('homeDetails').style.display = this.checked ? 'block' : 'none';
                updateConsistencyTracker();
                updatePointsDisplay();
            });
            
            document.getElementById('hadRun').addEventListener('change', function() {
                document.getElementById('runDetails').style.display = this.checked ? 'grid' : 'none';
                if (!this.checked) {
                    document.getElementById('runType').value = '';
                    document.getElementById('runDistance').value = '';
                    document.getElementById('runDuration').value = '';
                    document.getElementById('runIntensity').value = '';
                }
                updateConsistencyTracker();
                updatePointsDisplay();
            });
            
            document.getElementById('hadRun2').addEventListener('change', function() {
                document.getElementById('runDetails2').style.display = this.checked ? 'grid' : 'none';
                if (!this.checked) {
                    document.getElementById('runType2').value = '';
                    document.getElementById('runDistance2').value = '';
                    document.getElementById('runDuration2').value = '';
                    document.getElementById('runIntensity2').value = '';
                }
                updateConsistencyTracker();
                updatePointsDisplay();
            });
            
            // Bodyweight inputs listeners
            document.getElementById('pushUps').addEventListener('input', function() {
                updateBodyweightGoals();
                updateConsistencyTracker();
                updatePointsDisplay();
            });
            
            document.getElementById('pullUps').addEventListener('input', function() {
                updateBodyweightGoals();
                updateConsistencyTracker();
                updatePointsDisplay();
            });
            
            // Training input listeners
            const trainingInputs = ['gymDuration', 'gymIntensity', 'gym2Duration', 'gym2Intensity', 
                                   'homeDuration', 'homeIntensity', 'runDistance', 'runDuration', 
                                   'runIntensity', 'runDistance2', 'runDuration2', 'runIntensity2',
                                   'runType', 'runType2'];
            
            trainingInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', function() {
                        updateConsistencyTracker();
                        updatePointsDisplay();
                    });
                }
            });
            
            // Workout type checkboxes
            ['gymCore', 'gymLegs', 'gymUpper', 'gymFull', 'gymCardio',
             'gym2Core', 'gym2Legs', 'gym2Upper', 'gym2Full', 'gym2Cardio',
             'homeBodyweight', 'homeYoga', 'homeHIIT', 'homeOther'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', function() {
                        updatePointsDisplay();
                    });
                }
            });
            
            // General input listeners
            ['stretching', 'steps', 'sleepHours', 'water', 'screenTime', 'pages'].forEach(id => {
                document.getElementById(id).addEventListener('input', function() {
                    updateConsistencyTracker();
                    updatePointsDisplay();
                    updateOverallConsistency();
                });
            });
            
            // Sleep input listeners
            ['sleepHours', 'sleepMinutes', 'sleepQuality', 'remHours', 'remMinutes', 
             'deepHours', 'deepMinutes', 'lightHours', 'lightMinutes'].forEach(id => {
                document.getElementById(id).addEventListener('input', function() {
                    updateSleepAnalysis();
                    updateConsistencyTracker();
                    updatePointsDisplay();
                    updateOverallConsistency();
                });
            });
            
            // Checkbox listeners
            ['coldShower', 'lust', 'napped'].forEach(id => {
                document.getElementById(id).addEventListener('change', function() {
                    if (id === 'coldShower' || id === 'lust') updateCheckboxStyles();
                    if (id === 'napped') updateSleepAnalysis();
                    updateConsistencyTracker();
                    updatePointsDisplay();
                    updateOverallConsistency();
                });
            });
            
            // Initialize displays
            updateSleepAnalysis();
            updateBodyweightGoals();
        });
        
        // ==================== BASIC FUNCTIONS ====================
        function displayCurrentDate() {
            const today = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            document.getElementById('currentDate').textContent = today.toLocaleDateString('en-US', options);
            clearOldData();
        }
        
        function clearOldData() {
            const today = new Date().toISOString().split('T')[0];
            const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
            
            if (allData[today]) return; // Don't clear if data exists for today
            
            // Clear inputs
            ['stretching', 'steps', 'sleepHours', 'sleepMinutes', 'water', 'screenTime', 'pages', 
             'sleepQuality', 'remHours', 'remMinutes', 'deepHours', 'deepMinutes', 
             'lightHours', 'lightMinutes', 'runDistance', 'runDistance2',
             'gymDuration', 'gymIntensity', 'gym2Duration', 'gym2Intensity',
             'homeDuration', 'homeIntensity', 'runDuration', 'runIntensity',
             'runDuration2', 'runIntensity2', 'pushUps', 'pullUps'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.value = '';
            });
            
            // Clear checkboxes
            ['hadGym', 'hadGym2', 'hadHome', 'hadRun', 'hadRun2', 'coldShower', 'lust', 'napped'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.checked = false;
            });
            
            // Clear workout type checkboxes
            ['gymCore', 'gymLegs', 'gymUpper', 'gymFull', 'gymCardio',
             'gym2Core', 'gym2Legs', 'gym2Upper', 'gym2Full', 'gym2Cardio',
             'homeBodyweight', 'homeYoga', 'homeHIIT', 'homeOther'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.checked = false;
            });
            
            // Clear selects
            ['runType', 'runType2'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.value = '';
            });
            
            // Hide details
            ['gymDetails', 'gymDetails2', 'homeDetails', 'runDetails', 'runDetails2'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.style.display = 'none';
            });
            
            updateCheckboxStyles();
            updateConsistencyTracker();
            updateSleepAnalysis();
            updateBodyweightGoals();
            updateOverallConsistency();
        }
        
        function displayDailyQuote() {
            const today = new Date();
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
            const quoteIndex = dayOfYear % quotes.length;
            document.getElementById('dailyQuote').textContent = `"${quotes[quoteIndex].text}"`;
            document.getElementById('quoteAuthor').textContent = `‚Äî ${quotes[quoteIndex].author}`;
        }
        
        function updateCheckboxStyles() {
            const coldShowerGroup = document.getElementById('coldShowerGroup');
            const lustGroup = document.getElementById('lustGroup');
            const coldShowerChecked = document.getElementById('coldShower').checked;
            const lustChecked = document.getElementById('lust').checked;
            
            coldShowerGroup.classList.toggle('cold-shower-checked', coldShowerChecked);
            lustGroup.classList.toggle('lust-checked', lustChecked);
            updateConsistencyTracker();
        }
        
        function updateBodyweightGoals() {
            const pushUps = parseInt(document.getElementById('pushUps').value) || 0;
            const pullUps = parseInt(document.getElementById('pullUps').value) || 0;
            
            document.getElementById('pushUpsGoal').textContent = `${pushUps}/${goals.pushUps}`;
            document.getElementById('pullUpsGoal').textContent = `${pullUps}/${goals.pullUps}`;
        }
        
        function toggleRestDay() {
            isRestDay = !isRestDay;
            localStorage.setItem('isRestDay', JSON.stringify(isRestDay));
            
            const restDayBtn = document.getElementById('restDayBtn');
            const restDayStatus = document.getElementById('restDayStatus');
            
            if (isRestDay) {
                restDayBtn.classList.add('active');
                restDayBtn.textContent = '‚úÖ Rest Day Active';
                restDayStatus.style.display = 'block';
                localStorage.setItem('lastRestDay', todayStr);
                
                // Auto-pause training streaks on rest day
                pausedStreaks.training.paused = true;
                pausedStreaks.pushUps.paused = true;
                pausedStreaks.pullUps.paused = true;
                localStorage.setItem('pausedStreaks', JSON.stringify(pausedStreaks));
            } else {
                restDayBtn.classList.remove('active');
                restDayBtn.textContent = 'üõå Rest Day (Pause Training Streaks)';
                restDayStatus.style.display = 'none';
                
                // Unpause if not rest day
                pausedStreaks.training.paused = false;
                pausedStreaks.pushUps.paused = false;
                pausedStreaks.pullUps.paused = false;
                localStorage.setItem('pausedStreaks', JSON.stringify(pausedStreaks));
            }
            
            updatePauseDisplay();
            updatePointsDisplay();
            updateConsistencyTracker();
        }
        
        function updateRestDayDisplay() {
            const restDayBtn = document.getElementById('restDayBtn');
            const restDayStatus = document.getElementById('restDayStatus');
            
            if (isRestDay) {
                restDayBtn.classList.add('active');
                restDayBtn.textContent = '‚úÖ Rest Day Active';
                restDayStatus.style.display = 'block';
            } else {
                restDayBtn.classList.remove('active');
                restDayBtn.textContent = 'üõå Rest Day (Pause Training Streaks)';
                restDayStatus.style.display = 'none';
            }
        }
        
        // ==================== INPUT DATA FUNCTIONS ====================
        function getCurrentInputs() {
            // Sleep calculations
            const sleepHours = parseFloat(document.getElementById('sleepHours').value) || 0;
            const sleepMinutes = parseFloat(document.getElementById('sleepMinutes').value) || 0;
            const totalSleepHours = sleepHours + (sleepMinutes / 60);
            
            const remHours = parseFloat(document.getElementById('remHours').value) || 0;
            const remMinutes = parseFloat(document.getElementById('remMinutes').value) || 0;
            const totalRemMinutes = (remHours * 60) + remMinutes;
            
            const deepHours = parseFloat(document.getElementById('deepHours').value) || 0;
            const deepMinutes = parseFloat(document.getElementById('deepMinutes').value) || 0;
            const totalDeepMinutes = (deepHours * 60) + deepMinutes;
            
            const lightHours = parseFloat(document.getElementById('lightHours').value) || 0;
            const lightMinutes = parseFloat(document.getElementById('lightMinutes').value) || 0;
            const totalLightMinutes = (lightHours * 60) + lightMinutes;
            
            // Bodyweight goals
            const pushUps = parseInt(document.getElementById('pushUps').value) || 0;
            const pullUps = parseInt(document.getElementById('pullUps').value) || 0;
            
            // Helper function for workout types
            const getSelectedTypes = (prefix, types) => {
                const selected = [];
                types.forEach(type => {
                    const checkbox = document.getElementById(prefix + type);
                    if (checkbox && checkbox.checked) selected.push(type);
                });
                return selected;
            };
            
            return {
                // Basic inputs
                stretching: document.getElementById('stretching').value,
                steps: document.getElementById('steps').value,
                sleep: totalSleepHours.toFixed(2),
                sleepHours: sleepHours,
                sleepMinutes: sleepMinutes,
                sleepQuality: document.getElementById('sleepQuality').value,
                remSleep: totalRemMinutes,
                remHours: remHours,
                remMinutes: remMinutes,
                deepSleep: totalDeepMinutes,
                deepHours: deepHours,
                deepMinutes: deepMinutes,
                lightSleep: totalLightMinutes,
                lightHours: lightHours,
                lightMinutes: lightMinutes,
                napped: document.getElementById('napped').checked,
                water: document.getElementById('water').value,
                screenTime: document.getElementById('screenTime').value,
                pages: document.getElementById('pages').value,
                coldShower: document.getElementById('coldShower').checked,
                lust: document.getElementById('lust').checked,
                
                // Bodyweight goals
                pushUps: pushUps,
                pullUps: pullUps,
                
                // Training sessions
                hadGym: document.getElementById('hadGym').checked,
                hadGym2: document.getElementById('hadGym2').checked,
                hadHome: document.getElementById('hadHome').checked,
                hadRun: document.getElementById('hadRun').checked,
                hadRun2: document.getElementById('hadRun2').checked,
                
                // Gym 1
                gymTypes: getSelectedTypes('gym', ['Core', 'Legs', 'Upper', 'Full', 'Cardio']),
                gymDuration: document.getElementById('gymDuration').value,
                gymIntensity: document.getElementById('gymIntensity').value,
                
                // Gym 2
                gym2Types: getSelectedTypes('gym2', ['Core', 'Legs', 'Upper', 'Full', 'Cardio']),
                gym2Duration: document.getElementById('gym2Duration').value,
                gym2Intensity: document.getElementById('gym2Intensity').value,
                
                // Home
                homeTypes: getSelectedTypes('home', ['Bodyweight', 'Yoga', 'HIIT', 'Other']),
                homeDuration: document.getElementById('homeDuration').value,
                homeIntensity: document.getElementById('homeIntensity').value,
                
                // Run 1
                runType: document.getElementById('runType').value,
                runDistance: document.getElementById('runDistance').value,
                runDuration: document.getElementById('runDuration').value,
                runIntensity: document.getElementById('runIntensity').value,
                
                // Run 2
                runType2: document.getElementById('runType2').value,
                runDistance2: document.getElementById('runDistance2').value,
                runDuration2: document.getElementById('runDuration2').value,
                runIntensity2: document.getElementById('runIntensity2').value,
                
                // Rest day
                isRestDay: isRestDay
            };
        }
        
        // ==================== OVERALL CONSISTENCY ====================
        function updateOverallConsistency() {
            const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
            const dates = Object.keys(allData).sort();
            
            if (dates.length === 0) {
                document.getElementById('overallConsistency').textContent = '0%';
                document.getElementById('consistencyDays').textContent = '0/0 days completed';
                document.getElementById('habitBreakWarning').style.display = 'none';
                return;
            }
            
            let completedDays = 0;
            
            dates.forEach(date => {
                const dayData = allData[date];
                let dayCompleted = true;
                
                // Check each habit for this day
                Object.keys(goals).forEach(habit => {
                    if (!isHabitCompleted(habit, dayData)) {
                        dayCompleted = false;
                    }
                });
                
                // Check cold shower and lust control
                if (dayData && !dayData.coldShower) dayCompleted = false;
                if (dayData && dayData.lust) dayCompleted = false;
                
                if (dayCompleted) completedDays++;
            });
            
            const consistency = Math.round((completedDays / dates.length) * 100);
            document.getElementById('overallConsistency').textContent = `${consistency}%`;
            document.getElementById('consistencyDays').textContent = `${completedDays}/${dates.length} days completed`;
            
            // Check for streak breaks > 3 days
            const streakBreaks = checkStreakBreaks(allData, dates);
            if (streakBreaks.length > 0) {
                let html = '';
                streakBreaks.forEach(breakInfo => {
                    html += `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
                            <span>${breakInfo.habit}:</span>
                            <span style="color: #ffc107;">${breakInfo.days} days</span>
                        </div>
                    `;
                });
                document.getElementById('habitBreakList').innerHTML = html;
                document.getElementById('habitBreakWarning').style.display = 'block';
            } else {
                document.getElementById('habitBreakWarning').style.display = 'none';
            }
        }
        
        function isHabitCompleted(habit, dayData) {
            if (!dayData) return false;
            
            switch(habit) {
                case 'training':
                    let trainingSessions = 0;
                    if (dayData.hadGym) trainingSessions++;
                    if (dayData.hadRun) trainingSessions++;
                    return trainingSessions >= goals.training;
                    
                case 'pushUps':
                    return (parseInt(dayData.pushUps) || 0) >= goals.pushUps;
                    
                case 'pullUps':
                    return (parseInt(dayData.pullUps) || 0) >= goals.pullUps;
                    
                case 'screenTime':
                    return (parseFloat(dayData.screenTime) || 0) <= goals.screenTime;
                    
                default:
                    return (parseFloat(dayData[habit]) || 0) >= goals[habit];
            }
        }
        
        function checkStreakBreaks(allData, dates) {
            const breaks = [];
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            
            Object.keys(goals).forEach(habit => {
                let missedDays = 0;
                let checkingDate = new Date(today);
                
                // Check last 7 days for breaks
                for (let i = 0; i < 7; i++) {
                    const dateStr = checkingDate.toISOString().split('T')[0];
                    const dayData = allData[dateStr];
                    
                    if (dayData) {
                        if (!isHabitCompleted(habit, dayData)) {
                            missedDays++;
                        } else {
                            break; // Streak restored
                        }
                    } else {
                        missedDays++;
                    }
                    
                    checkingDate.setDate(checkingDate.getDate() - 1);
                }
                
                if (missedDays > 3) {
                    // Check if streak was paused
                    const paused = (habit === 'steps' && pausedStreaks.steps.paused) ||
                                  (habit === 'training' && pausedStreaks.training.paused) ||
                                  (habit === 'pushUps' && pausedStreaks.pushUps.paused) ||
                                  (habit === 'pullUps' && pausedStreaks.pullUps.paused);
                    
                    if (!paused) {
                        breaks.push({
                            habit: getHabitDisplayName(habit),
                            days: missedDays
                        });
                    }
                }
            });
            
            return breaks;
        }
        
        function getHabitDisplayName(habit) {
            const names = {
                stretching: 'Stretching',
                steps: 'Steps',
                sleep: 'Sleep',
                water: 'Water',
                screenTime: 'Screen Time',
                pages: 'Reading',
                training: 'Training',
                pushUps: 'Push-ups',
                pullUps: 'Pull-ups',
                coldShower: 'Cold Shower',
                lustControl: 'Lust Control'
            };
            return names[habit] || habit;
        }
        
        // ==================== UPDATED POINTS CALCULATION ====================
        function calculateTodayPoints() {
            const currentData = getCurrentInputs();
            const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
            const dates = Object.keys(allData).sort();
            const streaks = calculateStreaksWithPause(dates, allData);
            
            let totalPoints = 0;
            let pointsBreakdown = [];
            let completedGoals = 0;
            const totalGoals = Object.keys(goals).length + 2; // +2 for cold shower and lust control
            
            // Calculate points for each goal
            Object.keys(goals).forEach(key => {
                let points = 0;
                let multiplier = 1;
                let description = '';
                let emoji = '';
                let deduction = 0;
                
                // Streak multiplier
                const streak = streaks[key] || 0;
                for (const [days, mult] of Object.entries(pointsConfig.streakMultipliers).sort((a, b) => b[0] - a[0])) {
                    if (streak >= parseInt(days)) {
                        multiplier = mult;
                        break;
                    }
                }
                
                if (key === 'training') {
                    // Check if it's a rest day
                    if (isRestDay && !pausedStreaks.training.paused) {
                        points = 0;
                        description = 'Training (Rest Day)';
                        emoji = 'üõå';
                    } else {
                        let trainingSessions = 0;
                        if (currentData.hadGym) trainingSessions++;
                        if (currentData.hadGym2) trainingSessions++;
                        if (currentData.hadHome) trainingSessions++;
                        if (currentData.hadRun) trainingSessions++;
                        if (currentData.hadRun2) trainingSessions++;
                        
                        if (trainingSessions >= goals.training) {
                            points = pointsConfig.training.base * multiplier;
                            description = `Training (${trainingSessions} sessions)`;
                            emoji = 'üí™';
                            completedGoals++;
                            
                            // Bonus for > 1h15
                            const totalDuration = (parseInt(currentData.gymDuration) || 0) + 
                                                 (parseInt(currentData.gym2Duration) || 0) +
                                                 (parseInt(currentData.homeDuration) || 0) +
                                                 (parseInt(currentData.runDuration) || 0) +
                                                 (parseInt(currentData.runDuration2) || 0);
                            
                            if (totalDuration > 75) { // 1h15 = 75min
                                const bonus = pointsConfig.training.bonus_1h15;
                                points += bonus;
                                description += ` (+${bonus} for >1h15)`;
                            }
                            
                            // Bonus for high intensity
                            const maxIntensity = Math.max(
                                parseInt(currentData.gymIntensity) || 0,
                                parseInt(currentData.gym2Intensity) || 0,
                                parseInt(currentData.homeIntensity) || 0,
                                parseInt(currentData.runIntensity) || 0,
                                parseInt(currentData.runIntensity2) || 0
                            );
                            
                            if (maxIntensity > 7) {
                                const bonus = pointsConfig.training.bonus_intense;
                                points += bonus;
                                description += ` (+${bonus} for intensity >7)`;
                            }
                            
                            // Bonus for additional sessions
                            if (trainingSessions > 1) {
                                const extraSessions = trainingSessions - 1;
                                const bonus = extraSessions * pointsConfig.training.per_session;
                                points += bonus;
                                description += ` (+${bonus} for ${extraSessions} extra session${extraSessions > 1 ? 's' : ''})`;
                            }
                        } else if (!pausedStreaks.training.paused) {
                            // Deduction for missing training when not paused
                            deduction = pointsConfig.deductions.training;
                            points += deduction;
                            description = `Training (${trainingSessions}/${goals.training})`;
                            emoji = '‚ùå';
                        }
                    }
                } else if (key === 'sleep') {
                    const sleepHours = parseFloat(currentData.sleep) || 0;
                    const sleepScore = parseInt(currentData.sleepQuality) || 0;
                    
                    // Check both conditions: score > 80 AND hours between 8-9.5
                    if (sleepScore > 80 && sleepHours >= 8 && sleepHours <= 9.5) {
                        points = pointsConfig.sleep * multiplier;
                        description = `Sleep (${sleepHours}h, score: ${sleepScore})`;
                        emoji = 'üòä';
                        completedGoals++;
                    } else {
                        // Check for deductions
                        if (sleepScore <= 60) {
                            deduction += pointsConfig.deductions.sleepScoreLow;
                            description = `Sleep score low (${sleepScore})`;
                        }
                        if (sleepHours < 7) {
                            deduction += pointsConfig.deductions.sleepShort;
                            description += description ? ', hours short' : `Sleep hours short (${sleepHours}h)`;
                        }
                        if ((sleepHours < 8 || sleepHours > 9.5) && sleepScore > 80) {
                            deduction += pointsConfig.deductions.sleepWrongRange;
                            description = `Sleep outside ideal range (${sleepHours}h)`;
                        }
                        
                        if (deduction < 0) {
                            points += deduction;
                            emoji = 'üòü';
                        }
                    }
                } else if (key === 'pushUps' || key === 'pullUps') {
                    const current = parseInt(currentData[key]) || 0;
                    const goal = goals[key];
                    
                    if (current >= goal) {
                        points = pointsConfig[key] * multiplier;
                        description = key === 'pushUps' ? 'Push-ups' : 'Pull-ups';
                        emoji = key === 'pushUps' ? 'üí™' : 'ü§∏';
                        completedGoals++;
                        
                        // Bonus for exceeding
                        if (current > goal) {
                            const exceeded = current - goal;
                            const bonus = exceeded * pointsConfig.exceedBonuses[key];
                            points += bonus;
                            description += ` (+${bonus.toFixed(1)} bonus)`;
                        }
                    } else if (!pausedStreaks[key].paused) {
                        // Deduction for missing bodyweight goal
                        deduction = pointsConfig.deductions[key];
                        points += deduction;
                        description = key === 'pushUps' ? 'Push-ups' : 'Pull-ups';
                        emoji = '‚ùå';
                    }
                } else {
                    const current = parseFloat(currentData[key]) || 0;
                    const goal = goals[key];
                    const metGoal = key === 'screenTime' ? current <= goal : current >= goal;
                    const isPaused = (key === 'steps' && pausedStreaks.steps.paused);
                    
                    if (metGoal) {
                        points = pointsConfig[key] * multiplier;
                        description = getHabitDisplayName(key);
                        emoji = getEmojiForActivity(key);
                        completedGoals++;
                        
                        // Bonus for exceeding (except screen time)
                        if (key !== 'screenTime' && current > goal) {
                            const exceeded = current - goal;
                            let bonus = 0;
                            
                            if (key === 'steps') bonus = Math.floor(exceeded * pointsConfig.exceedBonuses.steps);
                            else if (key === 'water') bonus = Math.floor(exceeded * pointsConfig.exceedBonuses.water);
                            else if (key === 'pages') bonus = Math.floor(exceeded * pointsConfig.exceedBonuses.pages);
                            else if (key === 'stretching') bonus = Math.floor(exceeded * pointsConfig.exceedBonuses.stretching);
                            
                            if (bonus > 0) {
                                points += bonus;
                                description += ` (+${bonus} bonus)`;
                            }
                        }
                    } else if (!isPaused) {
                        // Deduction for missing goal when not paused
                        deduction = pointsConfig.deductions[key];
                        points += deduction;
                        description = getHabitDisplayName(key);
                        emoji = '‚ùå';
                    }
                }
                
                // Check for streak breaks > 3 days (additional penalty)
                if (streak === 0 && !pausedStreaks[key]?.paused) {
                    const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
                    const dates = Object.keys(allData).sort();
                    const lastEntry = dates[dates.length - 1];
                    
                    if (lastEntry) {
                        const lastDate = new Date(lastEntry);
                        const today = new Date();
                        const daysSince = Math.floor((today - lastDate) / (1000 * 60 * 60 * 24));
                        
                        if (daysSince > 3) {
                            const breakPenalty = pointsConfig.deductions.streakBreak;
                            points += breakPenalty;
                            if (deduction === 0) {
                                description += ` (${daysSince} day streak break)`;
                                emoji = '‚ö†Ô∏è';
                            }
                        }
                    }
                }
                
                if (points !== 0) {
                    totalPoints += points;
                    const isNegative = points < 0;
                    pointsBreakdown.push({ 
                        emoji, 
                        description, 
                        points: Math.round(points), 
                        multiplier: multiplier > 1 ? `x${multiplier}` : '',
                        isNegative 
                    });
                }
            });
            
            // Cold shower points
            if (currentData.coldShower) {
                const streak = streaks.coldShower || 0;
                let multiplier = 1;
                for (const [days, mult] of Object.entries(pointsConfig.streakMultipliers).sort((a, b) => b[0] - a[0])) {
                    if (streak >= parseInt(days)) {
                        multiplier = mult;
                        break;
                    }
                }
                const points = pointsConfig.coldShower * multiplier;
                totalPoints += points;
                completedGoals++;
                pointsBreakdown.push({ emoji: 'üöø', description: 'Cold Shower', points: Math.round(points), multiplier: multiplier > 1 ? `x${multiplier}` : '' });
            }
            
            // Bodyweight bonus (for completing both)
            const pushUpsDone = (parseInt(currentData.pushUps) || 0) >= goals.pushUps;
            const pullUpsDone = (parseInt(currentData.pullUps) || 0) >= goals.pullUps;
            if (pushUpsDone && pullUpsDone) {
                const points = pointsConfig.bodyweightBonus;
                totalPoints += points;
                pointsBreakdown.push({ emoji: 'üèÜ', description: 'Bodyweight Combo Bonus', points: points, multiplier: 'BONUS' });
            }
            
            // Lust control points/deductions
            if (!currentData.lust) {
                const streak = streaks.lustControl || 0;
                let multiplier = 1;
                for (const [days, mult] of Object.entries(pointsConfig.streakMultipliers).sort((a, b) => b[0] - a[0])) {
                    if (streak >= parseInt(days)) {
                        multiplier = mult;
                        break;
                    }
                }
                const points = pointsConfig.lustControl * multiplier;
                totalPoints += points;
                completedGoals++;
                pointsBreakdown.push({ emoji: 'üö´', description: 'Lust Control', points: Math.round(points), multiplier: multiplier > 1 ? `x${multiplier}` : '' });
            } else {
                // Deduct points for lust
                const deduction = pointsConfig.deductions.lust;
                totalPoints += deduction;
                pointsBreakdown.push({ emoji: '‚ö†Ô∏è', description: 'Lust (Deduction)', points: deduction, multiplier: '', isNegative: true });
            }
            
            // Daily bonus
            if (completedGoals === totalGoals) {
                totalPoints += pointsConfig.dailyCompletionBonus;
                pointsBreakdown.push({ emoji: 'üèÜ', description: 'All Goals Completed!', points: pointsConfig.dailyCompletionBonus, multiplier: 'BONUS' });
            }
            
            return { total: Math.round(totalPoints), breakdown: pointsBreakdown, completedGoals, totalGoals };
        }
        
        function getEmojiForActivity(activity) {
            const emojis = { stretching: 'üßò', steps: 'üëü', sleep: 'üò¥', water: 'üíß', screenTime: 'üì±', pages: 'üìö', training: 'üí™' };
            return emojis[activity] || '‚≠ê';
        }
        
        // ==================== FIXED STREAK CALCULATION ====================
        function calculateStreaks(dates, allData) {
            const streaks = { 
                stretching: 0, steps: 0, sleep: 0, water: 0, screenTime: 0, pages: 0, 
                training: 0, coldShower: 0, lustControl: 0, pushUps: 0, pullUps: 0 
            };
            if (dates.length === 0) return streaks;
            
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            
            function goalMet(date, goalKey, dayData) {
                if (!dayData) return false;
                
                if (goalKey === 'coldShower') return dayData.coldShower === true;
                if (goalKey === 'lustControl') return dayData.lust !== true;
                if (goalKey === 'training') {
                    let sessions = 0;
                    if (dayData.hadGym === true) sessions++;
                    if (dayData.hadRun === true) sessions++;
                    return sessions >= goals.training;
                }
                if (goalKey === 'pushUps' || goalKey === 'pullUps') {
                    const value = parseInt(dayData[goalKey]) || 0;
                    const goal = goals[goalKey];
                    return value >= goal;
                }
                
                const value = parseFloat(dayData[goalKey]) || 0;
                const goal = goals[goalKey];
                return goalKey === 'screenTime' ? value <= goal : value >= goal;
            }
            
            Object.keys(streaks).forEach(goalKey => {
                let streak = 0;
                let checkingDate = new Date(today);
                
                for (let i = 0; i < 365; i++) {
                    const dateStr = checkingDate.toISOString().split('T')[0];
                    const dayData = allData[dateStr];
                    
                    if (dayData && goalMet(dateStr, goalKey, dayData)) {
                        streak++;
                    } else {
                        break;
                    }
                    
                    checkingDate.setDate(checkingDate.getDate() - 1);
                }
                
                streaks[goalKey] = streak;
            });
            
            return streaks;
        }
        
        function calculateStreaksWithPause(dates, allData) {
            const streaks = calculateStreaks(dates, allData);
            
            // Apply pause days
            if (pausedStreaks.steps.paused) streaks.steps = Math.max(streaks.steps, pausedStreaks.steps.days + 1);
            if (pausedStreaks.training.paused) streaks.training = Math.max(streaks.training, pausedStreaks.training.days + 1);
            if (pausedStreaks.coldShower.paused) streaks.coldShower = Math.max(streaks.coldShower, pausedStreaks.coldShower.days + 1);
            if (pausedStreaks.pushUps.paused) streaks.pushUps = Math.max(streaks.pushUps, pausedStreaks.pushUps.days + 1);
            if (pausedStreaks.pullUps.paused) streaks.pullUps = Math.max(streaks.pullUps, pausedStreaks.pullUps.days + 1);
            
            return streaks;
        }
        
        // ==================== UPDATED PAUSE SYSTEM ====================
        function togglePause(streakType) {
            const checkbox = document.getElementById(`pause${streakType.charAt(0).toUpperCase() + streakType.slice(1)}`);
            const toggleElement = checkbox.parentElement;
            
            pausedStreaks[streakType].paused = !pausedStreaks[streakType].paused;
            checkbox.checked = pausedStreaks[streakType].paused;
            toggleElement.classList.toggle('active', pausedStreaks[streakType].paused);
            
            if (pausedStreaks[streakType].paused) {
                pausedStreaks[streakType].days++;
                updatePauseDisplay();
            }
            
            localStorage.setItem('pausedStreaks', JSON.stringify(pausedStreaks));
            updateStreakTracker();
            updatePointsDisplay();
        }
        
        function updatePauseDisplay() {
            Object.keys(pausedStreaks).forEach(streakType => {
                const daysElement = document.getElementById(`pause${streakType.charAt(0).toUpperCase() + streakType.slice(1)}Days`);
                if (daysElement) {
                    daysElement.textContent = `${pausedStreaks[streakType].days} day${pausedStreaks[streakType].days !== 1 ? 's' : ''}`;
                }
                
                const checkbox = document.getElementById(`pause${streakType.charAt(0).toUpperCase() + streakType.slice(1)}`);
                if (checkbox) {
                    const toggleElement = checkbox.parentElement;
                    checkbox.checked = pausedStreaks[streakType].paused;
                    if (toggleElement) {
                        toggleElement.classList.toggle('active', pausedStreaks[streakType].paused);
                    }
                }
            });
        }
        
        // ==================== SAVE & LOAD DATA ====================
        function saveData() {
            const today = new Date().toISOString().split('T')[0];
            const data = getCurrentInputs();
            
            let allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
            allData[today] = data;
            localStorage.setItem('lifeTrackerData', JSON.stringify(allData));
            
            // Save points
            const pointsData = calculateTodayPoints();
            let pointsHistory = JSON.parse(localStorage.getItem('lifeTrackerPoints')) || { total: 0, days: {} };
            if (!pointsHistory.days[today]) {
                pointsHistory.total += pointsData.total;
                pointsHistory.days[today] = { points: pointsData.total, breakdown: pointsData.breakdown };
                localStorage.setItem('lifeTrackerPoints', JSON.stringify(pointsHistory));
            }
            
            // Success message
            const btn = document.querySelector('.save-btn');
            btn.textContent = '‚úÖ Saved Successfully!';
            btn.style.background = 'linear-gradient(135deg, #4CAF50, #45a049)';
            setTimeout(() => {
                btn.textContent = 'üíæ Save Today\'s Data';
                btn.style.background = 'linear-gradient(135deg, #4CAF50, #45a049)';
            }, 2000);
            
            updateChart();
            updateStreakTracker();
            updateTotalStats();
            updatePointsDisplay();
            updateOverallConsistency();
        }
        
        // ==================== FIXED CHART FUNCTIONS ====================
        function showChart(type) {
            currentView = type;
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Show/hide chart type selector
            const chartTypeSelector = document.getElementById('chartTypeSelector');
            if (type === 'consistency') {
                chartTypeSelector.style.display = 'flex';
                chartType = 'pie'; // Default to pie for consistency
            } else {
                chartTypeSelector.style.display = 'none';
                chartType = 'line'; // Default to line for other charts
            }
            
            updateChart();
        }
        
        function changeChartType(type) {
            chartType = type;
            document.querySelectorAll('.chart-type-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updateChart();
        }
        
        function getChartData(dates, allData) {
            if (currentView === 'consistency') {
                if (chartType === 'pie') {
                    return getConsistencyPieChartData(dates, allData);
                } else {
                    return getConsistencyLineChartData(dates, allData);
                }
            } else {
                return getSingleMetricChartData(dates, allData, currentView);
            }
        }
        
        function getConsistencyPieChartData(dates, allData) {
            const habitCompletion = {};
            let totalDays = dates.length;
            
            // Initialize habit counts
            Object.keys(goals).forEach(habit => {
                habitCompletion[habit] = 0;
            });
            habitCompletion['coldShower'] = 0;
            habitCompletion['lustControl'] = 0;
            
            // Count completed days for each habit
            dates.forEach(date => {
                const dayData = allData[date];
                
                Object.keys(goals).forEach(habit => {
                    if (isHabitCompleted(habit, dayData)) {
                        habitCompletion[habit]++;
                    }
                });
                
                if (dayData && dayData.coldShower) habitCompletion['coldShower']++;
                if (dayData && !dayData.lust) habitCompletion['lustControl']++;
            });
            
            // Calculate percentages
            const labels = [];
            const data = [];
            const backgroundColors = [];
            const borderColors = [];
            
            const colors = {
                stretching: '#667eea',
                steps: '#4CAF50',
                sleep: '#2196F3',
                water: '#00BCD4',
                screenTime: '#FF9800',
                pages: '#9C27B0',
                training: '#f44336',
                pushUps: '#FF5722',
                pullUps: '#795548',
                coldShower: '#009688',
                lustControl: '#9C27B0'
            };
            
            Object.keys(habitCompletion).forEach(habit => {
                const percentage = Math.round((habitCompletion[habit] / totalDays) * 100);
                if (percentage > 0) {
                    labels.push(`${getHabitDisplayName(habit)} (${percentage}%)`);
                    data.push(percentage);
                    backgroundColors.push(colors[habit] || '#607D8B');
                    borderColors.push('#ffffff');
                }
            });
            
            return {
                labels,
                datasets: [{
                    data,
                    backgroundColor: backgroundColors,
                    borderColor: borderColors,
                    borderWidth: 2,
                    hoverOffset: 15
                }]
            };
        }
        
        function getConsistencyLineChartData(dates, allData) {
            const now = new Date();
            let filteredDates = [];
            let consistencyData = [];
            
            if (currentPeriod === 'daily') {
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(now);
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    filteredDates.push(dateStr);
                    
                    const dayData = allData[dateStr];
                    if (!dayData) {
                        consistencyData.push(0);
                    } else {
                        let completedHabits = 0;
                        let totalHabits = Object.keys(goals).length + 2;
                        
                        Object.keys(goals).forEach(habit => {
                            if (isHabitCompleted(habit, dayData)) {
                                completedHabits++;
                            }
                        });
                        
                        if (dayData.coldShower) completedHabits++;
                        if (!dayData.lust) completedHabits++;
                        
                        consistencyData.push(Math.round((completedHabits / totalHabits) * 100));
                    }
                }
            }
            
            return {
                labels: filteredDates,
                datasets: [{
                    label: 'Consistency %',
                    data: consistencyData,
                    borderColor: '#764ba2',
                    backgroundColor: '#764ba220',
                    tension: 0.4,
                    fill: true
                }]
            };
        }
        
        function getSingleMetricChartData(labels, allData, metric) {
            const now = new Date();
            let filteredDates = [];
            let data = [];
            
            if (currentPeriod === 'daily') {
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(now);
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    filteredDates.push(dateStr);
                    
                    const dayData = allData[dateStr];
                    if (metric === 'training') {
                        if (dayData) {
                            let sessions = 0;
                            if (dayData.hadGym === true) sessions++;
                            if (dayData.hadRun === true) sessions++;
                            data.push(sessions);
                        } else {
                            data.push(0);
                        }
                    } else if (metric === 'sleep') {
                        data.push(dayData ? (parseFloat(dayData.sleep) || 0) : 0);
                    } else {
                        data.push(dayData ? (parseFloat(dayData[metric]) || 0) : 0);
                    }
                }
            } else if (currentPeriod === 'weekly') {
                // Weekly aggregation
                for (let i = 3; i >= 0; i--) {
                    const weekStart = new Date(now);
                    weekStart.setDate(weekStart.getDate() - (i * 7));
                    const weekEnd = new Date(weekStart);
                    weekEnd.setDate(weekEnd.getDate() + 6);
                    
                    let weekTotal = 0;
                    let daysInWeek = 0;
                    
                    for (let d = 0; d < 7; d++) {
                        const currentDate = new Date(weekStart);
                        currentDate.setDate(currentDate.getDate() + d);
                        const dateStr = currentDate.toISOString().split('T')[0];
                        const dayData = allData[dateStr];
                        
                        if (dayData) {
                            if (metric === 'training') {
                                let sessions = 0;
                                if (dayData.hadGym === true) sessions++;
                                if (dayData.hadRun === true) sessions++;
                                weekTotal += sessions;
                            } else if (metric === 'sleep') {
                                weekTotal += parseFloat(dayData.sleep) || 0;
                            } else {
                                weekTotal += parseFloat(dayData[metric]) || 0;
                            }
                            daysInWeek++;
                        }
                    }
                    
                    const weekAvg = daysInWeek > 0 ? weekTotal / daysInWeek : 0;
                    filteredDates.push(`Week ${i+1}`);
                    data.push(Math.round(weekAvg * 10) / 10);
                }
            }
            
            const colors = {
                stretching: '#667eea',
                steps: '#4CAF50',
                sleep: '#2196F3',
                water: '#00BCD4',
                screenTime: '#FF9800',
                pages: '#9C27B0',
                training: '#f44336',
                consistency: '#764ba2'
            };
            
            return {
                labels: filteredDates,
                datasets: [{
                    label: metric.charAt(0).toUpperCase() + metric.slice(1),
                    data,
                    borderColor: colors[metric] || '#667eea',
                    backgroundColor: (colors[metric] || '#667eea') + '20',
                    tension: 0.4,
                    fill: true
                }]
            };
        }
        
        // ==================== RESET FUNCTIONS ====================
        function showResetConfirm() {
            document.getElementById('resetConfirm').style.display = 'block';
        }
        
        function hideResetConfirm() {
            document.getElementById('resetConfirm').style.display = 'none';
        }
        
        function hardReset() {
            localStorage.removeItem('lifeTrackerData');
            localStorage.removeItem('pausedStreaks');
            localStorage.removeItem('lastPauseReset');
            localStorage.removeItem('lifeTrackerPoints');
            localStorage.removeItem('isRestDay');
            localStorage.removeItem('lastRestDay');
            
            // Reset all variables
            pausedStreaks = {
                steps: { paused: false, days: 0 },
                training: { paused: false, days: 0 },
                coldShower: { paused: false, days: 0 },
                pushUps: { paused: false, days: 0 },
                pullUps: { paused: false, days: 0 }
            };
            isRestDay = false;
            
            // Clear all inputs
            document.querySelectorAll('input, select').forEach(el => {
                if (el.type === 'checkbox' || el.type === 'radio') {
                    el.checked = false;
                } else {
                    el.value = '';
                }
            });
            
            // Hide details
            ['gymDetails', 'gymDetails2', 'homeDetails', 'runDetails', 'runDetails2'].forEach(id => {
                document.getElementById(id).style.display = 'none';
            });
            
            hideResetConfirm();
            
            // Update UI
            updateCheckboxStyles();
            updateConsistencyTracker();
            updateSleepAnalysis();
            updateBodyweightGoals();
            updateStreakTracker();
            updateTotalStats();
            updatePauseDisplay();
            updatePointsDisplay();
            updateChart();
            updateOverallConsistency();
            updateRestDayDisplay();
            
            // Success message
            const resetBtn = document.querySelector('.reset-btn');
            resetBtn.textContent = '‚úÖ All Data Cleared!';
            resetBtn.style.background = 'linear-gradient(135deg, #4CAF50, #45a049)';
            setTimeout(() => {
                resetBtn.textContent = 'üóëÔ∏è Hard Reset All Data';
                resetBtn.style.background = 'linear-gradient(135deg, #f44336, #d32f2f)';
            }, 3000);
        }
        
        // ==================== FIXED STREAK TRACKER ====================
        function updateStreakTracker() {
            const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
            const dates = Object.keys(allData).sort();
            const streaks = calculateStreaksWithPause(dates, allData);
            
            let html = '';
            Object.keys(streaks).forEach(key => {
                const streak = streaks[key];
                let displayName = getHabitDisplayName(key);
                
                let streakColor = '#666';
                let flameIcon = '';
                let pausedIndicator = '';
                
                if ((key === 'steps' && pausedStreaks.steps.paused) ||
                    (key === 'training' && pausedStreaks.training.paused) ||
                    (key === 'coldShower' && pausedStreaks.coldShower.paused) ||
                    (key === 'pushUps' && pausedStreaks.pushUps.paused) ||
                    (key === 'pullUps' && pausedStreaks.pullUps.paused)) {
                    pausedIndicator = ' ‚è∏Ô∏è';
                    streakColor = '#6c757d';
                } else if (streak >= 7) {
                    streakColor = '#4CAF50';
                    flameIcon = 'üî•';
                } else if (streak >= 3) {
                    streakColor = '#FF9800';
                    flameIcon = 'üî•';
                } else if (streak > 0) {
                    streakColor = '#667eea';
                    flameIcon = '‚ú®';
                }
                
                html += `
                    <div class="consistency-item">
                        <span>${displayName}</span>
                        <div style="color: ${streakColor}; font-weight: bold; font-size: 1.1rem;">
                            ${streak} day${streak !== 1 ? 's' : ''} ${flameIcon}${pausedIndicator}
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('streakTracker').innerHTML = html;
        }
        
        // ==================== OTHER ORIGINAL FUNCTIONS ====================
        function updateConsistencyTracker() {
            const tracker = document.getElementById('consistencyTracker');
            const currentData = getCurrentInputs();
            
            let html = '';
            
            // Regular metrics
            Object.keys(goals).forEach(key => {
                if (key === 'training') {
                    let trainingSessions = 0;
                    if (currentData.hadGym) trainingSessions++;
                    if (currentData.hadGym2) trainingSessions++;
                    if (currentData.hadHome) trainingSessions++;
                    if (currentData.hadRun) trainingSessions++;
                    if (currentData.hadRun2) trainingSessions++;
                    
                    const isGood = trainingSessions >= goals.training;
                    const status = isGood ? 'good' : 'bad';
                    const icon = isGood ? '‚úì' : '‚úó';
                    
                    html += `
                        <div class="consistency-item">
                            <span>Training (${trainingSessions}/${goals.training})</span>
                            <div class="consistency-status status-${status}">${icon}</div>
                        </div>
                    `;
                } else if (key === 'pushUps' || key === 'pullUps') {
                    const current = parseInt(currentData[key]) || 0;
                    const goal = goals[key];
                    const isGood = current >= goal;
                    const status = isGood ? 'good' : 'bad';
                    const icon = isGood ? '‚úì' : '‚úó';
                    
                    const displayName = key === 'pushUps' ? 'Push-ups' : 'Pull-ups';
                    
                    html += `
                        <div class="consistency-item">
                            <span>${displayName} (${current}/${goal})</span>
                            <div class="consistency-status status-${status}">${icon}</div>
                        </div>
                    `;
                } else {
                    const current = parseFloat(currentData[key]) || 0;
                    const goal = goals[key];
                    const isGood = key === 'screenTime' ? current <= goal : current >= goal;
                    const status = isGood ? 'good' : 'bad';
                    const icon = isGood ? '‚úì' : '‚úó';
                    
                    let displayName = getHabitDisplayName(key);
                    
                    html += `
                        <div class="consistency-item">
                            <span>${displayName}</span>
                            <div class="consistency-status status-${status}">${icon}</div>
                        </div>
                    `;
                }
            });
            
            // Cold shower
            html += `
                <div class="consistency-item">
                    <span>Cold Shower</span>
                    <div class="consistency-status status-${currentData.coldShower ? 'good' : 'bad'}">${currentData.coldShower ? '‚úì' : '‚úó'}</div>
                </div>
            `;
            
            // Lust control (inverted)
            html += `
                <div class="consistency-item">
                    <span>Lust Control</span>
                    <div class="consistency-status status-${currentData.lust ? 'bad' : 'good'}">${currentData.lust ? '‚úó' : '‚úì'}</div>
                </div>
            `;
            
            tracker.innerHTML = html;
        }
        
        function updateSleepAnalysis() {
            const currentData = getCurrentInputs();
            const sleepAnalysis = document.getElementById('sleepAnalysis');
            
            let html = '';
            
            // Sleep Score
            let sleepEmoji = 'üò¥';
            let sleepColor = '#667eea';
            if (currentData.sleepQuality >= 80) {
                sleepEmoji = 'üòä';
                sleepColor = '#4CAF50';
            } else if (currentData.sleepQuality >= 60) {
                sleepEmoji = 'üòê';
                sleepColor = '#FF9800';
            } else if (currentData.sleepQuality > 0) {
                sleepEmoji = 'üòü';
                sleepColor = '#f44336';
            }
            
            // Format sleep time
            let sleepTimeDisplay = '';
            if (currentData.sleepHours > 0 || currentData.sleepMinutes > 0) {
                if (currentData.sleepHours > 0 && currentData.sleepMinutes > 0) {
                    sleepTimeDisplay = `${currentData.sleepHours}h ${currentData.sleepMinutes}m`;
                } else if (currentData.sleepHours > 0) {
                    sleepTimeDisplay = `${currentData.sleepHours}h`;
                } else {
                    sleepTimeDisplay = `${currentData.sleepMinutes}m`;
                }
            }
            
            html += `
                <div class="sleep-score" style="color: ${sleepColor}">
                    ${currentData.sleepQuality > 0 ? currentData.sleepQuality : '--'}/100 ${sleepEmoji}
                </div>
                <div style="text-align: center; color: #666; margin-bottom: 15px;">
                    ${sleepTimeDisplay || 'No sleep data'}
                    ${currentData.napped ? ' + Nap üí§' : ''}
                </div>
            `;
            
            // Sleep stages
            const totalMinutes = currentData.remSleep + currentData.deepSleep + currentData.lightSleep;
            if (totalMinutes > 0) {
                const remPercent = Math.round((currentData.remSleep/totalMinutes)*100);
                const deepPercent = Math.round((currentData.deepSleep/totalMinutes)*100);
                const lightPercent = Math.round((currentData.lightSleep/totalMinutes)*100);
                
                const formatTime = (totalMinutes) => {
                    const hours = Math.floor(totalMinutes / 60);
                    const minutes = totalMinutes % 60;
                    if (hours > 0 && minutes > 0) return `${hours}h ${minutes}m`;
                    if (hours > 0) return `${hours}h`;
                    return `${minutes}m`;
                };
                
                html += `
                    <div class="sleep-breakdown">
                        <div class="sleep-metric" style="border-left: 4px solid #667eea;">
                            <div class="sleep-metric-label">REM Sleep</div>
                            <div class="sleep-metric-value">${formatTime(currentData.remSleep)}</div>
                            <div style="font-size: 0.7rem; color: #888;">${remPercent}%</div>
                            <div class="sleep-stage-bar">
                                <div class="sleep-stage-fill" style="width: ${remPercent}%; background: #667eea;"></div>
                            </div>
                        </div>
                        <div class="sleep-metric" style="border-left: 4px solid #4CAF50;">
                            <div class="sleep-metric-label">Deep Sleep</div>
                            <div class="sleep-metric-value">${formatTime(currentData.deepSleep)}</div>
                            <div style="font-size: 0.7rem; color: #888;">${deepPercent}%</div>
                            <div class="sleep-stage-bar">
                                <div class="sleep-stage-fill" style="width: ${deepPercent}%; background: #4CAF50;"></div>
                            </div>
                        </div>
                        <div class="sleep-metric" style="border-left: 4px solid #FF9800;">
                            <div class="sleep-metric-label">Light Sleep</div>
                            <div class="sleep-metric-value">${formatTime(currentData.lightSleep)}</div>
                            <div style="font-size: 0.7rem; color: #888;">${lightPercent}%</div>
                            <div class="sleep-stage-bar">
                                <div class="sleep-stage-fill" style="width: ${lightPercent}%; background: #FF9800;"></div>
                            </div>
                        </div>
                        <div class="sleep-metric" style="border-left: 4px solid #9C27B0;">
                            <div class="sleep-metric-label">Total Stages</div>
                            <div class="sleep-metric-value">${formatTime(totalMinutes)}</div>
                            <div style="font-size: 0.7rem; color: #888;">${Math.floor(totalMinutes/60)}h ${totalMinutes%60}m</div>
                            <div class="sleep-stage-bar">
                                <div class="sleep-stage-fill" style="width: 100%; background: #9C27B0;"></div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; text-align: center; font-size: 0.9rem; color: #666;">
                        <div>üí° Ideal: 1.5-2h REM, 1-1.5h Deep sleep</div>
                        <div style="font-size: 0.8rem; color: #888; margin-top: 3px;">(20-25% each of total sleep)</div>
                    </div>
                `;
            } else if (currentData.sleep > 0) {
                html += `<div style="text-align: center; color: #888; padding: 20px;">Enter sleep stage details for breakdown</div>`;
            } else {
                html += `<div style="text-align: center; color: #888; padding: 20px;">Enter sleep data to see analysis</div>`;
            }
            
            sleepAnalysis.innerHTML = html;
        }
        
        function updateTotalStats() {
            const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
            const totalStatsElement = document.getElementById('totalStats');
            
            const totals = { 
                stretching: 0, steps: 0, sleep: 0, water: 0, screenTime: 0, pages: 0, 
                gymSessions: 0, runs: 0, totalRunDistance: 0, coldShowers: 0, naps: 0,
                pushUps: 0, pullUps: 0
            };
            let totalDays = 0;
            
            Object.keys(allData).forEach(date => {
                const dayData = allData[date];
                totalDays++;
                
                totals.stretching += parseFloat(dayData.stretching) || 0;
                totals.steps += parseFloat(dayData.steps) || 0;
                totals.sleep += parseFloat(dayData.sleep) || 0;
                totals.water += parseFloat(dayData.water) || 0;
                totals.screenTime += parseFloat(dayData.screenTime) || 0;
                totals.pages += parseFloat(dayData.pages) || 0;
                totals.pushUps += parseInt(dayData.pushUps) || 0;
                totals.pullUps += parseInt(dayData.pullUps) || 0;
                
                if (dayData.hadGym === true) totals.gymSessions++;
                if (dayData.hadRun === true) {
                    totals.runs++;
                    totals.totalRunDistance += parseFloat(dayData.runDistance) || 0;
                }
                
                if (dayData.coldShower === true) totals.coldShowers++;
                if (dayData.napped === true) totals.naps++;
            });
            
            const formatNumber = (num) => {
                if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
                if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
                return Math.round(num * 10) / 10;
            };
            
            totalStatsElement.innerHTML = `
                <div class="consistency-item"><span>üßò Total Stretching</span><div style="font-weight: bold; color: #667eea;">${formatNumber(totals.stretching)}</div></div>
                <div class="consistency-item"><span>üëü Total Steps</span><div style="font-weight: bold; color: #667eea;">${formatNumber(totals.steps)}</div></div>
                <div class="consistency-item"><span>üò¥ Total Sleep</span><div style="font-weight: bold; color: #667eea;">${formatNumber(totals.sleep)}h</div></div>
                <div class="consistency-item"><span>üíß Total Water</span><div style="font-weight: bold; color: #667eea;">${formatNumber(totals.water)}L</div></div>
                <div class="consistency-item"><span>üì± Total Screen Time</span><div style="font-weight: bold; color: #667eea;">${formatNumber(totals.screenTime)}h</div></div>
                <div class="consistency-item"><span>üìö Total Pages</span><div style="font-weight: bold; color: #667eea;">${formatNumber(totals.pages)}</div></div>
                <div class="consistency-item"><span>üí™ Total Push-ups</span><div style="font-weight: bold; color: #667eea;">${formatNumber(totals.pushUps)}</div></div>
                <div class="consistency-item"><span>ü§∏ Total Pull-ups</span><div style="font-weight: bold; color: #667eea;">${formatNumber(totals.pullUps)}</div></div>
                <div class="consistency-item"><span>üèãÔ∏è Gym Sessions</span><div style="font-weight: bold; color: #667eea;">${totals.gymSessions}</div></div>
                <div class="consistency-item"><span>üèÉ Total Runs</span><div style="font-weight: bold; color: #667eea;">${totals.runs}</div></div>
                <div class="consistency-item"><span>üìè Total Distance</span><div style="font-weight: bold; color: #667eea;">${formatNumber(totals.totalRunDistance)}km</div></div>
                <div class="consistency-item"><span>üöø Cold Showers</span><div style="font-weight: bold; color: #4CAF50;">${totals.coldShowers}</div></div>
                <div class="consistency-item"><span>üò¥ Naps Taken</span><div style="font-weight: bold; color: #667eea;">${totals.naps}</div></div>
                <div class="consistency-item"><span>üìÖ Days Tracked</span><div style="font-weight: bold; color: #764ba2;">${totalDays}</div></div>
            `;
        }
        
        function updatePointsDisplay() {
            const pointsData = calculateTodayPoints();
            const lifetimePoints = calculateLifetimePoints();
            
            document.getElementById('totalPoints').textContent = lifetimePoints.total;
            document.getElementById('todayPoints').textContent = `Today: ${pointsData.total} points`;
            
            let html = '';
            if (pointsData.breakdown.length > 0) {
                pointsData.breakdown.forEach(item => {
                    const pointsClass = item.isNegative ? 'points-negative' : 'points-value';
                    const pointsDisplay = item.points > 0 ? `+${item.points}` : item.points;
                    
                    html += `
                        <div class="points-item">
                            <div class="points-activity">
                                <span class="points-emoji">${item.emoji}</span>
                                <span>${item.description}</span>
                            </div>
                            <div>
                                <span class="${pointsClass}">${pointsDisplay}</span>
                                ${item.multiplier ? `<span class="points-multiplier">${item.multiplier}</span>` : ''}
                            </div>
                        </div>
                    `;
                });
            } else {
                html = `<div style="text-align: center; color: #888; padding: 10px;">Complete goals to earn points!</div>`;
            }
            
            document.getElementById('pointsBreakdown').innerHTML = html;
            updateLevelProgress(lifetimePoints.total);
        }
        
        function calculateLifetimePoints() {
            const storedPoints = JSON.parse(localStorage.getItem('lifeTrackerPoints')) || { total: 0 };
            const todayPoints = calculateTodayPoints();
            return { total: storedPoints.total + todayPoints.total };
        }
        
        function updateLevelProgress(totalPoints) {
            const levelProgress = document.getElementById('levelProgress');
            const levelText = document.getElementById('levelText');
            
            let level = 1;
            let pointsNeededForLevel = 100;
            let pointsForNextLevel = 100;
            let pointsInCurrentLevel = totalPoints;
            
            while (pointsInCurrentLevel >= pointsNeededForLevel) {
                pointsInCurrentLevel -= pointsNeededForLevel;
                level++;
                pointsNeededForLevel = level * 100;
                pointsForNextLevel = level * 100;
            }
            
            const progressPercent = (pointsInCurrentLevel / pointsForNextLevel) * 100;
            levelProgress.style.width = `${progressPercent}%`;
            levelText.textContent = `Level ${level} (${pointsInCurrentLevel}/${pointsForNextLevel})`;
        }
        
        function initializeChart() {
            const ctx = document.getElementById('mainChart').getContext('2d');
            currentChart = new Chart(ctx, {
                type: 'line',
                data: { labels: [], datasets: [] },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true } },
                    plugins: { 
                        legend: { 
                            display: true, 
                            position: 'top',
                            labels: {
                                font: {
                                    size: 12
                                }
                            }
                        } 
                    }
                }
            });
            updateChart();
        }
        
        function updateChart() {
            const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
            const dates = Object.keys(allData).sort();
            const chartData = getChartData(dates, allData);
            
            if (currentChart) {
                currentChart.destroy();
            }
            
            const ctx = document.getElementById('mainChart').getContext('2d');
            
            // Determine chart type based on view and selection
            let type = 'line';
            let options = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { 
                    legend: { 
                        display: true, 
                        position: 'top',
                        labels: {
                            font: {
                                size: 12
                            }
                        }
                    } 
                }
            };
            
            if (currentView === 'consistency' && chartType === 'pie') {
                type = 'pie';
                options = {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'right',
                            labels: {
                                font: {
                                    size: 11
                                },
                                padding: 20
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    return `${label}: ${value}% of days`;
                                }
                            }
                        }
                    }
                };
            }
            
            currentChart = new Chart(ctx, {
                type: type,
                data: chartData,
                options: options
            });
            
            const titles = {
                stretching: 'Stretching Sessions',
                steps: 'Steps Taken',
                sleep: 'Sleep Hours',
                water: 'Water Intake (Liters)',
                screenTime: 'Screen Time (Hours)',
                pages: 'Pages Read',
                training: 'Training Sessions',
                consistency: 'Habit Consistency'
            };
            
            const periodText = currentPeriod === 'daily' ? 'Last 7 Days' : 
                              currentPeriod === 'weekly' ? 'Last 4 Weeks' : 'Last 6 Months';
            
            if (currentView === 'consistency' && chartType === 'pie') {
                document.getElementById('chartTitle').textContent = `Habit Consistency - Overall`;
            } else {
                document.getElementById('chartTitle').textContent = `${titles[currentView] || currentView} - ${periodText}`;
            }
        }
        
        function changePeriod(period) {
            currentPeriod = period;
            document.querySelectorAll('.period-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updateChart();
        }
        
        function loadTodaysData() {
            const today = new Date().toISOString().split('T')[0];
            const allData = JSON.parse(localStorage.getItem('lifeTrackerData')) || {};
            const todaysData = allData[today];
            
            if (!todaysData) return;
            
            // Load basic fields
            Object.keys(todaysData).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    if (element.type === 'checkbox') {
                        element.checked = todaysData[key];
                    } else {
                        element.value = todaysData[key] || '';
                    }
                }
            });
            
            // Show/hide training details based on checkboxes
            if (todaysData.hadGym) document.getElementById('gymDetails').style.display = 'block';
            if (todaysData.hadGym2) document.getElementById('gymDetails2').style.display = 'block';
            if (todaysData.hadHome) document.getElementById('homeDetails').style.display = 'block';
            if (todaysData.hadRun) document.getElementById('runDetails').style.display = 'grid';
            if (todaysData.hadRun2) document.getElementById('runDetails2').style.display = 'grid';
            
            updateCheckboxStyles();
            updateConsistencyTracker();
            updateSleepAnalysis();
            updateBodyweightGoals();
        }
        
        function resetPauseCounters() {
            const today = new Date().toISOString().split('T')[0];
            const lastReset = localStorage.getItem('lastPauseReset') || '';
            
            if (today !== lastReset) {
                Object.keys(pausedStreaks).forEach(streakType => {
                    if (!pausedStreaks[streakType].paused) {
                        pausedStreaks[streakType].days = 0;
                    }
                });
                
                localStorage.setItem('lastPauseReset', today);
                localStorage.setItem('pausedStreaks', JSON.stringify(pausedStreaks));
                updatePauseDisplay();
            }
        }
    </script>
</body>
</html>
